!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ethers")):"function"==typeof define&&define.amd?define(["exports","ethers"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sequence={},e.ethers)}(this,(function(e,t){"use strict";var s=Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"bytes32",type:"bytes32"}],name:"getAlternativeSignature",outputs:[{internalType:"string",type:"string"}],stateMutability:"view",type:"function"}]});var n=Object.freeze({__proto__:null,abi:[{type:"function",name:"isValidSignature",constant:!0,inputs:[{type:"bytes32"},{type:"bytes"}],outputs:[{type:"bytes4"}],payable:!1,stateMutability:"view"}],returns:{isValidSignatureBytes32:"0x1626ba7e"}});const r={erc6492:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"bytes",name:"error",type:"bytes"}],name:"ERC1271Revert",type:"error"},{inputs:[{internalType:"bytes",name:"error",type:"bytes"}],name:"ERC6492DeployFailed",type:"error"},{inputs:[{internalType:"address",name:"_signer",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"_signature",type:"bytes"}],name:"isValidSig",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_signer",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"_signature",type:"bytes"},{internalType:"bool",name:"allowSideEffects",type:"bool"},{internalType:"bool",name:"deployAlreadyDeployed",type:"bool"}],name:"isValidSigImpl",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_signer",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"_signature",type:"bytes"}],name:"isValidSigNoThrow",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_signer",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"_signature",type:"bytes"}],name:"isValidSigWithSideEffects",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_signer",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"_signature",type:"bytes"}],name:"isValidSigWithSideEffectsNoThrow",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}]}),erc5719:s,erc1271:n,factory:Object.freeze({__proto__:null,abi:[{type:"function",name:"deploy",constant:!1,inputs:[{type:"address"},{type:"bytes32"}],outputs:[],payable:!0,stateMutability:"payable"}]}),mainModule:Object.freeze({__proto__:null,abi:[{type:"function",name:"nonce",constant:!0,inputs:[],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"readNonce",constant:!0,inputs:[{type:"uint256"}],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"updateImplementation",constant:!1,inputs:[{type:"address"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"selfExecute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"execute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"},{type:"uint256"},{type:"bytes"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"createContract",inputs:[{type:"bytes"}],payable:!0,stateMutability:"payable"},{type:"function",name:"setExtraImageHash",constant:!1,inputs:[{type:"bytes32",name:"imageHash"},{type:"uint256",name:"expiration"}],outputs:[],payable:!1,stateMutability:"nonpayable"}]}),mainModuleUpgradable:Object.freeze({__proto__:null,abi:[{type:"function",name:"updateImageHash",constant:!0,inputs:[{type:"bytes32"}],outputs:[],payable:!1,stateMutability:"view"},{type:"function",name:"imageHash",constant:!0,inputs:[],outputs:[{type:"bytes32"}],payable:!1,stateMutability:"view"}]}),sequenceUtils:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_mainModule",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"bytes32",name:"_imageHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"_threshold",type:"uint256"},{indexed:!1,internalType:"bytes",name:"_signers",type:"bytes"}],name:"RequiredConfig",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"address",name:"_signer",type:"address"}],name:"RequiredSigner",type:"event"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callBalanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callBlockNumber",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_i",type:"uint256"}],name:"callBlockhash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"callChainId",outputs:[{internalType:"uint256",name:"id",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCode",outputs:[{internalType:"bytes",name:"code",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeHash",outputs:[{internalType:"bytes32",name:"codeHash",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeSize",outputs:[{internalType:"uint256",name:"size",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callCoinbase",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callDifficulty",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLeft",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLimit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callOrigin",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callTimestamp",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"knownImageHashes",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"lastImageHashUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastSignerUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastWalletUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bool",name:"delegateCall",type:"bool"},{internalType:"bool",name:"revertOnError",type:"bool"},{internalType:"uint256",name:"gasLimit",type:"uint256"},{internalType:"address",name:"target",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct IModuleCalls.Transaction[]",name:"_txs",type:"tuple[]"}],name:"multiCall",outputs:[{internalType:"bool[]",name:"_successes",type:"bool[]"},{internalType:"bytes[]",name:"_results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_threshold",type:"uint256"},{components:[{internalType:"uint256",name:"weight",type:"uint256"},{internalType:"address",name:"signer",type:"address"}],internalType:"struct RequireUtils.Member[]",name:"_members",type:"tuple[]"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishConfig",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"uint256",name:"_sizeMembers",type:"uint256"},{internalType:"bytes",name:"_signature",type:"bytes"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishInitialSigners",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_nonce",type:"uint256"}],name:"requireMinNonce",outputs:[],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_expiration",type:"uint256"}],name:"requireNonExpired",outputs:[],stateMutability:"view",type:"function"}]}),requireFreshSigner:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"",type:"address"}],name:"requireFreshSigner",outputs:[],stateMutability:"nonpayable",type:"function"}]})};var i=Object.freeze({__proto__:null,walletContracts:r});function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)({}).hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},o.apply(null,arguments)}let a=function(e){return e.DESC="DESC",e.ASC="ASC",e}({}),c=function(e){return e.ach="ach",e.debit="debit",e.credit="credit",e.us_debit="us_debit",e.international_debit="international_debit",e.international_credit="international_credit",e}({}),h=function(e){return e.buy="buy",e.sell="sell",e}({}),l=function(e){return e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155",e}({});class d{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/API/",this.ping=(e,t)=>this.fetch(this.url("Ping"),u({},e,t)).then((e=>f(e).then((e=>({status:e.status})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.version=(e,t)=>this.fetch(this.url("Version"),u({},e,t)).then((e=>f(e).then((e=>({version:e.version})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.runtimeStatus=(e,t)=>this.fetch(this.url("RuntimeStatus"),u({},e,t)).then((e=>f(e).then((e=>({status:e.status})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.clock=(e,t)=>this.fetch(this.url("Clock"),u({},e,t)).then((e=>f(e).then((e=>({serverTime:e.serverTime})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getSequenceContext=(e,t)=>this.fetch(this.url("GetSequenceContext"),u({},e,t)).then((e=>f(e).then((e=>({data:e.data})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getAuthToken=(e,t,s)=>this.fetch(this.url("GetAuthToken"),u(e,t,s)).then((e=>f(e).then((e=>({status:e.status,jwtToken:e.jwtToken,address:e.address,user:e.user})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getAuthToken2=(e,t,s)=>this.fetch(this.url("GetAuthToken2"),u(e,t,s)).then((e=>f(e).then((e=>({status:e.status,jwtToken:e.jwtToken,address:e.address,user:e.user})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.sendPasswordlessLink=(e,t,s)=>this.fetch(this.url("SendPasswordlessLink"),u(e,t,s)).then((e=>f(e).then((e=>({status:e.status})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.friendList=(e,t,s)=>this.fetch(this.url("FriendList"),u(e,t,s)).then((e=>f(e).then((e=>({page:e.page,friends:e.friends})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getFriendByAddress=(e,t,s)=>this.fetch(this.url("GetFriendByAddress"),u(e,t,s)).then((e=>f(e).then((e=>({status:e.status,friend:e.friend})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.searchFriends=(e,t,s)=>this.fetch(this.url("SearchFriends"),u(e,t,s)).then((e=>f(e).then((e=>({friends:e.friends})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.addFriend=(e,t,s)=>this.fetch(this.url("AddFriend"),u(e,t,s)).then((e=>f(e).then((e=>({status:e.status,friend:e.friend})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.updateFriendNickname=(e,t,s)=>this.fetch(this.url("UpdateFriendNickname"),u(e,t,s)).then((e=>f(e).then((e=>({status:e.status,friend:e.friend})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.removeFriend=(e,t,s)=>this.fetch(this.url("RemoveFriend"),u(e,t,s)).then((e=>f(e).then((e=>({status:e.status})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.contractCall=(e,t,s)=>this.fetch(this.url("ContractCall"),u(e,t,s)).then((e=>f(e).then((e=>({returns:e.returns})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.decodeContractCall=(e,t,s)=>this.fetch(this.url("DecodeContractCall"),u(e,t,s)).then((e=>f(e).then((e=>({call:e.call})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.lookupContractCallSelectors=(e,t,s)=>this.fetch(this.url("LookupContractCallSelectors"),u(e,t,s)).then((e=>f(e).then((e=>({signatures:e.signatures})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.userStorageFetch=(e,t,s)=>this.fetch(this.url("UserStorageFetch"),u(e,t,s)).then((e=>f(e).then((e=>({object:e.object})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.userStorageSave=(e,t,s)=>this.fetch(this.url("UserStorageSave"),u(e,t,s)).then((e=>f(e).then((e=>({ok:e.ok})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.userStorageDelete=(e,t,s)=>this.fetch(this.url("UserStorageDelete"),u(e,t,s)).then((e=>f(e).then((e=>({ok:e.ok})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.userStorageFetchAll=(e,t,s)=>this.fetch(this.url("UserStorageFetchAll"),u(e,t,s)).then((e=>f(e).then((e=>({objects:e.objects})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getMoonpayLink=(e,t,s)=>this.fetch(this.url("GetMoonpayLink"),u(e,t,s)).then((e=>f(e).then((e=>({signedUrl:e.signedUrl})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.resolveENSAddress=(e,t,s)=>this.fetch(this.url("ResolveENSAddress"),u(e,t,s)).then((e=>f(e).then((e=>({address:e.address,ok:e.ok})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.isValidSignature=(e,t,s)=>this.fetch(this.url("IsValidSignature"),u(e,t,s)).then((e=>f(e).then((e=>({isValid:e.isValid})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.isValidMessageSignature=(e,t,s)=>this.fetch(this.url("IsValidMessageSignature"),u(e,t,s)).then((e=>f(e).then((e=>({isValid:e.isValid})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.isValidTypedDataSignature=(e,t,s)=>this.fetch(this.url("IsValidTypedDataSignature"),u(e,t,s)).then((e=>f(e).then((e=>({isValid:e.isValid})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.isValidETHAuthProof=(e,t,s)=>this.fetch(this.url("IsValidETHAuthProof"),u(e,t,s)).then((e=>f(e).then((e=>({isValid:e.isValid})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.sardineGetClientToken=(e,t)=>this.fetch(this.url("SardineGetClientToken"),u({},e,t)).then((e=>f(e).then((e=>({token:e.token})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.sardineGetNFTCheckoutToken=(e,t,s)=>this.fetch(this.url("SardineGetNFTCheckoutToken"),u(e,t,s)).then((e=>f(e).then((e=>({resp:e.resp})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.sardineGetNFTCheckoutOrderStatus=(e,t,s)=>this.fetch(this.url("SardineGetNFTCheckoutOrderStatus"),u(e,t,s)).then((e=>f(e).then((e=>({resp:e.resp})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.sardineGetSupportedRegions=(e,t)=>this.fetch(this.url("SardineGetSupportedRegions"),u({},e,t)).then((e=>f(e).then((e=>({regions:e.regions})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.sardineGetSupportedFiatCurrencies=(e,t)=>this.fetch(this.url("SardineGetSupportedFiatCurrencies"),u({},e,t)).then((e=>f(e).then((e=>({tokens:e.tokens})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.sardineGetSupportedTokens=(e,t)=>this.fetch(this.url("SardineGetSupportedTokens"),u({},e,t)).then((e=>f(e).then((e=>({tokens:e.tokens})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.sardineGetEnabledTokens=(e,t)=>this.fetch(this.url("SardineGetEnabledTokens"),u({},e,t)).then((e=>f(e).then((e=>({tokens:e.tokens})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.sardineGetQuote=(e,t,s)=>this.fetch(this.url("SardineGetQuote"),u(e,t,s)).then((e=>f(e).then((e=>({quote:e.quote})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getSardineClientToken=(e,t)=>this.fetch(this.url("GetSardineClientToken"),u({},e,t)).then((e=>f(e).then((e=>({token:e.token})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getSardineNFTCheckoutToken=(e,t,s)=>this.fetch(this.url("GetSardineNFTCheckoutToken"),u(e,t,s)).then((e=>f(e).then((e=>({resp:e.resp})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getSardineNFTCheckoutOrderStatus=(e,t,s)=>this.fetch(this.url("GetSardineNFTCheckoutOrderStatus"),u(e,t,s)).then((e=>f(e).then((e=>({resp:e.resp})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getCoinPrices=(e,t,s)=>this.fetch(this.url("GetCoinPrices"),u(e,t,s)).then((e=>f(e).then((e=>({tokenPrices:e.tokenPrices})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getCollectiblePrices=(e,t,s)=>this.fetch(this.url("GetCollectiblePrices"),u(e,t,s)).then((e=>f(e).then((e=>({tokenPrices:e.tokenPrices})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getExchangeRate=(e,t,s)=>this.fetch(this.url("GetExchangeRate"),u(e,t,s)).then((e=>f(e).then((e=>({exchangeRate:e.exchangeRate})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.memoryStore=(e,t,s)=>this.fetch(this.url("MemoryStore"),u(e,t,s)).then((e=>f(e).then((e=>({ok:e.ok})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.memoryLoad=(e,t,s)=>this.fetch(this.url("MemoryLoad"),u(e,t,s)).then((e=>f(e).then((e=>({value:e.value})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getInviteInfo=(e,t)=>this.fetch(this.url("GetInviteInfo"),u({},e,t)).then((e=>f(e).then((e=>({inviteInfo:e.inviteInfo})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.isValidAccessCode=(e,t,s)=>this.fetch(this.url("IsValidAccessCode"),u(e,t,s)).then((e=>f(e).then((e=>({status:e.status})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.internalClaimAccessCode=(e,t,s)=>this.fetch(this.url("InternalClaimAccessCode"),u(e,t,s)).then((e=>f(e).then((e=>({status:e.status})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.blockNumberAtTime=(e,t,s)=>this.fetch(this.url("BlockNumberAtTime"),u(e,t,s)).then((e=>f(e).then((e=>({blocks:e.blocks})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.paperSessionSecret=(e,t,s)=>this.fetch(this.url("PaperSessionSecret"),u(e,t,s)).then((e=>f(e).then((e=>({secret:e.secret})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.paperSessionSecret2=(e,t,s)=>this.fetch(this.url("PaperSessionSecret2"),u(e,t,s)).then((e=>f(e).then((e=>({secret:e.secret})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.linkWallet=(e,t,s)=>this.fetch(this.url("LinkWallet"),u(e,t,s)).then((e=>f(e).then((e=>({status:e.status})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getLinkedWallets=(e,t,s)=>this.fetch(this.url("GetLinkedWallets"),u(e,t,s)).then((e=>f(e).then((e=>({linkedWallets:e.linkedWallets})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.removeLinkedWallet=(e,t,s)=>this.fetch(this.url("RemoveLinkedWallet"),u(e,t,s)).then((e=>f(e).then((e=>({status:e.status})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.generateWaaSVerificationURL=(e,t,s)=>this.fetch(this.url("GenerateWaaSVerificationURL"),u(e,t,s)).then((e=>f(e).then((e=>({nonce:e.nonce,verificationURL:e.verificationURL})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.validateWaaSVerificationNonce=(e,t,s)=>this.fetch(this.url("ValidateWaaSVerificationNonce"),u(e,t,s)).then((e=>f(e).then((e=>({walletAddress:e.walletAddress})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getSwapPrices=(e,t,s)=>this.fetch(this.url("GetSwapPrices"),u(e,t,s)).then((e=>f(e).then((e=>({swapPrices:e.swapPrices})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getSwapQuote=(e,t,s)=>this.fetch(this.url("GetSwapQuote"),u(e,t,s)).then((e=>f(e).then((e=>({swapQuote:e.swapQuote})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.listCurrencyGroups=(e,t)=>this.fetch(this.url("ListCurrencyGroups"),u({},e,t)).then((e=>f(e).then((e=>({currencyGroups:e.currencyGroups})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.addOffchainInventory=(e,t,s)=>this.fetch(this.url("AddOffchainInventory"),u(e,t,s)).then((e=>f(e).then((e=>({inventoryId:e.inventoryId})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.getOffchainInventory=(e,t,s)=>this.fetch(this.url("GetOffchainInventory"),u(e,t,s)).then((e=>f(e).then((e=>({inventory:e.inventory})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.listOffchainInventories=(e,t,s)=>this.fetch(this.url("ListOffchainInventories"),u(e,t,s)).then((e=>f(e).then((e=>({inventory:e.inventory})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.updateOffchainInventory=(e,t,s)=>this.fetch(this.url("UpdateOffchainInventory"),u(e,t,s)).then((e=>f(e).then((e=>({})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.deleteOffchainInventory=(e,t,s)=>this.fetch(this.url("DeleteOffchainInventory"),u(e,t,s)).then((e=>f(e).then((e=>({ok:e.ok})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.requestOffchainPayment=(e,t,s)=>this.fetch(this.url("RequestOffchainPayment"),u(e,t,s)).then((e=>f(e).then((e=>({payment:e.payment})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.listOffchainPayments=(e,t,s)=>this.fetch(this.url("ListOffchainPayments"),u(e,t,s)).then((e=>f(e).then((e=>({page:e.page,payments:e.payments})))),(e=>{throw m.new({cause:`fetch(): ${e.message||""}`})})),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const u=(e={},t={},s=null)=>({method:"POST",headers:o({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{}),signal:s}),f=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){let n="";throw s instanceof Error&&(n=s.message),v.new({status:e.status,cause:`JSON.parse(): ${n}: response text: ${t}`})}if(!e.ok){const e="number"==typeof s.code?s.code:0;throw(B[e]||p).new(s)}return s}));class p extends Error{constructor(e,t,s,n,r){super(s),this.name=void 0,this.code=void 0,this.message=void 0,this.status=void 0,this.cause=void 0,this.msg=void 0,this.name=e||"WebrpcError",this.code="number"==typeof t?t:0,this.message=s||`endpoint error ${this.code}`,this.msg=this.message,this.status="number"==typeof n?n:0,this.cause=r,Object.setPrototypeOf(this,p.prototype)}static new(e){return new this(e.error,e.code,e.message||e.msg,e.status,e.cause)}}class g extends p{constructor(e="WebrpcEndpoint",t=0,s="endpoint error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,g.prototype)}}class m extends p{constructor(e="WebrpcRequestFailed",t=-1,s="request failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,m.prototype)}}class w extends p{constructor(e="WebrpcBadRoute",t=-2,s="bad route",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,w.prototype)}}class y extends p{constructor(e="WebrpcBadMethod",t=-3,s="bad method",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,y.prototype)}}class b extends p{constructor(e="WebrpcBadRequest",t=-4,s="bad request",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,b.prototype)}}class v extends p{constructor(e="WebrpcBadResponse",t=-5,s="bad response",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,v.prototype)}}class E extends p{constructor(e="WebrpcServerPanic",t=-6,s="server panic",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,E.prototype)}}class I extends p{constructor(e="WebrpcInternalError",t=-7,s="internal error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,I.prototype)}}class T extends p{constructor(e="WebrpcClientDisconnected",t=-8,s="client disconnected",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,T.prototype)}}class S extends p{constructor(e="WebrpcStreamLost",t=-9,s="stream lost",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,S.prototype)}}class O extends p{constructor(e="WebrpcStreamFinished",t=-10,s="stream finished",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,O.prototype)}}class k extends p{constructor(e="Unauthorized",t=1e3,s="Unauthorized access",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,k.prototype)}}class C extends p{constructor(e="PermissionDenied",t=1001,s="Permission denied",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,C.prototype)}}class _ extends p{constructor(e="SessionExpired",t=1002,s="Session expired",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,_.prototype)}}class A extends p{constructor(e="Aborted",t=1005,s="Request aborted",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,A.prototype)}}class x extends p{constructor(e="Geoblocked",t=1006,s="Geoblocked region",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,x.prototype)}}class P extends p{constructor(e="InvalidArgument",t=2e3,s="Invalid argument",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,P.prototype)}}class N extends p{constructor(e="Unavailable",t=2002,s="Unavailable resource",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,N.prototype)}}class R extends p{constructor(e="QueryFailed",t=2003,s="Query failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,R.prototype)}}class M extends p{constructor(e="NotFound",t=3e3,s="Resource not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,M.prototype)}}let L=function(e){return e.WebrpcEndpoint="WebrpcEndpoint",e.WebrpcRequestFailed="WebrpcRequestFailed",e.WebrpcBadRoute="WebrpcBadRoute",e.WebrpcBadMethod="WebrpcBadMethod",e.WebrpcBadRequest="WebrpcBadRequest",e.WebrpcBadResponse="WebrpcBadResponse",e.WebrpcServerPanic="WebrpcServerPanic",e.WebrpcInternalError="WebrpcInternalError",e.WebrpcClientDisconnected="WebrpcClientDisconnected",e.WebrpcStreamLost="WebrpcStreamLost",e.WebrpcStreamFinished="WebrpcStreamFinished",e.Unauthorized="Unauthorized",e.PermissionDenied="PermissionDenied",e.SessionExpired="SessionExpired",e.Aborted="Aborted",e.Geoblocked="Geoblocked",e.InvalidArgument="InvalidArgument",e.Unavailable="Unavailable",e.QueryFailed="QueryFailed",e.NotFound="NotFound",e}({});const B={0:g,[-1]:m,[-2]:w,[-3]:y,[-4]:b,[-5]:v,[-6]:E,[-7]:I,[-8]:T,[-9]:S,[-10]:O,1e3:k,1001:C,1002:_,1005:A,1006:x,2e3:P,2002:N,2003:R,3e3:M},$=globalThis.fetch;class D extends d{constructor(e,t,s){super(e.endsWith("/")?e.slice(0,-1):e,$),this.projectAccessKey=t,this.jwtAuth=s,this._fetch=(e,t)=>{const s={},n=this.jwtAuth,r=this.projectAccessKey;return n&&n.length>0&&(s.Authorization=`BEARER ${n}`),r&&r.length>0&&(s["X-Access-Key"]=r),t.headers=o({},t.headers,s),$(e,t)},this.fetch=this._fetch}}var W=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"470a0f88ea399c2a57ff8c22da54358c033ed5f0",SortOrder:a,SardinePaymentType:c,SardineQuoteType:h,TokenType:l,API:d,WebrpcError:p,WebrpcEndpointError:g,WebrpcRequestFailedError:m,WebrpcBadRouteError:w,WebrpcBadMethodError:y,WebrpcBadRequestError:b,WebrpcBadResponseError:v,WebrpcServerPanicError:E,WebrpcInternalErrorError:I,WebrpcClientDisconnectedError:T,WebrpcStreamLostError:S,WebrpcStreamFinishedError:O,UnauthorizedError:k,PermissionDeniedError:C,SessionExpiredError:_,AbortedError:A,GeoblockedError:x,InvalidArgumentError:P,UnavailableError:N,QueryFailedError:R,NotFoundError:M,errors:L,SequenceAPIClient:D});const j="function"==typeof Buffer,U="function"==typeof TextDecoder?new TextDecoder:void 0,H="function"==typeof TextEncoder?new TextEncoder:void 0,q=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),F=(e=>{let t={};return e.forEach(((e,s)=>t[e]=s)),t})(q),G=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,V=String.fromCharCode.bind(String),K="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),z=e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")),J=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),Y=e=>{let t,s,n,r,i="";const o=e.length%3;for(let o=0;o<e.length;){if((s=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255||(r=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=s<<16|n<<8|r,i+=q[t>>18&63]+q[t>>12&63]+q[t>>6&63]+q[63&t]}return o?i.slice(0,o-3)+"===".substring(o):i},Q="function"==typeof btoa?e=>btoa(e):j?e=>Buffer.from(e,"binary").toString("base64"):Y,X=j?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let s=0,n=e.length;s<n;s+=4096)t.push(V.apply(null,e.subarray(s,s+4096)));return Q(t.join(""))},Z=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?V(192|t>>>6)+V(128|63&t):V(224|t>>>12&15)+V(128|t>>>6&63)+V(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return V(240|t>>>18&7)+V(128|t>>>12&63)+V(128|t>>>6&63)+V(128|63&t)},ee=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,te=e=>e.replace(ee,Z),se=j?e=>Buffer.from(e,"utf8").toString("base64"):H?e=>X(H.encode(e)):e=>Q(te(e)),ne=(e,t=!1)=>t?z(se(e)):se(e),re=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,ie=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return V(55296+(t>>>10))+V(56320+(1023&t));case 3:return V((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return V((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},oe=e=>e.replace(re,ie),ae=e=>{if(e=e.replace(/\s+/g,""),!G.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,s,n,r="";for(let i=0;i<e.length;)t=F[e.charAt(i++)]<<18|F[e.charAt(i++)]<<12|(s=F[e.charAt(i++)])<<6|(n=F[e.charAt(i++)]),r+=64===s?V(t>>16&255):64===n?V(t>>16&255,t>>8&255):V(t>>16&255,t>>8&255,255&t);return r},ce="function"==typeof atob?e=>atob(J(e)):j?e=>Buffer.from(e,"base64").toString("binary"):ae,he=j?e=>K(Buffer.from(e,"base64")):e=>K(ce(e).split("").map((e=>e.charCodeAt(0)))),le=j?e=>Buffer.from(e,"base64").toString("utf8"):U?e=>U.decode(he(e)):e=>oe(ce(e)),de=e=>J(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))),ue=e=>le(de(e)),fe=ne,pe=ue;var ge=function(){return ge=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++)for(var r in t=arguments[s])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},ge.apply(this,arguments)};function me(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))}function we(e,t){var s,n,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(s)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(o=0)),o;)try{if(s=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{s=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var ye="eth",be={name:"ETHAuth",version:"1"},ve=function(){function e(e){this.prefix=ye,this.address=(null==e?void 0:e.address)?e.address.toLowerCase():"",this.claims=(null==e?void 0:e.claims)?e.claims:{app:"",iat:0,exp:0,v:"1"},this.signature=(null==e?void 0:e.signature)?e.signature:"",this.extra=(null==e?void 0:e.extra)?e.extra:""}return e.prototype.setIssuedAtNow=function(){this.claims.iat=Math.round((new Date).getTime()/1e3)},e.prototype.setExpiryIn=function(e){this.claims.exp=Math.round((new Date).getTime()/1e3)+e},e.prototype.validateClaims=function(){return Ee(this.claims)},e.prototype.messageDigest=function(){var e,s=this.validateClaims();if(s.err)throw s.err;return t.ethers.getBytes((e=this.messageTypedData(),t.ethers.TypedDataEncoder.hash(e.domain,e.types,e.message)))},e.prototype.messageTypedData=function(){var e={domain:ge({},be),types:{Claims:[]},message:{}};return this.claims.app&&this.claims.app.length>0&&(e.types.Claims.push({name:"app",type:"string"}),e.message.app=this.claims.app),this.claims.iat&&this.claims.iat>0&&(e.types.Claims.push({name:"iat",type:"int64"}),e.message.iat=this.claims.iat),this.claims.exp&&this.claims.exp>0&&(e.types.Claims.push({name:"exp",type:"int64"}),e.message.exp=this.claims.exp),this.claims.n&&this.claims.n>0&&(e.types.Claims.push({name:"n",type:"uint64"}),e.message.n=this.claims.n),this.claims.typ&&this.claims.typ.length>0&&(e.types.Claims.push({name:"typ",type:"string"}),e.message.typ=this.claims.typ),this.claims.ogn&&this.claims.ogn.length>0&&(e.types.Claims.push({name:"ogn",type:"string"}),e.message.ogn=this.claims.ogn),this.claims.v&&this.claims.v.length>0&&(e.types.Claims.push({name:"v",type:"string"}),e.message.v=this.claims.v),e},e}(),Ee=function(e){if(""===e.app)return{ok:!1,err:new Error("claims: app is empty")};var t=Math.round((new Date).getTime()/1e3),s=31536300;return""===e.v?{ok:!1,err:new Error("claims: ethauth version is empty")}:e.iat&&0!==e.iat&&(e.iat>t+300||e.iat<t-s)?{ok:!1,err:new Error("claims: iat is invalid")}:e.exp<t-300||e.exp>t+s?{ok:!1,err:new Error("claims: token has expired")}:{ok:!0}},Ie=function(e,s,n){return me(void 0,void 0,void 0,(function(){var e,s;return we(this,(function(r){return e=n.messageDigest(),"0x"===(s=t.ethers.verifyMessage(e,n.signature)).slice(0,2)&&42===s.length&&s.toLowerCase()===n.address.toLowerCase()?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}))}))},Te=function(e,s,n){return me(void 0,void 0,void 0,(function(){var s,r,i;return we(this,(function(o){switch(o.label){case 0:return e&&void 0!==e?(s=n.messageDigest(),[4,e.getCode(n.address)]):[2,{isValid:!1}];case 1:if("0x"===(r=o.sent())||r.length<=2)throw new Error("ValidateContractAccountProof failed. unable to fetch wallet contract code");return i=["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],[4,new t.ethers.Contract(n.address,i,e).isValidSignature(s,t.ethers.getBytes(n.signature))];case 2:return o.sent()===Se?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}}))}))},Se="0x1626ba7e",Oe=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];var n=this;this.configJsonRpcProvider=function(e){return me(n,void 0,void 0,(function(){var s;return we(this,(function(n){switch(n.label){case 0:return this.provider=new t.ethers.JsonRpcProvider(e),[4,this.provider.send("net_version",[])];case 1:if(s=n.sent(),this.chainId=parseInt(s),!this.chainId)throw new Error("ethauth: unable to get chainId");return this.ethereumJsonRpcURL=e,[2]}}))}))},this.configValidators=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0==e.length)throw new Error("validators list is empty");n.validators=e},this.encodeProof=function(e,t){return void 0===t&&(t=!1),me(n,void 0,void 0,(function(){var s,n;return we(this,(function(r){switch(r.label){case 0:if(42!==e.address.length||"0x"!==e.address.slice(0,2))throw new Error("ethauth: invalid address");if(""===e.signature||"0x"!==e.signature.slice(0,2))throw new Error("ethauth: invalid signature");if(e.extra&&"0x"!==e.extra.slice(0,2))throw new Error("ethauth: invalid extra encoding, expecting hex data");return[4,this.validateProof(e,t)];case 1:if(!r.sent())throw new Error("ethauth: proof is invalid");return s=JSON.stringify(e.claims),n=ye+"."+e.address.toLowerCase()+"."+fe(s,!0)+"."+e.signature,e.extra&&e.extra.length>0&&(n+="."+e.extra),[2,n]}}))}))},this.decodeProof=function(e,t){return void 0===t&&(t=!1),me(n,void 0,void 0,(function(){var s,n,r,i,o,a,c,h,l;return we(this,(function(d){switch(d.label){case 0:if((s=e.split(".")).length<4||s.length>5)throw new Error("ethauth: invalid proof string");if(n=s[0],r=s[1],i=s[2],o=s[3],a=s[4],n!==ye)throw new Error("ethauth: not an ethauth proof");return c=pe(i),h=JSON.parse(c),l=new ve({address:r,claims:h,signature:o,extra:a}),[4,this.validateProof(l,t)];case 1:if(!d.sent())throw new Error("ethauth: proof is invalid");return[2,l]}}))}))},this.validateProof=function(e,t){return void 0===t&&(t=!1),me(n,void 0,void 0,(function(){var s;return we(this,(function(n){switch(n.label){case 0:if((s=this.validateProofClaims(e)).err)throw new Error("ethauth: proof claims are invalid ".concat(s.err));return!0===t?[3,2]:[4,this.validateProofSignature(e)];case 1:if(!0!==n.sent())throw new Error("ethauth: proof signature is invalid");n.label=2;case 2:return[2,!0]}}))}))},this.validateProofSignature=function(e){return me(n,void 0,void 0,(function(){var t,s,n;return we(this,(function(r){switch(r.label){case 0:t=[],n=0,r.label=1;case 1:if(!(n<this.validators.length))return[3,6];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,(0,this.validators[n])(this.provider,this.chainId,e)];case 3:return!0===(s=r.sent().isValid)?[2,!0]:(t.push(s),[3,5]);case 4:return r.sent(),t.push(!1),[3,5];case 5:return n++,[3,1];case 6:for(n=0;n<t.length;n++)if(t[n])return[2,!0];return[2,!1]}}))}))},this.validateProofClaims=function(e){return e.validateClaims()},0==e.length?this.validators=[Ie,Te]:this.validators=e};let ke=function(e){return e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.SEPOLIA=11155111]="SEPOLIA",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",e[e.POLYGON_AMOY=80002]="POLYGON_AMOY",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_KOVAN=69]="OPTIMISM_KOVAN",e[e.OPTIMISM_GOERLI=420]="OPTIMISM_GOERLI",e[e.OPTIMISM_SEPOLIA=11155420]="OPTIMISM_SEPOLIA",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.ARBITRUM_SEPOLIA=421614]="ARBITRUM_SEPOLIA",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.BASE=8453]="BASE",e[e.BASE_GOERLI=84531]="BASE_GOERLI",e[e.BASE_SEPOLIA=84532]="BASE_SEPOLIA",e[e.HOMEVERSE_TESTNET=40875]="HOMEVERSE_TESTNET",e[e.HOMEVERSE=19011]="HOMEVERSE",e[e.XAI=660279]="XAI",e[e.XAI_SEPOLIA=37714555429]="XAI_SEPOLIA",e[e.XR_SEPOLIA=2730]="XR_SEPOLIA",e[e.TELOS=40]="TELOS",e[e.B3=8333]="B3",e[e.B3_SEPOLIA=1993]="B3_SEPOLIA",e[e.APECHAIN=33139]="APECHAIN",e[e.APECHAIN_TESTNET=33111]="APECHAIN_TESTNET",e[e.BLAST=81457]="BLAST",e[e.BLAST_SEPOLIA=168587773]="BLAST_SEPOLIA",e[e.BORNE_TESTNET=94984]="BORNE_TESTNET",e[e.SKALE_NEBULA=1482601649]="SKALE_NEBULA",e[e.SKALE_NEBULA_TESTNET=37084624]="SKALE_NEBULA_TESTNET",e[e.SONEIUM_MINATO=1946]="SONEIUM_MINATO",e[e.TOY_TESTNET=21e6]="TOY_TESTNET",e[e.IMMUTABLE_ZKEVM=13371]="IMMUTABLE_ZKEVM",e[e.IMMUTABLE_ZKEVM_TESTNET=13473]="IMMUTABLE_ZKEVM_TESTNET",e[e.ROOT_NETWORK=7668]="ROOT_NETWORK",e[e.ROOT_NETWORK_PORCINI=7672]="ROOT_NETWORK_PORCINI",e[e.HARDHAT=31337]="HARDHAT",e[e.HARDHAT_2=31338]="HARDHAT_2",e}({}),Ce=function(e){return e.MAINNET="mainnet",e.TESTNET="testnet",e}({});const _e={[ke.MAINNET]:{chainId:ke.MAINNET,type:Ce.MAINNET,name:"mainnet",title:"Ethereum",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.MAINNET}.webp`,blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},nativeToken:{symbol:"ETH",name:"Ether",decimals:18},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[ke.ROPSTEN]:{chainId:ke.ROPSTEN,type:Ce.TESTNET,name:"ropsten",title:"Ropsten",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.ROPSTEN}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},nativeToken:{symbol:"roETH",name:"Ropsten Ether",decimals:18},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",deprecated:!0},[ke.RINKEBY]:{chainId:ke.RINKEBY,type:Ce.TESTNET,name:"rinkeby",title:"Rinkeby",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.RINKEBY}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},nativeToken:{symbol:"rETH",name:"Rinkeby Ether",decimals:18},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",deprecated:!0},[ke.GOERLI]:{chainId:ke.GOERLI,type:Ce.TESTNET,name:"goerli",title:"Goerli",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.GOERLI}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},nativeToken:{symbol:"gETH",name:"Goerli Ether",decimals:18},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",deprecated:!0},[ke.KOVAN]:{chainId:ke.KOVAN,type:Ce.TESTNET,name:"kovan",title:"Kovan",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.KOVAN}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"},nativeToken:{symbol:"kETH",name:"Kovan Ether",decimals:18},deprecated:!0},[ke.SEPOLIA]:{chainId:ke.SEPOLIA,type:Ce.TESTNET,name:"sepolia",title:"Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Sepolia)",rootUrl:"https://sepolia.etherscan.io/"},nativeToken:{symbol:"sETH",name:"Sepolia Ether",decimals:18}},[ke.POLYGON]:{chainId:ke.POLYGON,type:Ce.MAINNET,name:"polygon",title:"Polygon",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.POLYGON}.webp`,blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"},nativeToken:{symbol:"POL",name:"POL",decimals:18}},[ke.POLYGON_MUMBAI]:{chainId:ke.POLYGON_MUMBAI,type:Ce.TESTNET,name:"mumbai",title:"Polygon Mumbai",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.POLYGON_MUMBAI}.webp`,testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"},nativeToken:{symbol:"mMATIC",name:"Mumbai Polygon",decimals:18},deprecated:!0},[ke.POLYGON_AMOY]:{chainId:ke.POLYGON_AMOY,type:Ce.TESTNET,name:"amoy",title:"Polygon Amoy",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.POLYGON_AMOY}.webp`,testnet:!0,blockExplorer:{name:"OKLink (Amoy)",rootUrl:"https://www.oklink.com/amoy/"},nativeToken:{symbol:"aPOL",name:"Amoy POL",decimals:18}},[ke.POLYGON_ZKEVM]:{chainId:ke.POLYGON_ZKEVM,type:Ce.MAINNET,name:"polygon-zkevm",title:"Polygon zkEVM",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.POLYGON_ZKEVM}.webp`,blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"},nativeToken:{symbol:"ETH",name:"Ether",decimals:18}},[ke.BSC]:{chainId:ke.BSC,type:Ce.MAINNET,name:"bsc",title:"BNB Smart Chain",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.BSC}.webp`,blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"},nativeToken:{symbol:"BNB",name:"BNB",decimals:18}},[ke.BSC_TESTNET]:{chainId:ke.BSC_TESTNET,type:Ce.TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.BSC_TESTNET}.webp`,testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"},nativeToken:{symbol:"tBNB",name:"Testnet BNB",decimals:18}},[ke.OPTIMISM]:{chainId:ke.OPTIMISM,type:Ce.MAINNET,name:"optimism",title:"Optimism",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.OPTIMISM}.webp`,blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"},nativeToken:{symbol:"ETH",name:"Ether",decimals:18}},[ke.OPTIMISM_KOVAN]:{chainId:ke.OPTIMISM_KOVAN,type:Ce.TESTNET,name:"optimism-kovan",title:"Optimism Kovan",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.OPTIMISM_KOVAN}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Optimism Kovan)",rootUrl:"https://kovan-optimistic.etherscan.io/"},nativeToken:{symbol:"kETH",name:"Kovan Ether",decimals:18},deprecated:!0},[ke.OPTIMISM_GOERLI]:{chainId:ke.OPTIMISM_GOERLI,type:Ce.TESTNET,name:"optimism-goerli",title:"Optimism Goerli",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.OPTIMISM_GOERLI}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Optimism Goerli)",rootUrl:"https://goerli-optimistic.etherscan.io/"},nativeToken:{symbol:"gETH",name:"Goerli Ether",decimals:18},deprecated:!0},[ke.OPTIMISM_SEPOLIA]:{chainId:ke.OPTIMISM_SEPOLIA,type:Ce.TESTNET,name:"optimism-sepolia",title:"Optimism Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.OPTIMISM_SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Optimism Sepolia)",rootUrl:"https://sepolia-optimistic.etherscan.io/"},nativeToken:{symbol:"sETH",name:"Sepolia Ether",decimals:18}},[ke.ARBITRUM]:{chainId:ke.ARBITRUM,type:Ce.MAINNET,name:"arbitrum",title:"Arbitrum One",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.ARBITRUM}.webp`,blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"},nativeToken:{symbol:"ETH",name:"Ether",decimals:18}},[ke.ARBITRUM_GOERLI]:{chainId:ke.ARBITRUM_GOERLI,type:Ce.TESTNET,name:"arbitrum-goerli",title:"Arbitrum Goerli",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.ARBITRUM_GOERLI}.webp`,testnet:!0,blockExplorer:{name:"Arbiscan (Goerli Testnet)",rootUrl:"https://testnet.arbiscan.io/"},nativeToken:{symbol:"gETH",name:"Goerli Ether",decimals:18},deprecated:!0},[ke.ARBITRUM_SEPOLIA]:{chainId:ke.ARBITRUM_SEPOLIA,type:Ce.TESTNET,name:"arbitrum-sepolia",title:"Arbitrum Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.ARBITRUM_SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"Arbiscan (Sepolia Testnet)",rootUrl:"https://sepolia.arbiscan.io/"},nativeToken:{symbol:"sETH",name:"Sepolia Ether",decimals:18}},[ke.ARBITRUM_NOVA]:{chainId:ke.ARBITRUM_NOVA,type:Ce.MAINNET,name:"arbitrum-nova",title:"Arbitrum Nova",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.ARBITRUM_NOVA}.webp`,blockExplorer:{name:"Arbiscan Nova",rootUrl:"https://nova.arbiscan.io/"},nativeToken:{symbol:"ETH",name:"Ether",decimals:18}},[ke.AVALANCHE]:{chainId:ke.AVALANCHE,type:Ce.MAINNET,name:"avalanche",title:"Avalanche",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.AVALANCHE}.webp`,blockExplorer:{name:"Snowtrace",rootUrl:"https://subnets.avax.network/c-chain/"},nativeToken:{symbol:"AVAX",name:"AVAX",decimals:18}},[ke.AVALANCHE_TESTNET]:{chainId:ke.AVALANCHE_TESTNET,type:Ce.TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.AVALANCHE_TESTNET}.webp`,testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://subnets-test.avax.network/c-chain/"},nativeToken:{symbol:"tAVAX",name:"Testnet AVAX",decimals:18}},[ke.GNOSIS]:{chainId:ke.GNOSIS,type:Ce.MAINNET,name:"gnosis",title:"Gnosis Chain",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.GNOSIS}.webp`,blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"},nativeToken:{symbol:"XDAI",name:"XDAI",decimals:18}},[ke.BASE]:{chainId:ke.BASE,type:Ce.MAINNET,name:"base",title:"Base (Coinbase)",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.BASE}.webp`,blockExplorer:{name:"Base Explorer",rootUrl:"https://basescan.org/"},nativeToken:{symbol:"ETH",name:"Ether",decimals:18}},[ke.BASE_GOERLI]:{chainId:ke.BASE_GOERLI,type:Ce.TESTNET,name:"base-goerli",title:"Base Goerli",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.BASE_GOERLI}.webp`,testnet:!0,blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"},nativeToken:{symbol:"gETH",name:"Goerli Ether",decimals:18},deprecated:!0},[ke.BASE_SEPOLIA]:{chainId:ke.BASE_SEPOLIA,type:Ce.TESTNET,name:"base-sepolia",title:"Base Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.BASE_SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"Base Sepolia Explorer",rootUrl:"https://base-sepolia.blockscout.com/"},nativeToken:{symbol:"sETH",name:"Sepolia Ether",decimals:18}},[ke.HOMEVERSE]:{chainId:ke.HOMEVERSE,type:Ce.MAINNET,name:"homeverse",title:"Oasys Homeverse",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.HOMEVERSE}.webp`,blockExplorer:{name:"Oasys Homeverse Explorer",rootUrl:"https://explorer.oasys.homeverse.games/"},nativeToken:{symbol:"OAS",name:"OAS",decimals:18}},[ke.HOMEVERSE_TESTNET]:{chainId:ke.HOMEVERSE_TESTNET,type:Ce.TESTNET,name:"homeverse-testnet",title:"Oasys Homeverse Testnet",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.HOMEVERSE_TESTNET}.webp`,testnet:!0,blockExplorer:{name:"Oasys Homeverse Explorer (Testnet)",rootUrl:"https://explorer.testnet.oasys.homeverse.games/"},nativeToken:{symbol:"tOAS",name:"Testnet OAS",decimals:18}},[ke.XAI]:{chainId:ke.XAI,type:Ce.MAINNET,name:"xai",title:"Xai",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.XAI}.webp`,blockExplorer:{name:"Xai Explorer",rootUrl:"https://explorer.xai-chain.net/"},nativeToken:{symbol:"XAI",name:"XAI",decimals:18}},[ke.XAI_SEPOLIA]:{chainId:ke.XAI_SEPOLIA,type:Ce.TESTNET,name:"xai-sepolia",title:"Xai Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.XAI_SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"Xai Sepolia Explorer",rootUrl:"https://testnet-explorer-v2.xai-chain.net/"},nativeToken:{symbol:"sXAI",name:"Sepolia XAI",decimals:18}},[ke.XR_SEPOLIA]:{chainId:ke.XR_SEPOLIA,type:Ce.TESTNET,name:"xr-sepolia",title:"XR Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.XR_SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"XR Sepolia Explorer",rootUrl:"https://xr-sepolia-testnet.explorer.caldera.xyz/"},nativeToken:{symbol:"tXR",name:"Sepolia XR",decimals:18}},[ke.B3]:{chainId:ke.B3,type:Ce.MAINNET,name:"b3",title:"B3",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.B3}.webp`,testnet:!1,blockExplorer:{name:"B3 Explorer",rootUrl:"https://explorer.b3.fun/"},nativeToken:{symbol:"ETH",name:"Ether",decimals:18}},[ke.B3_SEPOLIA]:{chainId:ke.B3_SEPOLIA,type:Ce.TESTNET,name:"b3-sepolia",title:"B3 Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.B3_SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"B3 Sepolia Explorer",rootUrl:"https://sepolia.explorer.b3.fun/"},nativeToken:{symbol:"ETH",name:"Ether",decimals:18}},[ke.APECHAIN]:{chainId:ke.APECHAIN,type:Ce.MAINNET,name:"apechain",title:"APE Chain",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.APECHAIN}.webp`,testnet:!1,blockExplorer:{name:"APE Chain Explorer",rootUrl:"https://apechain.calderaexplorer.xyz/"},nativeToken:{symbol:"APE",name:"ApeCoin",decimals:18}},[ke.APECHAIN_TESTNET]:{chainId:ke.APECHAIN_TESTNET,type:Ce.TESTNET,name:"apechain-testnet",title:"APE Chain Testnet",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.APECHAIN_TESTNET}.webp`,testnet:!0,blockExplorer:{name:"APE Chain Explorer",rootUrl:"https://curtis.explorer.caldera.xyz/"},nativeToken:{symbol:"APE",name:"ApeCoin",decimals:18}},[ke.BLAST]:{chainId:ke.BLAST,type:Ce.MAINNET,name:"blast",title:"Blast",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.BLAST}.webp`,blockExplorer:{name:"Blast Explorer",rootUrl:"https://blastscan.io/"},nativeToken:{symbol:"ETH",name:"Ether",decimals:18}},[ke.BLAST_SEPOLIA]:{chainId:ke.BLAST_SEPOLIA,type:Ce.TESTNET,name:"blast-sepolia",title:"Blast Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.BLAST_SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"Blast Sepolia Explorer",rootUrl:"https://sepolia.blastexplorer.io/"},nativeToken:{symbol:"ETH",name:"Ether",decimals:18}},[ke.TELOS]:{chainId:ke.TELOS,type:Ce.MAINNET,name:"telos",title:"Telos",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.TELOS}.webp`,blockExplorer:{name:"Telos Explorer",rootUrl:"https://explorer.telos.net/network/"},nativeToken:{symbol:"TLOS",name:"TLOS",decimals:18}},[ke.BORNE_TESTNET]:{chainId:ke.BORNE_TESTNET,type:Ce.TESTNET,name:"borne-testnet",title:"Borne Testnet",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.BORNE_TESTNET}.webp`,testnet:!0,blockExplorer:{name:"Borne Testnet Explorer",rootUrl:"https://subnets-test.avax.network/bornegfdn"},nativeToken:{symbol:"BORNE",name:"BORNE",decimals:18}},[ke.SKALE_NEBULA]:{chainId:ke.SKALE_NEBULA,type:Ce.MAINNET,name:"skale-nebula",title:"SKALE Nebula Gaming Hub",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.SKALE_NEBULA}.webp`,testnet:!1,blockExplorer:{name:"SKALE Nebula Gaming Hub Explorer",rootUrl:"https://green-giddy-denebola.explorer.mainnet.skalenodes.com/"},nativeToken:{symbol:"sFUEL",name:"SKALE Fuel",decimals:18}},[ke.SKALE_NEBULA_TESTNET]:{chainId:ke.SKALE_NEBULA_TESTNET,type:Ce.TESTNET,name:"skale-nebula-testnet",title:"SKALE Nebula Gaming Hub Testnet",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.SKALE_NEBULA_TESTNET}.webp`,testnet:!0,blockExplorer:{name:"SKALE Nebula Gaming Hub Testnet Explorer",rootUrl:"https://lanky-ill-funny-testnet.explorer.testnet.skalenodes.com/"},nativeToken:{symbol:"sFUEL",name:"SKALE Fuel",decimals:18}},[ke.SONEIUM_MINATO]:{chainId:ke.SONEIUM_MINATO,type:Ce.TESTNET,name:"soneium-minato",title:"Soneium Minato (Testnet)",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.SONEIUM_MINATO}.webp`,testnet:!0,blockExplorer:{name:"Soneium Minato Explorer",rootUrl:"https://explorer-testnet.soneium.org/"},nativeToken:{symbol:"ETH",name:"Ether",decimals:18}},[ke.TOY_TESTNET]:{chainId:ke.TOY_TESTNET,type:Ce.TESTNET,name:"toy-testnet",title:"TOY (Testnet)",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.TOY_TESTNET}.webp`,testnet:!0,blockExplorer:{name:"TOY Testnet Explorer",rootUrl:"https://toy-chain-testnet.explorer.caldera.xyz/"},nativeToken:{symbol:"TOY",name:"TOY",decimals:18}},[ke.IMMUTABLE_ZKEVM]:{chainId:ke.IMMUTABLE_ZKEVM,type:Ce.MAINNET,name:"immutable-zkevm",title:"Immutable zkEVM",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.IMMUTABLE_ZKEVM}.webp`,testnet:!1,blockExplorer:{name:"Immutable zkEVM Explorer",rootUrl:"https://explorer.immutable.com/"},nativeToken:{symbol:"IMX",name:"IMX",decimals:18}},[ke.IMMUTABLE_ZKEVM_TESTNET]:{chainId:ke.IMMUTABLE_ZKEVM_TESTNET,type:Ce.TESTNET,name:"immutable-zkevm-testnet",title:"Immutable zkEVM Testnet",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.IMMUTABLE_ZKEVM_TESTNET}.webp`,testnet:!0,blockExplorer:{name:"Immutable zkEVM Testnet Explorer",rootUrl:"https://explorer.testnet.immutable.com/"},nativeToken:{symbol:"IMX",name:"IMX",decimals:18}},[ke.ROOT_NETWORK]:{chainId:ke.ROOT_NETWORK,type:Ce.MAINNET,name:"rootnet",title:"The Root Network",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.ROOT_NETWORK}.webp`,testnet:!1,blockExplorer:{name:"The Root Network Explorer",rootUrl:"https://rootscan.io/"},nativeToken:{symbol:"XRP",name:"XRP",decimals:18}},[ke.ROOT_NETWORK_PORCINI]:{chainId:ke.ROOT_NETWORK_PORCINI,type:Ce.TESTNET,name:"rootnet-porcini",title:"The Root Network Porcini Testnet",logoURI:`https://assets.sequence.info/images/networks/medium/${ke.ROOT_NETWORK_PORCINI}.webp`,testnet:!0,blockExplorer:{name:"The Root Network Porcini Testnet Explorer",rootUrl:"https://porcini.rootscan.io/"},nativeToken:{symbol:"XRP",name:"XRP",decimals:18}},[ke.HARDHAT]:{chainId:ke.HARDHAT,name:"hardhat",title:"Hardhat (local testnet)",nativeToken:{symbol:"ETH",name:"Ether",decimals:18}},[ke.HARDHAT_2]:{chainId:ke.HARDHAT_2,name:"hardhat2",title:"Hardhat (local testnet)",nativeToken:{symbol:"ETH",name:"Ether",decimals:18}}};const Ae=e=>"number"==typeof e?e:e.chainId?e.chainId:Number(e),xe=(e,t=!1,s=!1)=>{if(!e)throw new Error("invalid network config: empty config");const n=[];if(Array.isArray(e)?n.push(...e):n.push(e),0===n.length){if(t)throw new Error("invalid network config: empty config");return!1}const r=n.map((e=>e.chainId)).sort(),i=r.filter(((e,t)=>r.indexOf(e)!==t));if(i.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${i}`);return!1}n.forEach((e=>e.name=e.name.toLowerCase()));const o=n.map((e=>e.name)).sort(),a=o.filter(((e,t)=>o.indexOf(e)!==t));if(a.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${a}`);return!1}let c=!1;for(let e=0;e<n.length;e++){const r=n[e];if(!(r.rpcUrl&&""!==r.rpcUrl||r.provider)){if(t)throw new Error(`invalid network config for chainId ${r.chainId}: rpcUrl or provider must be provided`);return!1}if(!s&&!r.relayer){if(t)throw new Error(`invalid network config for chainId ${r.chainId}: relayer must be provided`);return!1}if(r.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${r.chainId}: DefaultChain is already set by another config`);return!1}c=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}return!0},Pe=(e,t=!1)=>(xe(e,!0,t),e),Ne=e=>Pe(Me(e)),Re=(e,t)=>{if("string"==typeof t){if(t.startsWith("0x")){const s=Number(t);return e.find((e=>e.chainId===s))}return e.find((e=>e.name===t||`${e.chainId}`===t))}if("number"==typeof t)return e.find((e=>e.chainId===t));if(t.chainId)return e.find((e=>e.chainId===t.chainId));if("bigint"==typeof t){const s=Number(t);return e.find((e=>e.chainId===s))}},Me=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),s=t.findIndex((e=>e.isDefaultChain));return s>0&&t.splice(0,0,t.splice(s,1)[0]),t},Le=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,s){let n=t[s];return n="function"==typeof n?n():null==n?"":"object"==typeof n||"symbol"==typeof n?n.toString():n.valueOf(),n}))):"",Be=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),$e=e=>null!=e&&("number"==typeof e&&e%1==0||"string"==typeof e&&!!e.match(/^-?[0-9]+$/)||t.ethers.isHexString(e)||"bigint"==typeof e),De=e=>{const t=e.toString(16);return`${t.length%2==0?"0x":"0x0"}${t}`},We=(e,t=18)=>{let[s,n="0"]=e.split(".");const r=s.startsWith("-");if(r&&(s=s.slice(1)),n=n.replace(/(0+)$/,""),0===t)s=`${Math.round(Number(`${s}.${n}`))}`,n="";else if(n.length>t){const[e,r,i]=[n.slice(0,t-1),n.slice(t-1,t),n.slice(t)],o=Math.round(Number(`${r}.${i}`));n=o>9?`${BigInt(e)+1n}0`.padStart(e.length+1,"0"):`${e}${o}`,n.length>t&&(n=n.slice(1),s=`${BigInt(s)+1n}`),n=n.slice(0,t)}else n=n.padEnd(t,"0");return BigInt(`${r?"-":""}${s}${n}`)},je=(e,t=18)=>{let s=e.toString();const n=s.startsWith("-");n&&(s=s.slice(1)),s=s.padStart(t,"0");const r=s.slice(0,s.length-t);let i=s.slice(s.length-t);return i=i.replace(/(0+)$/,""),`${n?"-":""}${r||"0"}${i?`.${i}`:""}`},Ue=(e,t)=>"bigint"==typeof t?{$bigint:t.toString()}:t,He=(e,s)=>null!==s&&"object"==typeof s&&"$bigint"in s&&"string"==typeof s.$bigint?BigInt(s.$bigint):null!==s&&"object"==typeof s&&"BigNumber"===s.type&&t.ethers.isHexString(s.hex)?BigInt(s.hex):s,qe=e=>fe(JSON.stringify(e,Ue),!0),Fe=e=>{if(null!=e)return JSON.parse(pe(e),He)},Ge=e=>"string"==typeof e?t.ethers.getBytes(t.ethers.id(e)):t.ethers.getBytes(t.ethers.keccak256(e)),Ve=(e,s,n)=>t.ethers.solidityPacked(["string","uint256","address","bytes32"],["",s,e,n]),Ke=(e,s,n)=>t.ethers.keccak256(Ve(e,s,n)),ze=()=>!1,Je=e=>{const t=e.split(".");if(3!==t.length)throw new Error("invalid jwt");return JSON.parse(pe(t[1]))};var Ye=function(e){return e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.DISABLED=5]="DISABLED",e}(Ye||{});class Qe{constructor(e){this.config=e,this.logLevel=void 0,this.configure(e)}configure(e){switch(this.config=o({},this.config,e),this.config.logLevel){case"DEBUG":this.logLevel=Ye.DEBUG;break;case"INFO":default:this.logLevel=Ye.INFO;break;case"WARN":this.logLevel=Ye.WARN;break;case"ERROR":this.logLevel=Ye.ERROR;break;case"DISABLED":this.logLevel=Ye.DISABLED}void 0===this.config.silence&&(this.config.silence=!1)}debug(e,...t){!0!==this.config.silence&&this.logLevel===Ye.DEBUG&&console.log(e,...t)}info(e,...t){!0!==this.config.silence&&this.logLevel<=Ye.INFO&&console.log(e,...t)}warn(e,...t){!0!==this.config.silence&&this.logLevel<=Ye.WARN&&(console.warn(e,...t),this.config.onwarn&&this.config.onwarn(e,t))}error(e,...t){!0!==this.config.silence&&this.logLevel<=Ye.ERROR&&(console.error(e,...t),this.config.onerror&&this.config.onerror(e,t))}}const Xe=new Qe({logLevel:"INFO",silence:!0});class Ze{static bufferIndexOf(e,t,s=!1){if(s)return Ze.binarySearch(e,t,Ze.compare);return Ze.linearSearch(e,t,((e,t)=>{if(e===t)return!0;if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}))}static binarySearch(e,t,s){let n=0,r=e.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),o=s(e[i],t);if(0===o){for(let n=i-1;n>=0;n--)if(0!==s(e[n],t))return n+1;return 0}o<0?n=i+1:r=i-1}return-1}static compare(e,t){const s=Math.min(e.length,t.length);for(let n=0;n<s;n++)if(e[n]!==t[n])return e[n]-t[n];return e.length-t.length}static linearSearch(e,t,s){for(let n=0;n<e.length;n++)if(s(e[n],t))return n;return-1}static bufferify(e){return"string"==typeof e?t.ethers.getBytes(e):e}static isHexString(e){return"string"==typeof e&&/^(0x)?[0-9A-Fa-f]*$/.test(e)}static bufferToHex(e,s=!0){const n=t.ethers.hexlify(e);return s?n:n.substring(2)}static bufferifyFn(e){return t=>Ze.bufferify(e(t))}}class et extends Ze{constructor(e,s={}){super(),this.hashFn=void 0,this.leaves=[],this.layers=[],this.sortLeaves=!1,this.sortPairs=!1,this.sortLeaves=!!s.sortLeaves,this.sortPairs=!!s.sortPairs,this.hashFn=Ze.bufferifyFn(t.ethers.keccak256),this.processLeaves(e)}getOptions(){return{sortLeaves:this.sortLeaves,sortPairs:this.sortPairs}}processLeaves(e){this.leaves=e.map(Ze.bufferify),this.sortLeaves&&(this.leaves=this.leaves.sort(Ze.compare)),this.createHashes(this.leaves)}createHashes(e){for(this.layers=[e];e.length>1;){const s=this.layers.length;this.layers.push([]);const n=e.length;for(let r=0;r<e.length;r+=2){if(r>=n){this.layers[s].push(...e.slice(n));break}if(r+1===e.length&&e.length%2==1){this.layers[s].push(e[r]);continue}const i=e[r],o=[i,r+1===e.length?i:e[r+1]];this.sortPairs&&o.sort(Ze.compare);const a=this.hashFn(t.ethers.concat(o));this.layers[s].push(a)}e=this.layers[s]}}getRoot(){return 0===this.layers.length?Uint8Array.from([]):this.layers[this.layers.length-1][0]||Uint8Array.from([])}getHexRoot(){return Ze.bufferToHex(this.getRoot())}getProof(e,t){if(void 0===e)throw new Error("leaf is required");e=Ze.bufferify(e);const s=[];if(!Number.isInteger(t)){t=-1;for(let s=0;s<this.leaves.length;s++)0===Ze.compare(e,this.leaves[s])&&(t=s)}if(t<=-1)return[];for(let e=0;e<this.layers.length;e++){const n=this.layers[e],r=t%2,i=r?t-1:t+1;i<n.length&&s.push({position:r?"left":"right",data:n[i]}),t=t/2|0}return s}getHexProof(e,t){return this.getProof(e,t).map((e=>Ze.bufferToHex(e.data)))}verify(e,s,n){let r=Ze.bufferify(s);if(n=Ze.bufferify(n),!Array.isArray(e)||!s||!n)return!1;for(let s=0;s<e.length;s++){const n=e[s];let i,o;if("string"==typeof n)i=Ze.bufferify(n),o=!0;else{if(!(n instanceof Object))throw new Error("Expected node to be of type string or object");i=n.data,o="left"===n.position}const a=[];this.sortPairs?(Ze.compare(r,i)<0?a.push(r,i):a.push(i,r),r=this.hashFn(t.ethers.concat(a))):(a.push(r),a[o?"unshift":"push"](i),r=this.hashFn(t.ethers.concat(a)))}return 0===Ze.compare(r,n)}}const tt=(e,s,n)=>{const r=new t.ethers.FetchRequest(e);return n&&r.setHeader("Authorization",`BEARER ${n}`),s&&r.setHeader("X-Access-Key",s),r};function st(e,t){return"object"!=typeof t||null===t||Array.isArray(t)?t:Object.fromEntries(Object.entries(t).sort())}const nt=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\d.]+/);return t&&t.length>0?t[0].trim():""},rt=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\w\s\d]+/);return t&&t.length>0?t[0].trim():""},it=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\w\d.\-:\/]+/);return t&&t.length>0?t[0].trim():""},ot=e=>{const s=o({},e.types);return delete s.EIP712Domain,t.ethers.TypedDataEncoder.hash(e.domain,s,e.message)},at=e=>t.ethers.getBytes(ot(e)),{defineProperties:ct,resolveProperties:ht}=t.ethers,lt=e=>Le("https://${network}-indexer.sequence.app",{network:e}),dt=e=>Le("https://${network}-relayer.sequence.app",{network:e}),ut=e=>Le("https://nodes.sequence.app/${network}",{network:e});function ft(e){return Re(wt,e)}function pt(e){return"bigint"==typeof e?e:$e(e)?BigInt(e):BigInt(e.chainId)}const gt=(e,t)=>{const s=_e[e];if(!s)throw new Error(`Network with chainId ${e} not found`);const n=ut(s.name);return o({},s,{rpcUrl:n,indexerUrl:lt(s.name),relayer:{url:dt(s.name),provider:{url:n}}},t)},mt=[o({},_e[ke.HARDHAT],{rpcUrl:"http://localhost:8545",relayer:{url:"http://localhost:3000",provider:{url:"http://localhost:8545"}}}),o({},_e[ke.HARDHAT_2],{rpcUrl:"http://localhost:9545",relayer:{url:"http://localhost:3000",provider:{url:"http://localhost:9545"}}})],wt=Ne([o({},gt(ke.POLYGON),{isDefaultChain:!0,isAuthChain:!0}),gt(ke.MAINNET),gt(ke.BSC),gt(ke.AVALANCHE),gt(ke.ARBITRUM),gt(ke.ARBITRUM_NOVA),gt(ke.OPTIMISM),gt(ke.OPTIMISM_SEPOLIA),gt(ke.POLYGON_ZKEVM),gt(ke.GNOSIS),gt(ke.RINKEBY,{disabled:!0}),gt(ke.GOERLI,{disabled:!0}),gt(ke.SEPOLIA),gt(ke.POLYGON_MUMBAI,{disabled:!0}),gt(ke.POLYGON_AMOY),gt(ke.BSC_TESTNET),gt(ke.ARBITRUM_SEPOLIA),gt(ke.BASE),gt(ke.BASE_SEPOLIA),gt(ke.HOMEVERSE),gt(ke.HOMEVERSE_TESTNET),gt(ke.XAI),gt(ke.XAI_SEPOLIA),gt(ke.AVALANCHE_TESTNET),gt(ke.XR_SEPOLIA),gt(ke.B3),gt(ke.B3_SEPOLIA),gt(ke.APECHAIN),gt(ke.APECHAIN_TESTNET),gt(ke.BLAST),gt(ke.BLAST_SEPOLIA),gt(ke.TELOS),gt(ke.BORNE_TESTNET),gt(ke.SKALE_NEBULA),gt(ke.SKALE_NEBULA_TESTNET),gt(ke.SONEIUM_MINATO),gt(ke.TOY_TESTNET),gt(ke.IMMUTABLE_ZKEVM),gt(ke.IMMUTABLE_ZKEVM_TESTNET),gt(ke.ROOT_NETWORK),gt(ke.ROOT_NETWORK_PORCINI),...mt]);class yt{constructor(e,t){this.sender=void 0,this.handler=void 0,this.sender=t,e&&this.setMiddleware(e)}setMiddleware(e){this.handler=bt(e,this.sender)}request(e){return this.handler.request(e)}}const bt=(e,t)=>{if(0===e.length)return t;const s=e=>e.requestHandler?e.requestHandler:e;let n;n=s(e[e.length-1])(t.request);for(let t=e.length-2;t>=0;t--)n=s(e[t])(n);return{request:n}};function vt(e){return void 0!==e&&void 0!==e.send&&void 0!==e.constructor.defaultUrl&&void 0!==e.detectNetwork&&void 0!==e.getSigner&&void 0!==e.perform}function Et(e){return void 0!==e&&void 0!==e.send}class It{constructor(e,t){this.provider=void 0,this.defaultChainId=void 0,this.request=e=>(e.chainId||(e.chainId=this.defaultChainId),this.provider(e)),Et(e)?this.provider=t=>e.send(t.method,t.params,t.chainId):vt(e)?this.provider=t=>e.send(t.method,t.params||[]):this.provider=e,this.defaultChainId=t}send(e,t,s){const n={method:e,params:t,chainId:s};return this.request(n)}}const Tt=e=>t=>s=>{if(!e(s))throw new Error("allowProvider middleware precondition is unmet.");return t(s)};class St{constructor(e){var t=this;this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cachableJsonRpcMethodsByBlock=["eth_call","eth_getCode"],this.cache=void 0,this.cacheByBlock=void 0,this.cacheByBlockResetLock=!1,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.requestHandler=e=>async function(s){if(t.cachableJsonRpcMethods.includes(s.method)||t.cachableJsonRpcMethodsByBlock.includes(s.method)){const e=t.cacheKey(s.method,s.params,s.chainId||t.defaultChainId),n=t.getCacheValue(e);if(n&&""!==n)return{id:s.id,result:n}}const n=await e(s);if((t.cachableJsonRpcMethods.includes(s.method)||t.cachableJsonRpcMethodsByBlock.includes(s.method))&&n&&t.shouldCacheResponse(s,n)){const e=t.cacheKey(s.method,s.params,s.chainId||t.defaultChainId);t.cachableJsonRpcMethods.includes(s.method)?t.setCacheValue(e,n):t.setCacheByBlockValue(e,n)}return n},this.cacheKey=(e,t,s)=>{let n="";return n=s?`${s}:${e}:`:`:${e}:`,t&&0!==t.length?n+JSON.stringify(t):n+"[]"},this.getCache=()=>this.cache,this.setCache=e=>{this.cache=e,this.onUpdateCallback&&this.onUpdateCallback()},this.getCacheValue=e=>this.cache[e]?this.cache[e]:this.cacheByBlock[e]?this.cacheByBlock[e]:void 0,this.setCacheValue=(e,t)=>{this.cache[e]=t,this.onUpdateCallback&&this.onUpdateCallback(e,t)},this.setCacheByBlockValue=(e,t)=>{this.cacheByBlock[e]=t,this.cacheByBlockResetLock||(this.cacheByBlockResetLock=!0,setTimeout((()=>{this.cacheByBlockResetLock=!1,this.cacheByBlock={}}),1500))},this.shouldCacheResponse=(e,t)=>!!t&&!("eth_getCode"===e.method&&t.length<=2),this.clearCache=()=>{this.cache={},this.cacheByBlock={}},this.cache={},this.cacheByBlock={},this.defaultChainId=null==e?void 0:e.defaultChainId,null!=e&&e.blockCache?!0!==(null==e?void 0:e.blockCache)&&(this.cachableJsonRpcMethodsByBlock=null==e?void 0:e.blockCache):this.cachableJsonRpcMethodsByBlock=[]}onUpdate(e){this.onUpdateCallback=e}}class Ot{constructor(e){var s=this;this.options=void 0,this.requestHandler=e=>async function(n){switch(n.method){case"net_version":if(s.options.chainId)return`${s.options.chainId}`;break;case"eth_chainId":if(s.options.chainId)return t.ethers.toQuantity(s.options.chainId);break;case"eth_accounts":if(s.options.accountAddress)return[t.ethers.getAddress(s.options.accountAddress)];break;case"sequence_getWalletContext":if(s.options.walletContext)return s.options.walletContext}return e(n)},this.options=e}}const kt=e=>async t=>{try{return await e(t)}catch(e){throw"string"==typeof e?new Error(e):new Error(e.message)}},Ct=e=>async t=>{const s=t.chainId?` chainId:${t.chainId}`:"";Xe.info(`[provider request]${s} id:${t.id} method:${t.method} params:`,t.params);try{const n=await e(t);return Xe.info(`[provider response]${s} id:${t.id} method:${t.method} params:`,t.params,"result:",n),n}catch(e){Xe.warn(`[provider response]${s} id:${t.id} method:${t.method} params:`,t.params,"error:",e)}},_t=["personal_sign","eth_sign","eth_signTypedData","eth_signTypedData_v4","eth_sendTransaction","eth_sendRawTransaction","sequence_sign","sequence_signTypedData_v4","sequence_getWalletContext","sequence_getWalletConfig","sequence_getWalletState","sequence_getNetworks","sequence_updateConfig","sequence_publishConfig","sequence_gasRefundOptions","sequence_getNonce","sequence_relay","eth_decrypt","eth_getEncryptionPublicKey","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];class At{constructor(){var e=this;this.singleflightJsonRpcMethods=["eth_chainId","net_version","eth_call","eth_getCode","eth_blockNumber","eth_getBalance","eth_getStorageAt","eth_getTransactionCount","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_getBlockByHash","eth_getBlockByNumber","eth_getTransactionByHash","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionReceipt","eth_getUncleByBlockHashAndIndex","eth_getUncleByBlockNumberAndIndex","eth_getLogs"],this.inflight=void 0,this.requestHandler=t=>async function(s){if(!e.singleflightJsonRpcMethods.includes(s.method))return t(s);const n=e.requestKey(s.method,s.params||[],s.chainId);if(e.inflight[n])return new Promise(((t,r)=>{e.inflight[n].push({id:s.id,callback:(e,s)=>{e?r(e):t(s)}})}));e.inflight[n]=[];try{const r=await t(s);return e.inflight[n].forEach((({callback:e})=>e(void 0,r))),r}catch(t){throw e.inflight[n].forEach((({callback:e})=>e(t,void 0))),t}finally{delete e.inflight[n]}},this.requestKey=(e,t,s)=>{let n="";return n=s?`${s}:${e}:`:`:${e}:`,t&&0!==t.length?n+JSON.stringify(t):n+"[]"},this.inflight={}}}function xt(e,t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Pt=0;function Nt(e){return"__private_"+Pt+++"_"+e}var Rt=Nt("chainId"),Mt=Nt("nextId"),Lt=Nt("sender");class Bt extends t.ethers.JsonRpcProvider{constructor(e,s,n){var r;super(e,null==s?void 0:s.chainId,n),r=this,this.url=e,Object.defineProperty(this,Rt,{writable:!0,value:void 0}),Object.defineProperty(this,Mt,{writable:!0,value:1}),Object.defineProperty(this,Lt,{writable:!0,value:void 0}),this.fetch=async function(e){if(void 0===r.url)throw new Error("missing provider URL");const{method:s,params:n}=e,i={method:s,params:n,id:xt(r,Mt)[Mt]++,jsonrpc:"2.0"},o="string"==typeof r.url?new t.ethers.FetchRequest(r.url):r.url;o.body=JSON.stringify(i);try{const e=await o.send();if(e.body)try{return function(e){if(e.error){const t=new Error(e.error.message);throw t.code=e.error.code,t.data=e.error.data,t}return e.result}(JSON.parse(t.ethers.toUtf8String(e.body)))}catch(e){throw new Error("invalid JSON response")}return null}catch(e){throw e}};const i=null==s?void 0:s.chainId,o=null==s?void 0:s.middlewares,a=null==s?void 0:s.blockCache;xt(this,Rt)[Rt]=i;const c=new yt(null!=o?o:[new Ot({chainId:i}),new At,new St({defaultChainId:i,blockCache:a})],new It(this.fetch,i));xt(this,Lt)[Lt]=c}async request(e){return xt(this,Lt)[Lt].request(e)}async send(e,t,s){return this.request({method:e,params:t,chainId:s})}async getNetwork(){const e=xt(this,Rt)[Rt];if(e){const s=_e[e],n=(null==s?void 0:s.name)||"",r=null==s?void 0:s.ensAddress;return t.ethers.Network.from({name:n,chainId:e,ensAddress:r})}{const e=await this.send("eth_chainId",[]);return xt(this,Rt)[Rt]=Number(e),this.getNetwork()}}}function $t(e){return t.ethers.solidityPackedKeccak256(["bytes","uint256","address","bytes32"],["0x1901",e.chainId,e.address,e.digest])}function Dt(e){return void 0!==e.digest&&void 0!==e.chainId&&void 0!==e.address}var Wt=Object.freeze({__proto__:null,subdigestOf:$t,isSignedPayload:Dt});const jt=[{inputs:[{internalType:"bytes32",type:"bytes32"},{internalType:"bytes",type:"bytes"}],name:"isValidSignature",outputs:[{internalType:"bytes4",type:"bytes4"}],stateMutability:"view",type:"function"}];async function Ut(e,s,n,r){const i=new t.ethers.Contract(e,jt,r);return"0x1626ba7e"===await i.isValidSignature(s,n)}var Ht=Object.freeze({__proto__:null,isValidEIP1271Signature:Ut});let qt=function(e){return e[e.EIP712=1]="EIP712",e[e.ETH_SIGN=2]="ETH_SIGN",e[e.WALLET_BYTES32=3]="WALLET_BYTES32",e}({});function Ft(e){const s=t.ethers.getBytes(e),n=s[s.length-1];return n===qt.EIP712||n===qt.ETH_SIGN}function Gt(e,s){const n=t.ethers.getBytes(s),r=t.ethers.getBytes(e),i=n[n.length-1],o={r:t.ethers.hexlify(n.slice(0,32)),s:t.ethers.hexlify(n.slice(32,64)),v:Number(t.ethers.hexlify(n.slice(64,65)))};if(i===qt.EIP712)return t.ethers.recoverAddress(r,o);if(i===qt.ETH_SIGN)return t.ethers.recoverAddress(t.ethers.hashMessage(r),o);throw new Error(`Unsupported signature type: ${i}`)}function Vt(e,s,n,r){const i=t.ethers.getBytes(n),o=i[i.length-1];if(o===qt.EIP712||o===qt.ETH_SIGN)return e===Gt(s,n);if(o===qt.WALLET_BYTES32)return Ut(e,t.ethers.hexlify(s),i.slice(0,-1),r);throw new Error(`Unsupported signature type: ${o}`)}function Kt(e,s){const n=t.ethers.getBytes(s);if(66===n.length)try{return Gt(e,n)}catch(e){}}var zt=Object.freeze({__proto__:null,SigType:qt,canRecover:Ft,recoverSigner:Gt,isValidSignature:Vt,tryRecoverSigner:Kt});let Jt=function(e){return e[e.EOASignature=0]="EOASignature",e[e.Address=1]="Address",e[e.DynamicSignature=2]="DynamicSignature",e}({});function Yt(e){return void 0!==e.address&&!Qt(e)}function Qt(e){return void 0!==e.signature&&void 0!==e.weight&&void 0!==e.isDynamic}function Xt(e){return void 0!==e.threshold&&void 0!==e.signers}function Zt(e){const s=t.ethers.getBytes(e),n=s[0]<<8|s[1],r=[];for(let e=2;e<s.length;){const n=s[e++],i=s[e++];switch(n){case Jt.EOASignature:r.push({unrecovered:!0,weight:i,signature:t.ethers.hexlify(s.slice(e,e+66)),isDynamic:!1}),e+=66;break;case Jt.Address:r.push({weight:i,address:t.ethers.getAddress(t.ethers.hexlify(s.slice(e,e+20)))}),e+=20;break;case Jt.DynamicSignature:const o=t.ethers.getAddress(t.ethers.hexlify(s.slice(e,e+20)));e+=20;const a=s[e]<<8|s[e+1];e+=2,r.push({unrecovered:!0,weight:i,signature:t.ethers.hexlify(s.slice(e,e+a)),address:o,isDynamic:!0}),e+=a;break;default:throw new Error(`Unknown signature part type: ${n}`)}}return{version:1,threshold:n,signers:r}}function es(e){if(t.ethers.isBytesLike(e))return t.ethers.hexlify(e);const{signers:s,threshold:n}=Xt(e)?e:e.config,r=s.map((e=>{if(Yt(e))return t.ethers.solidityPacked(["uint8","uint8","address"],[Jt.Address,e.weight,e.address]);if(e.isDynamic){const s=t.ethers.getBytes(e.signature);return t.ethers.solidityPacked(["uint8","uint8","address","uint16","bytes"],[Jt.DynamicSignature,e.weight,e.address,s.length,s])}return t.ethers.solidityPacked(["uint8","uint8","bytes"],[Jt.EOASignature,e.weight,e.signature])}));return t.ethers.solidityPacked(["uint16",...new Array(r.length).fill("bytes")],[n,...r])}async function ts(e,t,s){const n=$t(t),r=await Promise.all(e.signers.map((async e=>{if(Yt(e))return e;if(e.isDynamic){if(!e.address)throw new Error("Dynamic signature part must have address");if(!Vt(e.address,n,e.signature,s))throw new Error(`Invalid dynamic signature part ${e.address}`);return{address:e.address,weight:e.weight,signature:e.signature}}return{address:Gt(n,e.signature),weight:e.weight,signature:e.signature}})));return{version:1,payload:t,subdigest:n,config:{version:1,threshold:e.threshold,signers:r}}}function ss(e,s,n,r){if(0!==n.length)throw new Error("Explicit subdigests not supported on v1");let i=0n;const a=e.signers.map((e=>{if(!s.has(e.address))return e;const n=s.get(e.address),r=t.ethers.getBytes(n.signature);return i+=BigInt(e.weight),n.isDynamic||66!==r.length?o({},e,{isDynamic:!0,signature:n.signature,address:e.address}):o({},e,{isDynamic:!1,signature:n.signature})}));return{encoded:es({version:1,threshold:e.threshold,signers:a}),weight:i}}const ns={decode:e=>Zt(e),encode:e=>es(e),trim:async e=>e,supportsNoChainId:!0,recover:(e,t,s)=>ts(e,t,s),encodeSigners:(e,t,s,n)=>ss(e,t,s),hasEnoughSigningPower:(e,t)=>{const{weight:s}=ns.encodeSigners(e,t,[],0);return s>=BigInt(e.threshold)},chainSignatures:(e,t)=>{throw new Error("Signature chaining not supported on v1")},hashSetImageHash:function(e){throw new Error("Image hash not supported on v1")},signaturesOf:e=>e.signers.filter((e=>void 0!==e.signature)).map((e=>({address:e.address,signature:e.signature}))),signaturesOfDecoded:function(e){return e.signers.map((e=>e.signature)).filter((e=>void 0!==e))}};var rs=Object.freeze({__proto__:null,SignaturePartType:Jt,isAddressMember:Yt,isUnrecoveredSignatureMember:Qt,isUnrecoveredSignature:Xt,decodeSignature:Zt,encodeSignature:es,recoverSignature:ts,encodeSigners:ss,SignatureCoder:ns});const is={isWalletConfig:e=>1===e.version&&void 0!==e.threshold&&void 0!==e.signers,imageHashOf:e=>e.signers.reduce(((e,s)=>t.ethers.keccak256(t.ethers.AbiCoder.defaultAbiCoder().encode(["bytes32","uint8","address"],[e,s.weight,s.address]))),t.ethers.solidityPacked(["uint256"],[e.threshold])),hasSubdigest:(e,t)=>!1,isComplete:e=>!0,checkpointOf:e=>0n,signersOf:e=>e.signers.map((e=>({address:e.address,weight:Number(e.weight)}))),fromSimple:e=>{if(0n!==BigInt(e.checkpoint))throw new Error("v1 wallet config does not support checkpoint");if(e.subdigests&&e.subdigests.length>0)throw new Error("v1 wallet config does not support subdigests");return{version:1,threshold:e.threshold,signers:e.signers}},update:{isKindUsed:!0,buildTransaction:(e,s,n,i)=>{const o=new t.ethers.Interface([...r.mainModule.abi,...r.mainModuleUpgradable.abi]),a=[];return i&&"first"!==i||a.push({to:e,data:o.encodeFunctionData(o.getFunction("updateImplementation"),[n.mainModuleUpgradable]),gasLimit:0,delegateCall:!1,revertOnError:!0,value:0}),a.push({to:e,data:o.encodeFunctionData(o.getFunction("updateImageHash"),[is.imageHashOf(s)]),gasLimit:0,delegateCall:!1,revertOnError:!0,value:0}),{entrypoint:e,transactions:a}},decodeTransaction:function(e){throw new Error("Function not implemented.")}},toJSON:function(e){const t=e.signers.map((e=>({weight:BigInt(e.weight).toString(),address:e.address})));return JSON.stringify({version:e.version,threshold:BigInt(e.threshold).toString(),signers:t})},fromJSON:function(e){const t=JSON.parse(e),s=t.signers.map((e=>({weight:BigInt(e.weight),address:e.address})));return{version:t.version,threshold:BigInt(t.threshold),signers:s}},editConfig:function(e,t){var s;const n=e.signers.slice();if(t.checkpoint&&0n!==BigInt(t.checkpoint))throw new Error("v1 wallet config does not support checkpoint");if(t.add)for(const e of t.add)n.find((t=>t.address===e.address))||n.push({weight:e.weight,address:e.address});if(t.remove)for(const e of t.remove){const t=n.findIndex((t=>t.address===e));t>=0&&n.splice(t,1)}return{version:e.version,threshold:null!=(s=t.threshold)?s:e.threshold,signers:n}},buildStubSignature:function(e,t){const s=new Map;for(const[n,r]of t.entries()){s.set(n,{signature:r,isDynamic:!0});const{encoded:t,weight:i}=ss(e,s,[]);if(i>=BigInt(e.threshold))return t}const n=e.signers;for(const{address:t}of n.sort((({weight:e},{weight:t})=>Number(e)-Number(t)))){const n="0x4e82f02f388a12b5f9d29eaf2452dd040c0ee5804b4e504b4dd64e396c6c781f2c7624195acba242dd825bfd25a290912e3c230841fd55c9a734c4de8d9899451b02";s.set(t,{signature:n,isDynamic:!1});const{encoded:r,weight:i}=ss(e,s,[]);if(i>=BigInt(e.threshold))return r}return ss(e,s,[]).encoded}};var os=Object.freeze({__proto__:null,ConfigCoder:is}),as=Object.freeze({__proto__:null});const cs={version:1,factory:"0xf9D09D634Fb818b05149329C1dcCFAeA53639d96",guestModule:"0x02390F3E6E5FD1C6786CB78FD3027C117a9955A7",mainModule:"0xd01F11855bCcb95f88D7A48492F66410d4637313",mainModuleUpgradable:"0x7EFE6cE415956c5f80C6530cC6cc81b4808F6118",walletCreationCode:"0x603a600e3d39601a805130553df3363d3d373d3d3d363d30545af43d82803e903d91601857fd5bf3"};var hs=Object.freeze({__proto__:null,config:os,context:as,signature:rs,version:1,DeployedWalletContext:cs});const ls="0x8713a7c4465f6fbee2b6e9d6646d1d9f83fec929edfc4baf661f3c865bdd04d1";function ds(e){return t.ethers.keccak256(us(e))}function us(e){return t.ethers.solidityPacked(["bytes32","bytes32"],[ls,e])}function fs(e){const s=t.ethers.getBytes(e);if(64===s.length&&t.ethers.hexlify(s.slice(0,32))===ls)return t.ethers.hexlify(s.slice(32,64))}var ps=Object.freeze({__proto__:null,SetImageHashPrefix:ls,hashSetImageHash:ds,messageSetImageHash:us,decodeMessageSetImageHash:fs,isMessageSetImageHash:function(e){return void 0!==fs(e)}});let gs=function(e){return e[e.Legacy=0]="Legacy",e[e.Dynamic=1]="Dynamic",e[e.NoChainIdDynamic=2]="NoChainIdDynamic",e[e.Chained=3]="Chained",e}({}),ms=function(e){return e[e.Signature=0]="Signature",e[e.Address=1]="Address",e[e.DynamicSignature=2]="DynamicSignature",e[e.Node=3]="Node",e[e.Branch=4]="Branch",e[e.Subdigest=5]="Subdigest",e[e.Nested=6]="Nested",e}({});function ws(e){return void 0!==e.left&&void 0!==e.right}function ys(e){return void 0!==e.tree}function bs(e){return e.unrecovered&&void 0!==e.signature&&void 0!==e.isDynamic}function vs(e){let s,n=t.ethers.getBytes(e);const r=(e,t)=>e?e.right?{left:e,right:t}:{left:e.left,right:t}:{left:t};for(;n.length>0;){const e=n[0];switch(n=n.slice(1),e){case ms.Signature:{const e=n[0];s=r(s,{signature:t.ethers.hexlify(n.slice(1,67)),weight:e,unrecovered:!0,isDynamic:!1}),n=n.slice(67)}break;case ms.Address:{const e=n[0];s=r(s,{address:t.ethers.getAddress(t.ethers.hexlify(n.slice(1,21))),weight:e}),n=n.slice(21)}break;case ms.DynamicSignature:{const e=n[0],i=t.ethers.getAddress(t.ethers.hexlify(n.slice(1,21))),o=n[21]<<16|n[22]<<8|n[23];s=r(s,{address:i,signature:t.ethers.hexlify(n.slice(24,24+o)),weight:e,unrecovered:!0,isDynamic:!0}),n=n.slice(24+o)}break;case ms.Node:s=r(s,{nodeHash:t.ethers.hexlify(n.slice(0,32))}),n=n.slice(32);break;case ms.Branch:{const e=n[0]<<16|n[1]<<8|n[2];s=r(s,vs(n.slice(3,3+e))),n=n.slice(3+e)}break;case ms.Subdigest:s=r(s,{subdigest:t.ethers.hexlify(n.slice(0,32))}),n=n.slice(32);break;case ms.Nested:{const e=n[0],t=n[1]<<8|n[2],i=n[3]<<16|n[4]<<8|n[5];s=r(s,{weight:e,threshold:t,tree:vs(n.slice(6,6+i))}),n=n.slice(6+i)}break;default:throw new Error(`Unknown signature part type: ${e}: ${t.ethers.hexlify(n)}`)}}if(!s)throw new Error("Empty signature tree");return s.right?s:s.left}class Es extends Error{constructor(e){super(`Invalid signature leaf: ${JSON.stringify(e)}`),this.leaf=e}}async function Is(e,t,s){if(ws(e)){const[n,r]=await Promise.all([Is(e.left,t,s),Is(e.right,t,s)]);return{left:n,right:r}}if(ys(e))return{weight:e.weight,threshold:e.threshold,tree:await Is(e.tree,t,s)};if(bs(e)){if(e.isDynamic){if(!e.address)throw new Error("Dynamic signature leaf without address");if(!await Vt(e.address,t,e.signature,s))throw new Es(e);return{weight:e.weight,address:e.address,signature:e.signature,subdigest:t}}return{weight:e.weight,address:Gt(t,e.signature),signature:e.signature,subdigest:t}}return e}const Ts={concat:(e,s)=>t.ethers.solidityPacked(["bytes","bytes"],[e,s]),node:e=>t.ethers.solidityPacked(["uint8","bytes32"],[ms.Node,e]),branch:e=>{const s=t.ethers.getBytes(e);return t.ethers.solidityPacked(["uint8","uint24","bytes"],[ms.Branch,s.length,s])},nested:(e,s,n)=>{const r=t.ethers.getBytes(n);return t.ethers.solidityPacked(["uint8","uint8","uint16","uint24","bytes"],[ms.Nested,e,s,r.length,r])},subdigest:e=>t.ethers.solidityPacked(["uint8","bytes32"],[ms.Subdigest,e]),signature:(e,s)=>t.ethers.solidityPacked(["uint8","uint8","bytes"],[ms.Signature,e,s]),dynamicSignature:(e,s,n)=>{const r=t.ethers.getBytes(n);return t.ethers.solidityPacked(["uint8","uint8","address","uint24","bytes"],[ms.DynamicSignature,e,s,r.length,r])},address:(e,s)=>t.ethers.solidityPacked(["uint8","uint8","address"],[ms.Address,e,s])};function Ss(e,s,n,r,i={}){const o=Os(e.tree,s,n,i);return 0n===BigInt(r)?{encoded:t.ethers.solidityPacked(["uint8","uint16","uint32","bytes"],[gs.NoChainIdDynamic,e.threshold,e.checkpoint,o.encoded]),weight:o.weight}:BigInt(e.threshold)>255n?{encoded:t.ethers.solidityPacked(["uint8","uint16","uint32","bytes"],[gs.Dynamic,e.threshold,e.checkpoint,o.encoded]),weight:o.weight}:{encoded:t.ethers.solidityPacked(["uint8","uint8","uint32","bytes"],[gs.Legacy,e.threshold,e.checkpoint,o.encoded]),weight:o.weight}}function Os(e,t,s,n={}){const r=!n.disableTrim;if(Zs(e)){const n=Os(e.left,t,s),i=Os(e.right,t,s),o=Vs(e.left),a=Vs(e.right);return!r||0n!==n.weight||0n!==i.weight||o||a?r&&0n===i.weight&&!a?{encoded:Ts.concat(n.encoded,Ts.node(nn(e.right))),weight:n.weight}:r&&0n===n.weight&&!o?{encoded:Ts.concat(Ts.node(nn(e.left)),Ts.branch(i.encoded)),weight:i.weight}:{encoded:Ts.concat(n.encoded,Ts.branch(i.encoded)),weight:n.weight+i.weight}:{encoded:Ts.node(nn(e)),weight:0n}}if(Ys(e)){const n=Os(e.tree,t,s);return r&&0n===n.weight?{encoded:Ts.node(nn(e)),weight:0n}:{encoded:Ts.nested(e.weight,e.threshold,n.encoded),weight:n.weight}}if(Qs(e))return{encoded:Ts.node(nn(e)),weight:0n};if(Ks(e)){const t=s.includes(e.subdigest);return{encoded:Ts.subdigest(e.subdigest),weight:t?Be:0n}}if(Vs(e)){if(t.has(e.address)){const s=t.get(e.address),r=s.signature;return n.forceDynamicEncoding||s.isDynamic?{encoded:Ts.dynamicSignature(e.weight,e.address,r),weight:BigInt(e.weight)}:{encoded:Ts.signature(e.weight,r),weight:BigInt(e.weight)}}return{encoded:Ts.address(e.weight,e.address),weight:0n}}throw new Error(`Invalid topology - unknown error: ${JSON.stringify(e)}`)}function ks(e){return xs(e)?ks(e.suffix[e.suffix.length-1]):e.config}function Cs(e){return void 0!==e.type&&void 0!==e.decoded&&void 0!==e.version&&2===e.version}function _s(e){return void 0!==e.suffix&&Array.isArray(e.suffix)&&e.suffix.every(Cs)}function As(e){return void 0!==e.type&&void 0!==e.config&&void 0!==e.digest&&void 0!==e.version&&2===e.version}function xs(e){return void 0!==e.chain&&Array.isArray(e.chain)&&e.chain.every(As)}function Ps(e){const s=t.ethers.getBytes(e),n=s[0];switch(n){case gs.Legacy:return{version:2,type:gs.Legacy,decoded:Ns(s)};case gs.Dynamic:return{version:2,type:gs.Dynamic,decoded:Ns(s.slice(1))};case gs.NoChainIdDynamic:return{version:2,type:gs.NoChainIdDynamic,decoded:Ns(s.slice(1))};case gs.Chained:return Rs(s);default:throw new Error(`Invalid signature type: ${n}`)}}function Ns(e){const s=t.ethers.getBytes(e);return{threshold:s[0]<<8|s[1],checkpoint:s[2]<<24|s[3]<<16|s[4]<<8|s[5],tree:vs(s.slice(6))}}function Rs(e){const s=t.ethers.getBytes(e),n=s[0];if(n!==gs.Chained)throw new Error(`Expected chained signature type: ${n}`);const r=[];let i=1;for(;i<s.length;){const e=s[i]<<16|s[i+1]<<8|s[i+2];i+=3;const t=Ps(s.slice(i,i+e));r.push(t),i+=e}const a=r[0];if(_s(a))throw new Error("Expected first link of chained signature to be a simple signature (not chained)");return o({},a,{suffix:r.slice(1)})}function Ms(e){return t.ethers.solidityPacked(["bytes32","bytes32"],[t.ethers.solidityPackedKeccak256(["string"],["SetImageHash(bytes32 imageHash)"]),e])}async function Ls(e,s,n){const r=void 0===s.subdigest?s:void 0;e.type===gs.NoChainIdDynamic&&r&&(r.chainId=0);const i=r?$t(r):s.subdigest;if(!_s(e)){const t=await Is(e.decoded.tree,i,n);return{version:2,type:e.type,subdigest:i,config:o({version:2},e.decoded,{tree:t})}}if(!Dt(r))throw new Error("Chained signature recovery requires detailed signed payload, subdigest is not enough");const a=[];let c=r;for(const s of[o({},e,{suffix:void 0}),...e.suffix]){const e=await Ls(s,c,n);a.unshift(e);const r=Ms(on(ks(e)));c=o({},c,{message:r,digest:t.ethers.keccak256(r)})}return o({},a[0],{suffix:a.slice(1)})}function Bs(e,s){const n=[e,...s||[]].map((e=>t.ethers.getBytes($s(e)))),r=t.ethers.solidityPacked(n.map((()=>["uint24","bytes"])).flat(),n.map((e=>[e.length,e])).flat());return t.ethers.solidityPacked(["uint8","bytes"],[gs.Chained,r])}function $s(e){if(t.ethers.isBytesLike(e))return t.ethers.hexlify(e);if(_s(e)||xs(e))return Bs($s(e),(e.suffix||[]).map($s));const s=Cs(e)?e.decoded:e.config;switch(e.type){case gs.Legacy:if(BigInt(s.threshold)>255n)throw new Error(`Legacy signature threshold is too large: ${s.threshold} (max 255)`);return Ds(s);case gs.NoChainIdDynamic:case gs.Dynamic:return t.ethers.solidityPacked(["uint8","bytes"],[e.type,Ds(s)]);case gs.Chained:throw new Error("Unreachable code: Chained signature should be handled above");default:throw new Error(`Invalid signature type: ${e.type}`)}}function Ds(e){return t.ethers.solidityPacked(["uint16","uint32","bytes"],[e.threshold,e.checkpoint,Ws(e.tree)])}function Ws(e){if(Zs(e)||ws(e)){const s=t.ethers.getBytes(Ws(e.right)),n=t.ethers.getBytes(Ws(e.left));return Zs(e.right)||ws(e.right)?t.ethers.solidityPacked(["bytes","uint8","uint24","bytes"],[n,ms.Branch,s.length,s]):t.ethers.solidityPacked(["bytes","bytes"],[n,s])}if(Ys(e)||ys(e)){const s=t.ethers.getBytes(Ws(e.tree));return t.ethers.solidityPacked(["uint8","uint8","uint16","uint24","bytes"],[ms.Nested,e.weight,e.threshold,s.length,s])}if(bs(e)||Vs(e)&&void 0!==e.signature){const s=t.ethers.getBytes(e.signature);if(e.isDynamic||66!==s.length){if(!e.address)throw new Error("Dynamic signature leaf must have address");return t.ethers.solidityPacked(["uint8","uint8","address","uint24","bytes"],[ms.DynamicSignature,e.weight,e.address,s.length,s])}return t.ethers.solidityPacked(["uint8","uint8","bytes"],[ms.Signature,e.weight,s])}if(Vs(e))return t.ethers.solidityPacked(["uint8","uint8","address"],[ms.Address,e.weight,e.address]);if(Qs(e))return t.ethers.solidityPacked(["uint8","bytes32"],[ms.Node,e.nodeHash]);if(Ks(e))return t.ethers.solidityPacked(["uint8","bytes32"],[ms.Subdigest,e.subdigest]);throw new Error(`Unknown signature tree type: ${e}`)}function js(e){return Zs(e)?[...js(e.left),...js(e.right)]:Ys(e)?js(e.tree):Vs(e)&&e.signature?[{address:e.address,signature:e.signature}]:[]}function Us(e){return ws(e)?[...Us(e.left),...Us(e.right)]:ys(e)?Us(e.tree):bs(e)?[e.signature]:[]}async function Hs(e){const t="string"==typeof e?Ps(e):e;if(_s(t)){const e=await Promise.all([Hs(o({},t,{suffix:void 0})),...t.suffix.map((e=>Hs(e)))]);return Bs(e[0],e.slice(1))}const{trimmed:s}=await qs(t.decoded.tree);return $s(o({},t,{decoded:o({},t.decoded,{tree:s})}))}async function qs(e,s=!0){if(ws(e)){const[s,n]=await Promise.all([qs(e.left),qs(e.right)]);if(0!==s.weight||0!==n.weight)return{weight:s.weight+n.weight,trimmed:{left:s.trimmed,right:n.trimmed}};try{return{weight:0,trimmed:{nodeHash:nn(await Is(e,t.ethers.ZeroHash,void 0))}}}catch(e){}}if(ys(e)){const s=await qs(e.tree);if(0===s.weight)try{return{weight:0,trimmed:{nodeHash:nn(await Is(e,t.ethers.ZeroHash,void 0))}}}catch(e){}return{weight:s.weight,trimmed:{weight:e.weight,threshold:e.threshold,tree:s.trimmed}}}return Qs(e)&&sn(e.nodeHash)?{weight:0,trimmed:o({},tn(e.nodeHash))}:bs(e)||Vs(e)&&void 0!==e.signature?{weight:Number(e.weight),trimmed:e}:!s&&Ks(e)?{weight:1/0,trimmed:e}:{weight:0,trimmed:e}}const Fs={decode:e=>Ps(e),encode:e=>$s(e),trim:e=>Hs(e),supportsNoChainId:!0,recover:(e,t,s)=>Ls(e,t,s),encodeSigners:(e,t,s,n)=>Ss(e,t,s,n),hasEnoughSigningPower:(e,t)=>{const{weight:s}=Fs.encodeSigners(e,t,[],0);return s>=BigInt(e.threshold)},chainSignatures:(e,s)=>{const n=s.reverse();return Bs(t.ethers.isBytesLike(e)?e:$s(e),n.map((e=>t.ethers.isBytesLike(e)?e:$s(e))))},hashSetImageHash:function(e){return ds(e)},signaturesOf:e=>js(e.tree),signaturesOfDecoded:function(e){return Us(e.decoded.tree)}};var Gs=Object.freeze({__proto__:null,SignatureType:gs,SignaturePartType:ms,SignaturePartTypeLength:66,isUnrecoveredNode:ws,isUnrecoveredNestedLeaf:ys,isUnrecoveredSignatureLeaf:bs,decodeSignatureTree:vs,InvalidSignatureLeafError:Es,recoverTopology:Is,partEncoder:Ts,encodeSigners:Ss,encodeTree:Os,deepestConfigOfSignature:ks,isUnrecoveredSignature:Cs,isUnrecoveredChainedSignature:_s,isSignature:As,isChainedSignature:xs,decodeSignature:Ps,decodeSignatureBody:Ns,decodeChainedSignature:Rs,setImageHashStruct:Ms,recoverSignature:Ls,encodeChain:Bs,encodeSignature:$s,encodeSignatureBody:Ds,encodeSignatureTree:Ws,signaturesOf:js,signaturesOfDecoded:Us,subdigestsOfDecoded:function e(t){return ws(t)?[...e(t.left),...e(t.right)]:ys(t)?e(t.tree):Ks(t)?[t.subdigest]:[]},trimSignature:Hs,trimUnrecoveredTree:qs,SignatureCoder:Fs});function Vs(e){return void 0!==e.address&&void 0!==e.weight}function Ks(e){return void 0!==e.subdigest&&void 0===e.address}function zs(e){return Zs(e)?JSON.stringify({left:zs(e.left),right:zs(e.right)}):Ys(e)?JSON.stringify({weight:BigInt(e.weight).toString(),threshold:BigInt(e.threshold).toString(),tree:zs(e.tree)}):Vs(e)?JSON.stringify({address:e.address,weight:BigInt(e.weight).toString()}):JSON.stringify(e)}function Js(e){const t="string"==typeof e?JSON.parse(e):e;return void 0!==t.left&&void 0!==t.right?{left:Js(t.left),right:Js(t.right)}:void 0!==t.weight&&void 0!==t.threshold&&void 0!==t.tree?{weight:BigInt(t.weight),threshold:BigInt(t.threshold),tree:Js(t.tree)}:void 0!==t.address&&void 0!==t.weight?{address:t.address,weight:BigInt(t.weight)}:t}function Ys(e){return void 0!==e.tree&&void 0!==e.weight&&void 0!==e.threshold}function Qs(e){return void 0!==e.nodeHash}function Xs(e){return Vs(e)||Ks(e)||Ys(e)||Qs(e)}function Zs(e){return void 0!==e.left&&void 0!==e.right}function en(e){return t.ethers.solidityPacked(["uint96","address"],[e.weight,e.address])}function tn(e){const s=t.ethers.getBytes(e);if(32!==s.length)throw new Error("Invalid encoded string length");return{weight:BigInt(t.ethers.hexlify(s.slice(0,12))),address:t.ethers.getAddress(t.ethers.hexlify(s.slice(12)))}}function sn(e){const s=t.ethers.getBytes(e);if(32!==s.length)return!1;return s.slice(0,11).every((e=>0===e))}function nn(e){if(Vs(e))return en(e);if(Ks(e))return t.ethers.solidityPackedKeccak256(["string","bytes32"],["Sequence static digest:\n",e.subdigest]);if(Ys(e)){const s=nn(e.tree);return t.ethers.solidityPackedKeccak256(["string","bytes32","uint256","uint256"],["Sequence nested config:\n",s,e.threshold,e.weight])}return Qs(e)?e.nodeHash:t.ethers.solidityPackedKeccak256(["bytes32","bytes32"],[nn(e.left),nn(e.right)])}function rn(e){return void 0!==e.threshold&&void 0!==e.checkpoint&&void 0!==e.tree&&void 0!==e.version&&2===e.version}function on(e){return t.ethers.solidityPackedKeccak256(["bytes32","uint256"],[t.ethers.solidityPackedKeccak256(["bytes32","uint256"],[nn(e.tree),e.threshold]),e.checkpoint])}function an(e){return void 0!==e.threshold&&void 0!==e.weight&&void 0!==e.members}function cn(e){return Vs(e)||Ks(e)?[e]:Ys(e)?[{threshold:e.threshold,weight:e.weight,members:cn(e.tree)}]:Qs(e)?[]:[...cn(e.left),...cn(e.right)]}const hn=(e,t)=>e.map((e=>an(e)?{tree:t(e.members),threshold:e.threshold,weight:e.weight}:e));function ln(e){if(0===e.length)throw new Error("Empty members array");return hn(e,ln).reduce(((e,t)=>({left:e,right:t})))}function dn(e){if(0===e.length)throw new Error("Empty members array");const t=hn(e,dn);for(let e=t.length;e>1;e/=2)for(let s=0;s<e/2;s++){const n=2*s,r=n+1;t[s]=r>=e?t[n]:{left:t[n],right:t[r]}}return t[0]}function un(e){return e.length>8?dn(e):ln(e)}function fn(e,t=un){return{version:2,threshold:e.threshold,checkpoint:e.checkpoint,tree:t(e.members)}}function pn(e,t){return Ks(e)?e.subdigest===t:!!Zs(e)&&(pn(e.left,t)||pn(e.right,t))}function gn(e){const t=[e],s=new Set;for(;t.length>0;){const e=t.pop();Ys(e)?t.push(e.tree):Zs(e)?(t.push(e.left),t.push(e.right)):Vs(e)&&s.add({address:e.address,weight:Number(e.weight)})}return Array.from(s)}function mn(e){return Zs(e)?mn(e.left)&&mn(e.right):!Qs(e)}const wn={isWalletConfig:e=>2===e.version&&void 0!==e.threshold&&void 0!==e.tree,imageHashOf:e=>on(e),hasSubdigest:(e,t)=>pn(e.tree,t),checkpointOf:e=>BigInt(e.checkpoint),signersOf:e=>gn(e.tree),fromSimple:e=>{var t;return fn(o({},e,{members:[...e.signers,...(null!=(t=e.subdigests)?t:[]).map((e=>({subdigest:e})))]}))},isComplete:e=>mn(e.tree),update:{isKindUsed:!0,buildTransaction:(e,s,n,i)=>{const o=new t.ethers.Interface(r.mainModuleUpgradable.abi);return{entrypoint:e,transactions:[{to:e,data:o.encodeFunctionData(o.getFunction("updateImageHash"),[wn.imageHashOf(s)]),gasLimit:0,delegateCall:!1,revertOnError:!0,value:0}]}},decodeTransaction:function(e){var s,n,i,o;const a=new t.ethers.Interface(r.mainModuleUpgradable.abi);if(1!==e.transactions.length)throw new Error("Invalid transaction bundle, expected 1 transaction");const c=e.transactions[0].data;if(!c)throw new Error("Invalid transaction bundle, expected data");const h=a.decodeFunctionData(a.getFunction("updateImageHash"),c);if(!h)throw new Error("Invalid transaction bundle, expected valid data");if(e.transactions[0].to!==e.entrypoint)throw new Error("Invalid transaction bundle, expected to be sent to entrypoint");if(e.transactions[0].delegateCall)throw new Error("Invalid transaction bundle, expected not to be a delegateCall");if(!e.transactions[0].revertOnError)throw new Error("Invalid transaction bundle, expected revertOnError");if(0n!==BigInt(null!=(s=null==(n=e.transactions[0])?void 0:n.value)?s:0))throw new Error("Invalid transaction bundle, expected value to be 0");if(0n!==BigInt(null!=(i=null==(o=e.transactions[0])?void 0:o.gasLimit)?i:0))throw new Error("Invalid transaction bundle, expected value to be 0");return{address:e.entrypoint,newImageHash:h[0],kind:void 0}}},toJSON:function(e){return JSON.stringify({version:e.version,threshold:BigInt(e.threshold).toString(),checkpoint:BigInt(e.checkpoint).toString(),tree:zs(e.tree)})},fromJSON:function(e){const t=JSON.parse(e);return{version:t.version,threshold:BigInt(t.threshold),checkpoint:BigInt(t.checkpoint),tree:Js(t.tree)}},editConfig:function(e,t){var s,n;const r=cn(e.tree);if(t.add)for(const e of t.add)r.find((t=>Vs(t)&&t.address===e.address))||r.push({address:e.address,weight:e.weight});if(t.remove)for(const e of t.remove){const t=r.findIndex((t=>Vs(t)&&t.address===e));t>=0&&r.splice(t,1)}return{version:e.version,threshold:null!=(s=t.threshold)?s:e.threshold,checkpoint:null!=(n=t.checkpoint)?n:e.checkpoint,tree:un(r)}},buildStubSignature:function(e,t){const s=new Map;for(const[n,r]of t.entries()){s.set(n,{signature:r,isDynamic:!0});const{encoded:t,weight:i}=Ss(e,s,[],0);if(i>=BigInt(e.threshold))return t}const n=gn(e.tree);for(const{address:t}of n.sort((({weight:e},{weight:t})=>e-t))){const n="0x4e82f02f388a12b5f9d29eaf2452dd040c0ee5804b4e504b4dd64e396c6c781f2c7624195acba242dd825bfd25a290912e3c230841fd55c9a734c4de8d9899451b02";s.set(t,{signature:n,isDynamic:!1});const{encoded:r,weight:i}=Ss(e,s,[],0);if(i>=BigInt(e.threshold))return r}return Ss(e,s,[],0).encoded}};var yn=Object.freeze({__proto__:null,isSignerLeaf:Vs,isSubdigestLeaf:Ks,topologyToJSON:zs,topologyFromJSON:Js,isNestedLeaf:Ys,isNodeLeaf:Qs,isLeaf:Xs,isNode:Zs,isTopology:function(e){return Zs(e)||Xs(e)},encodeSignerLeaf:en,decodeSignerLeaf:tn,isEncodedSignerLeaf:sn,hashNode:nn,leftFace:function(e){const t=[];let s=e;for(;!Xs(s);)t.unshift(s.right),s=s.left;return t.unshift(s),t},isWalletConfig:rn,imageHash:on,isSimpleNestedMember:an,topologyToMembers:cn,hasUnknownNodes:function e(t){return!!Qs(t)||!!Zs(t)&&(e(t.left)||e(t.right))},toSimpleWalletConfig:function(e){return{threshold:e.threshold,checkpoint:e.checkpoint,members:cn(e.tree)}},legacyTopologyBuilder:ln,merkleTopologyBuilder:dn,optimized2SignersTopologyBuilder:un,toWalletConfig:fn,hasSubdigest:pn,signersOf:gn,isComplete:mn,ConfigCoder:wn}),bn=Object.freeze({__proto__:null});const vn={config:wn,signature:Fs},En={version:2,factory:"0xFaA5c0b14d1bED5C888Ca655B9a8A5911F78eF4A",guestModule:"0xfea230Ee243f88BC698dD8f1aE93F8301B6cdfaE",mainModule:"0xfBf8f1A5E00034762D928f46d438B947f5d4065d",mainModuleUpgradable:"0x4222dcA3974E39A8b41c411FeDDE9b09Ae14b911",walletCreationCode:"0x603a600e3d39601a805130553df3363d3d373d3d3d363d30545af43d82803e903d91601857fd5bf3"};var In=Object.freeze({__proto__:null,config:yn,signature:Gs,context:bn,chained:ps,coders:vn,version:2,DeployedWalletContext:En}),Tn=Object.freeze({__proto__:null});function Sn(e,s){const n=t.ethers.keccak256(t.ethers.solidityPacked(["bytes","bytes32"],[e.walletCreationCode,t.ethers.zeroPadValue(e.mainModule,32)])),r=t.ethers.keccak256(t.ethers.solidityPacked(["bytes1","address","bytes32","bytes32"],["0xff",e.factory,s,n]));return t.ethers.getAddress(t.ethers.dataSlice(r,12))}const On={1:cs,2:En};var kn=Object.freeze({__proto__:null,addressOf:Sn,isValidCounterfactual:async function(e,s,n,r,i,o){const a=await Promise.all(lr.map((async a=>{try{const c=a.signature.SignatureCoder.decode(t.ethers.hexlify(n)),h=await a.signature.SignatureCoder.recover(c,{address:e,digest:t.ethers.hexlify(s),chainId:r},i),l=a.config.ConfigCoder.imageHashOf(h.config);if(Sn(o[a.version],l).toLowerCase()===e.toLowerCase())return!0;const d=await a.signature.SignatureCoder.recover(c,{address:e,digest:t.ethers.hexlify(s),chainId:r},i),u=a.config.ConfigCoder.imageHashOf(d.config);return Sn(o[a.version],u).toLowerCase()===e.toLowerCase()}catch(e){}return!1})));return a.some((e=>e))},isValidVersionedContext:function(e){const t=Object.keys(e).length;for(let s=1;s<=t;s++){const t=e[s];if(!t||t.version!==s)return!1}return!0},latestContext:function(e){return e[Object.keys(e).length]},defaultContexts:On});const Cn="tuple(\n  bool delegateCall,\n  bool revertOnError,\n  uint256 gasLimit,\n  address target,\n  uint256 value,\n  bytes data\n)[]";function _n(e){return t.ethers.keccak256(t.ethers.AbiCoder.defaultAbiCoder().encode(["address","uint256","bytes32"],[e.intent.wallet,e.chainId,e.intent.id]))}function An(e){const s=t.ethers.AbiCoder.defaultAbiCoder().decode(["uint256",Cn],e);if(2!==s.length||!s[0]||!s[1])throw new Error("Invalid meta transaction data");return[s[0],s[1]]}function xn(e,s){return t.ethers.AbiCoder.defaultAbiCoder().encode(["uint256",Cn],[e,Dn(s)])}function Pn(e,s){return t.ethers.keccak256(xn(e,s))}function Nn(e,t,s,n){return $t({address:e,chainId:t,digest:Pn(s,n)})}function Rn(e,s,n){return $t({address:e,chainId:s,digest:t.ethers.keccak256(t.ethers.AbiCoder.defaultAbiCoder().encode(["string",Cn],["guest:",Dn(n)]))})}function Mn(e,t){return t.map((t=>Ln(e,t)))}function Ln(e,s){if(s.to&&s.to!==t.ethers.ZeroAddress)return{nonce:Jn(s.nonce)?void 0:BigInt(s.nonce),transaction:{delegateCall:!1,revertOnError:!1,gasLimit:Jn(s.gasLimit)?void 0:BigInt(s.gasLimit),to:s.to,value:BigInt(s.value||0),data:s.data||"0x"}};{const n=new t.ethers.Interface(r.mainModule.abi),i=n.encodeFunctionData(n.getFunction("createContract"),[s.data]);return{nonce:"number"==typeof s.nonce?BigInt(s.nonce):void 0,transaction:{delegateCall:!1,revertOnError:!1,gasLimit:Jn(s.gasLimit)?void 0:BigInt(s.gasLimit),to:e,value:BigInt(s.value||0),data:i}}}}function Bn(e){return void 0!==e.delegateCall||void 0!==e.revertOnError}function $n(e){return e.every(Bn)}function Dn(e){return e.map((e=>{var s;return{delegateCall:!0===e.delegateCall,revertOnError:!0===e.revertOnError,gasLimit:Jn(e.gasLimit)?0n:BigInt(e.gasLimit),target:null!=(s=e.to)?s:t.ethers.ZeroAddress,value:Jn(e.value)?0n:e.value,data:e.data||"0x"}}))}function Wn(e){return e.map((e=>({delegateCall:e.delegateCall,revertOnError:e.revertOnError,gasLimit:e.gasLimit,to:e.target,value:e.value,data:e.data})))}function jn(e,t){const s=BigInt(e),n=BigInt(t),r=2n**96n;if(n/r!==0n)throw new Error("Space already encoded");return n+s*r}function Un(e){const t=BigInt(e),s=2n**96n;return[t/s,t%s]}function Hn(e,t){if(Array.isArray(t)){if($n(t))return t;return Mn(e,t).map((e=>e.transaction))}return Bn(t)?[t]:[Ln(e,t).transaction]}function qn(e){return void 0!==e&&void 0!==e.entrypoint&&void 0!==e.chainId&&void 0!==e.transactions&&void 0!==e.nonce&&void 0!==e.intent&&void 0!==e.intent.id&&void 0!==e.intent.wallet&&Array.isArray(e.transactions)&&e.transactions.reduce(((e,t)=>e&&Bn(t)),!0)}function Fn(e){return void 0!==e&&void 0!==e.signature&&""!==e.signature&&qn(e)}function Gn(e){const s=new t.ethers.Interface(r.mainModule.abi);return s.encodeFunctionData(s.getFunction("execute"),Fn(e)?[Dn(e.transactions),e.nonce,e.signature]:[Dn(e.transactions),0,new Uint8Array([])])}const Vn="0x61c2926c",Kn="tuple(\n  bool delegateCall,\n  bool revertOnError,\n  uint256 gasLimit,\n  address target,\n  uint256 value,\n  bytes data\n)[]",zn=(e,s)=>{const n=[],i=new t.ethers.Interface(r.mainModule.abi);for(const r of s){const s=t.ethers.getBytes(r.data||"0x");if(r.to===e&&t.ethers.hexlify(s.slice(0,4))===Vn){const e=s.slice(4),i=t.ethers.AbiCoder.defaultAbiCoder().decode([Kn],e)[0];n.push(...zn(r.to,i.map((e=>o({},e,{to:e.target})))))}else try{const t=i.decodeFunctionData("execute",s)[0],r=zn(e,t.map((e=>o({},e.toObject(),{to:e.target}))));n.push(...r)}catch(e){n.push(r)}}return n},Jn=e=>null==e;var Yn=Object.freeze({__proto__:null,MetaTransactionsType:Cn,intendTransactionBundle:function(e,t,s,n){return o({},e,{chainId:s,intent:{id:n,wallet:t}})},intendedTransactionID:_n,unpackMetaTransactionsData:An,packMetaTransactionsData:xn,digestOfTransactions:Pn,subdigestOfTransactions:Nn,subdigestOfGuestModuleTransactions:Rn,toSequenceTransactions:Mn,toSequenceTransaction:Ln,isSequenceTransaction:Bn,hasSequenceTransactions:$n,sequenceTxAbiEncode:Dn,fromTxAbiEncode:Wn,encodeNonce:jn,decodeNonce:Un,fromTransactionish:Hn,isTransactionBundle:qn,isSignedTransactionBundle:Fn,encodeBundleExecData:Gn,selfExecuteSelector:Vn,selfExecuteAbi:Kn,unwind:zn});const Qn="0x608060405234801561001057600080fd5b5060405161124a38038061124a83398101604081905261002f91610124565b600060405161003d906100dd565b604051809103906000f080158015610059573d6000803e3d6000fd5b5090506000816001600160a01b0316638f0684308686866040518463ffffffff1660e01b815260040161008e939291906101fb565b6020604051808303816000875af11580156100ad573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906100d19190610244565b9050806000526001601ff35b610fdc8061026e83390190565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561011b578181015183820152602001610103565b50506000910152565b60008060006060848603121561013957600080fd5b83516001600160a01b038116811461015057600080fd5b6020850151604086015191945092506001600160401b038082111561017457600080fd5b818601915086601f83011261018857600080fd5b81518181111561019a5761019a6100ea565b604051601f8201601f19908116603f011681019083821181831017156101c2576101c26100ea565b816040528281528960208487010111156101db57600080fd5b6101ec836020830160208801610100565b80955050505050509250925092565b60018060a01b0384168152826020820152606060408201526000825180606084015261022e816080850160208701610100565b601f01601f191691909101608001949350505050565b60006020828403121561025657600080fd5b8151801515811461026657600080fd5b939250505056fe608060405234801561001057600080fd5b50610fbc806100206000396000f3fe608060405234801561001057600080fd5b50600436106100675760003560e01c806376be4cea1161005057806376be4cea146100a65780638f068430146100b957806398ef1ed8146100cc57600080fd5b80631c6453271461006c5780633d787b6314610093575b600080fd5b61007f61007a366004610ad4565b6100df565b604051901515815260200160405180910390f35b61007f6100a1366004610ad4565b61023d565b61007f6100b4366004610b3e565b61031e565b61007f6100c7366004610ad4565b6108e1565b61007f6100da366004610ad4565b61096e565b6040517f76be4cea00000000000000000000000000000000000000000000000000000000815260009030906376be4cea9061012890889088908890889088908190600401610bc3565b6020604051808303816000875af1925050508015610181575060408051601f3d9081017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016820190925261017e91810190610c45565b60015b610232573d8080156101af576040519150601f19603f3d011682016040523d82523d6000602084013e6101b4565b606091505b508051600181900361022757816000815181106101d3576101d3610c69565b6020910101517fff00000000000000000000000000000000000000000000000000000000000000167f0100000000000000000000000000000000000000000000000000000000000000149250610235915050565b600092505050610235565b90505b949350505050565b6040517f76be4cea00000000000000000000000000000000000000000000000000000000815260009030906376be4cea906102879088908890889088906001908990600401610bc3565b6020604051808303816000875af19250505080156102e0575060408051601f3d9081017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe01682019092526102dd91810190610c45565b60015b610232573d80801561030e576040519150601f19603f3d011682016040523d82523d6000602084013e610313565b606091505b506000915050610235565b600073ffffffffffffffffffffffffffffffffffffffff87163b6060827f64926492649264926492649264926492649264926492649264926492649264928888610369602082610c98565b610375928b9290610cd8565b61037e91610d02565b1490508015610484576000606089828a610399602082610c98565b926103a693929190610cd8565b8101906103b39190610e18565b955090925090508415806103c45750865b1561047d576000808373ffffffffffffffffffffffffffffffffffffffff16836040516103f19190610eb2565b6000604051808303816000865af19150503d806000811461042e576040519150601f19603f3d011682016040523d82523d6000602084013e610433565b606091505b50915091508161047a57806040517f9d0d6e2d0000000000000000000000000000000000000000000000000000000081526004016104719190610f18565b60405180910390fd5b50505b50506104be565b87878080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509294505050505b80806104ca5750600083115b156106bb576040517f1626ba7e00000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff8b1690631626ba7e90610523908c908690600401610f2b565b602060405180830381865afa92505050801561057a575060408051601f3d9081017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016820190925261057791810190610f44565b60015b61060f573d8080156105a8576040519150601f19603f3d011682016040523d82523d6000602084013e6105ad565b606091505b50851580156105bc5750600084115b156105db576105d08b8b8b8b8b600161031e565b9450505050506108d7565b806040517f6f2a95990000000000000000000000000000000000000000000000000000000081526004016104719190610f18565b7fffffffff0000000000000000000000000000000000000000000000000000000081167f1626ba7e000000000000000000000000000000000000000000000000000000001480158161065f575086155b801561066b5750600085115b1561068b5761067f8c8c8c8c8c600161031e565b955050505050506108d7565b841580156106965750825b80156106a0575087155b156106af57806000526001601ffd5b94506108d79350505050565b6041871461074b576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152603a60248201527f5369676e617475726556616c696461746f72237265636f7665725369676e657260448201527f3a20696e76616c6964207369676e6174757265206c656e6774680000000000006064820152608401610471565b600061075a6020828a8c610cd8565b61076391610d02565b90506000610775604060208b8d610cd8565b61077e91610d02565b905060008a8a604081811061079557610795610c69565b919091013560f81c915050601b81148015906107b557508060ff16601c14155b15610842576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602d60248201527f5369676e617475726556616c696461746f723a20696e76616c6964207369676e60448201527f617475726520762076616c7565000000000000000000000000000000000000006064820152608401610471565b6040805160008152602081018083528e905260ff831691810191909152606081018490526080810183905273ffffffffffffffffffffffffffffffffffffffff8e169060019060a0016020604051602081039080840390855afa1580156108ad573d6000803e3d6000fd5b5050506020604051035173ffffffffffffffffffffffffffffffffffffffff161496505050505050505b9695505050505050565b6040517f76be4cea00000000000000000000000000000000000000000000000000000000815260009030906376be4cea9061092b9088908890889088906001908990600401610bc3565b6020604051808303816000875af115801561094a573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102329190610c45565b6040517f76be4cea00000000000000000000000000000000000000000000000000000000815260009030906376be4cea906109b790889088908890889088908190600401610bc3565b6020604051808303816000875af1925050508015610a10575060408051601f3d9081017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0168201909252610a0d91810190610c45565b60015b610232573d808015610a3e576040519150601f19603f3d011682016040523d82523d6000602084013e610a43565b606091505b5080516001819003610a6257816000815181106101d3576101d3610c69565b8082fd5b73ffffffffffffffffffffffffffffffffffffffff81168114610a8857600080fd5b50565b60008083601f840112610a9d57600080fd5b50813567ffffffffffffffff811115610ab557600080fd5b602083019150836020828501011115610acd57600080fd5b9250929050565b60008060008060608587031215610aea57600080fd5b8435610af581610a66565b935060208501359250604085013567ffffffffffffffff811115610b1857600080fd5b610b2487828801610a8b565b95989497509550505050565b8015158114610a8857600080fd5b60008060008060008060a08789031215610b5757600080fd5b8635610b6281610a66565b955060208701359450604087013567ffffffffffffffff811115610b8557600080fd5b610b9189828a01610a8b565b9095509350506060870135610ba581610b30565b91506080870135610bb581610b30565b809150509295509295509295565b73ffffffffffffffffffffffffffffffffffffffff8716815285602082015260a060408201528360a0820152838560c0830137600060c085830181019190915292151560608201529015156080820152601f9092017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016909101019392505050565b600060208284031215610c5757600080fd5b8151610c6281610b30565b9392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b81810381811115610cd2577f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b92915050565b60008085851115610ce857600080fd5b83861115610cf557600080fd5b5050820193919092039150565b80356020831015610cd2577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff602084900360031b1b1692915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600082601f830112610d7e57600080fd5b813567ffffffffffffffff80821115610d9957610d99610d3e565b604051601f83017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0908116603f01168101908282118183101715610ddf57610ddf610d3e565b81604052838152866020858801011115610df857600080fd5b836020870160208301376000602085830101528094505050505092915050565b600080600060608486031215610e2d57600080fd5b8335610e3881610a66565b9250602084013567ffffffffffffffff80821115610e5557600080fd5b610e6187838801610d6d565b93506040860135915080821115610e7757600080fd5b50610e8486828701610d6d565b9150509250925092565b60005b83811015610ea9578181015183820152602001610e91565b50506000910152565b60008251610ec4818460208701610e8e565b9190910192915050565b60008151808452610ee6816020860160208601610e8e565b601f017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0169290920160200192915050565b602081526000610c626020830184610ece565b8281526040602082015260006102356040830184610ece565b600060208284031215610f5657600080fd5b81517fffffffff0000000000000000000000000000000000000000000000000000000081168114610c6257600080fdfea26469706673582212201a72aed4b15ffb05b6502997a9bb655992e06590bd26b336dfbb153d7ff6f34b64736f6c63430008120033",Xn="0x6492649264926492649264926492649264926492649264926492649264926492";async function Zn(e,s,n,r){try{return"0x01"===await e.call({data:t.ethers.concat([Qn,t.ethers.AbiCoder.defaultAbiCoder().encode(["address","bytes32","bytes"],[s,n,r])])})}catch(e){return!1}}var er=Object.freeze({__proto__:null,EIP_6492_OFFCHAIN_DEPLOY_CODE:Qn,EIP_6492_SUFFIX:Xn,validateEIP6492Offchain:Zn});class tr{constructor(e){this.provider=e,this.isDeployedCache=new Set}module(e){return new t.ethers.Contract(e,[...r.mainModuleUpgradable.abi,...r.mainModule.abi,...r.erc1271.abi],this.provider)}async isDeployed(e){if(this.isDeployedCache.has(e))return!0;const s=0!==(await this.provider.getCode(e).then((e=>t.ethers.getBytes(e)))).length;return s&&this.isDeployedCache.add(e),s}async implementation(e){const s=t.ethers.AbiCoder.defaultAbiCoder().encode(["address"],[e]),n=await this.provider.getStorage(e,s).then((e=>t.ethers.getBytes(e)));return 20===n.length?t.ethers.getAddress(t.ethers.hexlify(n)):32===n.length?t.ethers.AbiCoder.defaultAbiCoder().decode(["address"],n)[0]:void 0}async imageHash(e){try{return await this.module(e).imageHash()}catch(e){}}async nonce(e,t=0){try{return await this.module(e).readNonce(t)}catch(t){if(!await this.isDeployed(e))return 0;throw t}}async isValidSignature(e,t,s){return Zn(this.provider,e,t,s)}}var sr=Object.freeze({__proto__:null,OnChainReader:tr});function nr(e){return e&&e.address&&e.digest&&void 0!==e.chainId&&e.config}var rr=Object.freeze({__proto__:null,config:Tn,signature:Wt,context:kn,signer:zt,EIP1271:Ht,transaction:Yn,reader:sr,EIP6492:er,isWalletSignRequestMetadata:nr});const ir=[{config:is,signature:ns},{config:wn,signature:Fs}];function or(e){const t=e-1;if(t<0||t>=ir.length)throw new Error(`No coder for version: ${e}`);return ir[t]}function ar(e){return or(e)}var cr=Object.freeze({__proto__:null,ALL_CODERS:ir,coderFor:or,genericCoderFor:ar});const hr="2.0.26",lr=[hs,In];function dr(e,t,s){for(let n=0;n<s.length;n++)if(Sn(s[n],t)===e)return s[n].version;throw new Error("Could not find version for counterfactual address")}var ur=Object.freeze({__proto__:null,counterfactualVersion:dr});const fr="0xa04263acf755e8bd19c0d7e20eea39a9ff3729eb",pr=new class{constructor(){this.version=2,this.configCoder=wn,this.signatureCoder=Fs}buildTransaction(e,s,n){if(!wn.isWalletConfig(n)){const t=fn({threshold:n.threshold,members:n.signers,checkpoint:0});return this.buildTransaction(e,s,t)}const i=s[2],o=new t.ethers.Interface(r.mainModule.abi),a=wn.update.buildTransaction(e,n,i,"first");return{tx:{entrypoint:e,nonce:jn(fr,0),transactions:[{to:e,value:0,gasLimit:0,revertOnError:!0,delegateCall:!1,data:o.encodeFunctionData(o.getFunction("updateImplementation"),[i.mainModuleUpgradable])},...a.transactions]},fromVersion:this.version-1,toVersion:this.version,toConfig:n}}decodeTransaction(e,s){const n=e.entrypoint;if(e.transactions.length<2)throw new Error("Invalid transaction bundle size");if(!e.nonce||jn(fr,0)!==BigInt(e.nonce))throw new Error("Invalid transaction bundle nonce");if(e.transactions[0].to!==n||e.transactions[1].to!==n||e.transactions[0].delegateCall||e.transactions[1].delegateCall||!e.transactions[0].revertOnError||!e.transactions[1].revertOnError||e.transactions[0].value&&0n!==BigInt(e.transactions[0].value)||e.transactions[1].value&&0n!==BigInt(e.transactions[1].value)||e.transactions[0].gasLimit&&0n!==BigInt(e.transactions[0].gasLimit)||e.transactions[1].gasLimit&&0n!==BigInt(e.transactions[1].gasLimit))throw new Error("Invalid transaction bundle format");const i=s[2],o=new t.ethers.Interface(r.mainModule.abi);if(t.ethers.hexlify(e.transactions[0].data||new Uint8Array)!==t.ethers.hexlify(o.encodeFunctionData(o.getFunction("updateImplementation"),[i.mainModuleUpgradable])))throw new Error("Invalid new implementation on transaction");const a=wn.update.decodeTransaction({entrypoint:n,transactions:[e.transactions[1]]});if(a.address!==n)throw new Error("Invalid transaction bundle address");return a}};var gr=Object.freeze({__proto__:null,MIGRATION_NONCE_SPACE:fr,v1v2:pr});class mr{constructor(e,t,s){this.tracker=e,this.migrations=t,this.contexts=s,function(e){for(const[t,s]of Object.entries(e))if(t!==String(s.version-1))throw new Error(`Migration with key ${t} has version ${s.version}, expected version to be key + 1`)}(t)}lastMigration(){let e;for(const t of Object.values(this.migrations))(void 0===e||t.version>e.version)&&(e=t);if(void 0===e)throw new Error("No migrations");return e}async getAllMigratePresignedTransaction(e){const{address:t,fromImageHash:s,fromVersion:n,chainId:r}=e;let i=s,o=n;const a=Object.values(this.contexts),c=[];for(let e=1;e<a.length;e++){const e=await this.tracker.getMigration(t,i,o,r);if(!e)return{signedMigrations:c,missing:!0,lastImageHash:i,lastVersion:o};c.push(e);const s=this.migrations[o];if(!s)throw new Error(`No migration found for version ${o}`);const n=s.decodeTransaction(e.tx,this.contexts);if(n.address!==t)throw new Error("Migration transaction address does not match expected address");i=n.newImageHash,o+=1}return{signedMigrations:c,missing:!1,lastImageHash:i,lastVersion:o}}async signNextMigration(e,t,s,n){const r=this.migrations[t];if(!r)return;const i=r.buildTransaction(e,this.contexts,n);return o({},i,{tx:await s.signTransactionBundle(i.tx)})}}var wr=Object.freeze({__proto__:null,Migrator:mr});const yr={1:pr};var br=Object.freeze({__proto__:null,DefaultMigrations:yr});const vr=800000n,Er={waitPollRate:1e3,deltaBlocksLog:12,fromBlockLog:-1024};class Ir{constructor(e){this.provider=void 0,this.waitPollRate=void 0,this.deltaBlocksLog=void 0,this.fromBlockLog=void 0;const t=o({},Er,e);this.provider=t.provider,this.waitPollRate=t.waitPollRate,this.deltaBlocksLog=t.deltaBlocksLog,this.fromBlockLog=t.fromBlockLog}async simulate(e,...s){var n=this;return(await Promise.all(s.map((async function(s){if(s.gasLimit&&0n!==BigInt(s.gasLimit||0))return s.gasLimit;if(s.delegateCall)return vr;if(s.to===e&&await n.provider.getCode(e).then((e=>0===t.ethers.getBytes(e).length)))return vr;if(!n.provider)throw new Error("signer.provider is not set, but is required");return n.provider.estimateGas({from:e,to:s.to,data:s.data,value:s.value})})))).map((e=>({executed:!0,succeeded:!0,gasUsed:Number(e),gasLimit:Number(e)})))}async getNonce(e,s,n){if(!this.provider)throw new Error("provider is not set");if("0x"===await this.provider.getCode(e))return 0;void 0===s&&(s=0);const i=new t.ethers.Contract(e,r.mainModule.abi,this.provider);return jn(s,await i.readNonce(s,{blockTag:n}))}async wait(e,t,s=this.waitPollRate,n=5){var r=this;"string"!=typeof e&&(e=_n(e));let i=!1;const o=async function(e,t){let r=0;for(;!i;){try{return await e()}catch(e){if(r++,void 0!==n&&r>=n)throw Xe.error(`giving up after ${r} failed attempts${t?`: ${t}`:""}`,e),e;Xe.warn(`attempt #${r} failed${t?`: ${t}`:""}`,e)}s>0&&await new Promise((e=>setTimeout(e,s)))}throw new Error(`timed out after ${r} failed attempts${t?`: ${t}`:""}`)},a=async function(){let t=r.fromBlockLog;if(t<0){const e=await o((()=>r.provider.getBlockNumber()),"unable to get latest block number");t=e+t}if("string"!=typeof e)throw new Error("impossible");const n=e.replace("0x","");for(;!i;){const a=await o((()=>r.provider.getBlockNumber()),"unable to get latest block number"),c=await o((()=>r.provider.getLogs({fromBlock:Math.max(0,t-r.deltaBlocksLog),toBlock:a,topics:["0x1f180c27086c7a39ea2a7b25239d1ab92348f07ca7bb59d1438fcf527568f881"]})),`unable to get NonceChange logs for blocks ${Math.max(0,t-r.deltaBlocksLog)} to ${a}`);t=a;const h=(await Promise.all(c.map((e=>o((()=>r.provider.getTransactionReceipt(e.transactionHash)),`unable to get receipt for transaction ${e.transactionHash}`))))).find((e=>null==e?void 0:e.logs.find((e=>0===e.topics.length&&e.data.replace("0x","")===n||1===e.topics.length&&"0x3dbd1590ea96dd3253a91f24e64e3a502e1225d602a5731357bc12643070ccd7"===e.topics[0]&&e.data.length>=64&&e.data.replace("0x","").startsWith(n)))));if(h){const t=await o((()=>r.provider.getTransaction(h.hash)),`unable to get transaction ${h.hash}`);if(!t)throw new Error(`Transaction response not found for  ${e}`);const s=t;return s.receipt=h,s}i||await new Promise((e=>setTimeout(e,s)))}throw new Error(`Timeout waiting for transaction receipt ${e}`)};return void 0!==t?Promise.race([a(),new Promise(((s,n)=>setTimeout((()=>{i=!0,n(`Timeout waiting for transaction receipt ${e}`)}),t)))]):a()}}function Tr(e){return e&&"object"==typeof e&&"object"==typeof e.provider&&"function"==typeof e.getAddress&&"function"==typeof e.connect}let Sr=function(e){return e.UNKNOWN="UNKNOWN",e.DROPPED="DROPPED",e.QUEUED="QUEUED",e.SENT="SENT",e.SUCCEEDED="SUCCEEDED",e.PARTIALLY_FAILED="PARTIALLY_FAILED",e.FAILED="FAILED",e}({}),Or=function(e){return e.SEND="SEND",e.RECEIVE="RECEIVE",e.BRIDGE_DEPOSIT="BRIDGE_DEPOSIT",e.BRIDGE_WITHDRAW="BRIDGE_WITHDRAW",e.BURN="BURN",e.UNKNOWN="UNKNOWN",e}({}),kr=function(e){return e.UNKNOWN="UNKNOWN",e.ERC20_TOKEN="ERC20_TOKEN",e.ERC1155_TOKEN="ERC1155_TOKEN",e}({}),Cr=function(e){return e.DESC="DESC",e.ASC="ASC",e}({});class _r{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Relayer/",this.ping=(e,t)=>this.fetch(this.url("Ping"),Ar({},e,t)).then((e=>xr(e).then((e=>({status:e.status})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.version=(e,t)=>this.fetch(this.url("Version"),Ar({},e,t)).then((e=>xr(e).then((e=>({version:e.version})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.runtimeStatus=(e,t)=>this.fetch(this.url("RuntimeStatus"),Ar({},e,t)).then((e=>xr(e).then((e=>({status:e.status})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.getSequenceContext=(e,t)=>this.fetch(this.url("GetSequenceContext"),Ar({},e,t)).then((e=>xr(e).then((e=>({data:e.data})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.getChainID=(e,t)=>this.fetch(this.url("GetChainID"),Ar({},e,t)).then((e=>xr(e).then((e=>({chainID:e.chainID})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.sendMetaTxn=(e,t,s)=>this.fetch(this.url("SendMetaTxn"),Ar(e,t,s)).then((e=>xr(e).then((e=>({status:e.status,txnHash:e.txnHash})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.getMetaTxnNonce=(e,t,s)=>this.fetch(this.url("GetMetaTxnNonce"),Ar(e,t,s)).then((e=>xr(e).then((e=>({nonce:e.nonce})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.getMetaTxnReceipt=(e,t,s)=>this.fetch(this.url("GetMetaTxnReceipt"),Ar(e,t,s)).then((e=>xr(e).then((e=>({receipt:e.receipt})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.simulate=(e,t,s)=>this.fetch(this.url("Simulate"),Ar(e,t,s)).then((e=>xr(e).then((e=>({results:e.results})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.updateMetaTxnGasLimits=(e,t,s)=>this.fetch(this.url("UpdateMetaTxnGasLimits"),Ar(e,t,s)).then((e=>xr(e).then((e=>({payload:e.payload})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.feeTokens=(e,t)=>this.fetch(this.url("FeeTokens"),Ar({},e,t)).then((e=>xr(e).then((e=>({isFeeRequired:e.isFeeRequired,tokens:e.tokens})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.feeOptions=(e,t,s)=>this.fetch(this.url("FeeOptions"),Ar(e,t,s)).then((e=>xr(e).then((e=>({options:e.options,sponsored:e.sponsored,quote:e.quote})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.getMetaTxnNetworkFeeOptions=(e,t,s)=>this.fetch(this.url("GetMetaTxnNetworkFeeOptions"),Ar(e,t,s)).then((e=>xr(e).then((e=>({options:e.options})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.getMetaTransactions=(e,t,s)=>this.fetch(this.url("GetMetaTransactions"),Ar(e,t,s)).then((e=>xr(e).then((e=>({page:e.page,transactions:e.transactions})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.sentTransactions=(e,t,s)=>this.fetch(this.url("SentTransactions"),Ar(e,t,s)).then((e=>xr(e).then((e=>({page:e.page,transactions:e.transactions})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.pendingTransactions=(e,t,s)=>this.fetch(this.url("PendingTransactions"),Ar(e,t,s)).then((e=>xr(e).then((e=>({page:e.page,transactions:e.transactions})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.getGasTank=(e,t,s)=>this.fetch(this.url("GetGasTank"),Ar(e,t,s)).then((e=>xr(e).then((e=>({gasTank:e.gasTank})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.addGasTank=(e,t,s)=>this.fetch(this.url("AddGasTank"),Ar(e,t,s)).then((e=>xr(e).then((e=>({status:e.status,gasTank:e.gasTank})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.updateGasTank=(e,t,s)=>this.fetch(this.url("UpdateGasTank"),Ar(e,t,s)).then((e=>xr(e).then((e=>({status:e.status,gasTank:e.gasTank})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.getGasSponsor=(e,t,s)=>this.fetch(this.url("GetGasSponsor"),Ar(e,t,s)).then((e=>xr(e).then((e=>({gasSponsor:e.gasSponsor})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.addressGasSponsors=(e,t,s)=>this.fetch(this.url("AddressGasSponsors"),Ar(e,t,s)).then((e=>xr(e).then((e=>({page:e.page,gasSponsors:e.gasSponsors})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.listGasSponsors=(e,t,s)=>this.fetch(this.url("ListGasSponsors"),Ar(e,t,s)).then((e=>xr(e).then((e=>({page:e.page,gasSponsors:e.gasSponsors})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.addGasSponsor=(e,t,s)=>this.fetch(this.url("AddGasSponsor"),Ar(e,t,s)).then((e=>xr(e).then((e=>({status:e.status,gasSponsor:e.gasSponsor})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.updateGasSponsor=(e,t,s)=>this.fetch(this.url("UpdateGasSponsor"),Ar(e,t,s)).then((e=>xr(e).then((e=>({status:e.status,gasSponsor:e.gasSponsor})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.removeGasSponsor=(e,t,s)=>this.fetch(this.url("RemoveGasSponsor"),Ar(e,t,s)).then((e=>xr(e).then((e=>({status:e.status})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.reportGasSponsorUsage=(e,t,s)=>this.fetch(this.url("ReportGasSponsorUsage"),Ar(e,t,s)).then((e=>xr(e).then((e=>({gasSponsorUsage:e.gasSponsorUsage})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.nextGasTankBalanceAdjustmentNonce=(e,t,s)=>this.fetch(this.url("NextGasTankBalanceAdjustmentNonce"),Ar(e,t,s)).then((e=>xr(e).then((e=>({nonce:e.nonce})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.adjustGasTankBalance=(e,t,s)=>this.fetch(this.url("AdjustGasTankBalance"),Ar(e,t,s)).then((e=>xr(e).then((e=>({status:e.status,adjustment:e.adjustment})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.getGasTankBalanceAdjustment=(e,t,s)=>this.fetch(this.url("GetGasTankBalanceAdjustment"),Ar(e,t,s)).then((e=>xr(e).then((e=>({adjustment:e.adjustment})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.listGasTankBalanceAdjustments=(e,t,s)=>this.fetch(this.url("ListGasTankBalanceAdjustments"),Ar(e,t,s)).then((e=>xr(e).then((e=>({page:e.page,adjustments:e.adjustments})))),(e=>{throw Rr.new({cause:`fetch(): ${e.message||""}`})})),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const Ar=(e={},t={},s=null)=>({method:"POST",headers:o({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{}),signal:s}),xr=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){let n="";throw s instanceof Error&&(n=s.message),$r.new({status:e.status,cause:`JSON.parse(): ${n}: response text: ${t}`})}if(!e.ok){const e="number"==typeof s.code?s.code:0;throw(Xr[e]||Pr).new(s)}return s}));class Pr extends Error{constructor(e,t,s,n,r){super(s),this.name=void 0,this.code=void 0,this.message=void 0,this.status=void 0,this.cause=void 0,this.msg=void 0,this.name=e||"WebrpcError",this.code="number"==typeof t?t:0,this.message=s||`endpoint error ${this.code}`,this.msg=this.message,this.status="number"==typeof n?n:0,this.cause=r,Object.setPrototypeOf(this,Pr.prototype)}static new(e){return new this(e.error,e.code,e.message||e.msg,e.status,e.cause)}}class Nr extends Pr{constructor(e="WebrpcEndpoint",t=0,s="endpoint error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Nr.prototype)}}class Rr extends Pr{constructor(e="WebrpcRequestFailed",t=-1,s="request failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Rr.prototype)}}class Mr extends Pr{constructor(e="WebrpcBadRoute",t=-2,s="bad route",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Mr.prototype)}}class Lr extends Pr{constructor(e="WebrpcBadMethod",t=-3,s="bad method",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Lr.prototype)}}class Br extends Pr{constructor(e="WebrpcBadRequest",t=-4,s="bad request",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Br.prototype)}}class $r extends Pr{constructor(e="WebrpcBadResponse",t=-5,s="bad response",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,$r.prototype)}}class Dr extends Pr{constructor(e="WebrpcServerPanic",t=-6,s="server panic",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Dr.prototype)}}class Wr extends Pr{constructor(e="WebrpcInternalError",t=-7,s="internal error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Wr.prototype)}}class jr extends Pr{constructor(e="WebrpcClientDisconnected",t=-8,s="client disconnected",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,jr.prototype)}}class Ur extends Pr{constructor(e="WebrpcStreamLost",t=-9,s="stream lost",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ur.prototype)}}class Hr extends Pr{constructor(e="WebrpcStreamFinished",t=-10,s="stream finished",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Hr.prototype)}}class qr extends Pr{constructor(e="Unauthorized",t=1e3,s="Unauthorized access",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,qr.prototype)}}class Fr extends Pr{constructor(e="PermissionDenied",t=1001,s="Permission denied",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Fr.prototype)}}class Gr extends Pr{constructor(e="MethodNotFound",t=1003,s="Method not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Gr.prototype)}}class Vr extends Pr{constructor(e="Aborted",t=1005,s="Request aborted",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Vr.prototype)}}class Kr extends Pr{constructor(e="InvalidArgument",t=2001,s="Invalid argument",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Kr.prototype)}}class zr extends Pr{constructor(e="Unavailable",t=2002,s="Unavailable resource",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,zr.prototype)}}class Jr extends Pr{constructor(e="QueryFailed",t=2003,s="Query failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Jr.prototype)}}class Yr extends Pr{constructor(e="NotFound",t=3e3,s="Resource not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Yr.prototype)}}let Qr=function(e){return e.WebrpcEndpoint="WebrpcEndpoint",e.WebrpcRequestFailed="WebrpcRequestFailed",e.WebrpcBadRoute="WebrpcBadRoute",e.WebrpcBadMethod="WebrpcBadMethod",e.WebrpcBadRequest="WebrpcBadRequest",e.WebrpcBadResponse="WebrpcBadResponse",e.WebrpcServerPanic="WebrpcServerPanic",e.WebrpcInternalError="WebrpcInternalError",e.WebrpcClientDisconnected="WebrpcClientDisconnected",e.WebrpcStreamLost="WebrpcStreamLost",e.WebrpcStreamFinished="WebrpcStreamFinished",e.Unauthorized="Unauthorized",e.PermissionDenied="PermissionDenied",e.MethodNotFound="MethodNotFound",e.Aborted="Aborted",e.InvalidArgument="InvalidArgument",e.Unavailable="Unavailable",e.QueryFailed="QueryFailed",e.NotFound="NotFound",e}({});const Xr={0:Nr,[-1]:Rr,[-2]:Mr,[-3]:Lr,[-4]:Br,[-5]:$r,[-6]:Dr,[-7]:Wr,[-8]:jr,[-9]:Ur,[-10]:Hr,1e3:qr,1001:Fr,1003:Gr,1005:Vr,2001:Kr,2002:zr,2003:Jr,3e3:Yr};var Zr=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.1",WebRPCSchemaHash:"1e27d0fd295aa5897878939595ef0c6adc54b1a3",ETHTxnStatus:Sr,TransferType:Or,FeeTokenType:kr,SortOrder:Cr,Relayer:_r,WebrpcError:Pr,WebrpcEndpointError:Nr,WebrpcRequestFailedError:Rr,WebrpcBadRouteError:Mr,WebrpcBadMethodError:Lr,WebrpcBadRequestError:Br,WebrpcBadResponseError:$r,WebrpcServerPanicError:Dr,WebrpcInternalErrorError:Wr,WebrpcClientDisconnectedError:jr,WebrpcStreamLostError:Ur,WebrpcStreamFinishedError:Hr,UnauthorizedError:qr,PermissionDeniedError:Fr,MethodNotFoundError:Gr,AbortedError:Vr,InvalidArgumentError:Kr,UnavailableError:zr,QueryFailedError:Jr,NotFoundError:Yr,errors:Qr});const ei=[Sr.DROPPED,Sr.SUCCEEDED,Sr.PARTIALLY_FAILED,Sr.FAILED],ti=[Sr.DROPPED,Sr.PARTIALLY_FAILED,Sr.FAILED];const si=globalThis.fetch;class ni{constructor(e){if(this.options=e,this.service=void 0,this.provider=void 0,this._fetch=(e,t)=>{const s={},{jwtAuth:n,projectAccessKey:r}=this.options;return n&&n.length>0&&(s.Authorization=`BEARER ${n}`),r&&r.length>0&&(s["X-Access-Key"]=r),t.headers=o({},t.headers,s),si(e,t)},this.service=new _r(e.url,this._fetch),ii(e.provider))this.provider=e.provider;else{const{jwtAuth:s,projectAccessKey:n}=this.options,r=tt(e.provider.url,n,s);this.provider=new t.ethers.JsonRpcProvider(r,void 0,{staticNetwork:!0})}}async waitReceipt(e,t=1e3,s=5,n){"string"!=typeof e&&(e=_n(e)),Xe.info(`[rpc-relayer/waitReceipt] waiting for ${e}`);let r=0;for(;void 0===n||!n();){try{const{receipt:t}=await this.service.getMetaTxnReceipt({metaTxID:e});if(t&&t.txnReceipt&&"null"!==t.txnReceipt&&ei.includes(t.status))return{receipt:t}}catch(e){if(r++,r===s)throw e}void 0!==n&&n()||await new Promise((e=>setTimeout(e,t)))}throw new Error(`Cancelled waiting for transaction receipt ${e}`)}async simulate(e,...s){const n=t.ethers.AbiCoder.defaultAbiCoder().encode([Cn],[Dn(s)]);return(await this.service.simulate({wallet:e,transactions:n})).results}async getFeeOptions(e,...t){const s=await this.service.feeTokens();if(s.isFeeRequired){const n=s.tokens.map((e=>e.symbol)).join(", ");Xe.info(`[rpc-relayer/getFeeOptions] relayer fees are required, accepted tokens are ${n}`);const r=await this.getNonce(e);if(!this.provider)throw Xe.warn("[rpc-relayer/getFeeOptions] provider not set, needed for stub signature"),new Error("provider is not set");const{options:i,quote:o}=await this.service.feeOptions({wallet:e,to:e,data:Gn({entrypoint:e,transactions:t,nonce:r})});return Xe.info(`[rpc-relayer/getFeeOptions] got refund options ${JSON.stringify(i,Ue)}`),{options:i,quote:{_tag:"FeeQuote",_quote:o}}}return Xe.info("[rpc-relayer/getFeeOptions] relayer fees are not required"),{options:[]}}async getFeeOptionsRaw(e,s,n){const{options:r,quote:i}=await this.service.feeOptions({wallet:e,to:e,data:t.ethers.hexlify(s),simulate:null==n?void 0:n.simulate});return{options:r,quote:{_tag:"FeeQuote",_quote:i}}}async gasRefundOptions(e,...t){const{options:s}=await this.getFeeOptions(e,...t);return s}async getNonce(e,t){Xe.info(`[rpc-relayer/getNonce] get nonce for wallet ${e} space: ${t}`);const s=void 0!==t?De(BigInt(t)):void 0,n=await this.service.getMetaTxnNonce({walletContractAddress:e,space:s}),r=BigInt(n.nonce),[i,o]=Un(r);return Xe.info(`[rpc-relayer/getNonce] got next nonce for wallet ${e} ${o} space: ${i}`),r}async relay(e,t,s=!0){var n=this;let r;if(Xe.info(`[rpc-relayer/relay] relaying signed meta-transactions ${JSON.stringify(e,Ue)} with quote ${JSON.stringify(t,Ue)}`),void 0!==t&&("string"==typeof t._quote?r=t._quote:Xe.warn("[rpc-relayer/relay] ignoring invalid fee quote")),!this.provider)throw Xe.warn("[rpc-relayer/relay] provider not set, failed relay"),new Error("provider is not set");const i=Gn(e),o=await this.service.sendMetaTxn({call:{walletAddress:e.intent.wallet,contract:e.entrypoint,input:i},quote:r});if(Xe.info(`[rpc-relayer/relay] got relay result ${JSON.stringify(o,Ue)}`),s)return this.wait(e.intent.id);{const t={hash:e.intent.id,confirmations:0,from:e.intent.wallet,wait:e=>Promise.reject(new Error("impossible"))},s=async function(s){var r;if(!n.provider)throw new Error("cannot wait for receipt, relayer has no provider set");const i=await n.wait(e.intent.id),o=null==(r=i.receipt)?void 0:r.transactionHash;if(!o)throw new Error("cannot wait for receipt, unknown native transaction hash");return Object.assign(t,i),n.provider.waitForTransaction(o,s)};return t.wait=s,t}}async wait(e,t,s=1e3,n=5){var r=this;let i=!1;const{receipt:o}=await(void 0!==t?Promise.race([this.waitReceipt(e,s,n,(()=>i)),new Promise(((s,n)=>setTimeout((()=>{i=!0,n(`Timeout waiting for transaction receipt ${e}`)}),t)))]):this.waitReceipt(e,s,n));if(!o.txnReceipt||ti.includes(o.status))throw new ri(o);const a=JSON.parse(o.txnReceipt);return{blockHash:a.blockHash,blockNumber:Number(a.blockNumber),confirmations:1,from:"string"==typeof e?void 0:e.intent.wallet,hash:a.transactionHash,raw:o.txnReceipt,receipt:a,wait:async function(e){return r.provider.waitForTransaction(a.transactionHash,e)}}}}class ri{constructor(e){this.receipt=e}}function ii(e){return e&&"object"==typeof e&&"function"==typeof e.getNetwork&&"function"==typeof e.getBlockNumber}function oi(e){return"object"==typeof e&&"function"==typeof e.simulate&&"function"==typeof e.getFeeOptions&&"function"==typeof e.gasRefundOptions&&"function"==typeof e.getNonce&&"function"==typeof e.relay&&"function"==typeof e.wait}t.ethers.AbstractSigner;async function ai(e){return Array.isArray(e)?Promise.all(e.map((e=>t.ethers.resolveProperties(e)))):t.ethers.resolveProperties(e)}function ci(e){return void 0!==e.getAddress&&void 0!==e.buildDeployTransaction&&void 0!==e.predecorateSignedTransactions&&void 0!==e.decorateTransactions&&void 0!==e.sign&&void 0!==e.notifyStatusChange}class hi{constructor(e,t=!0){this.signer=e,this.eoa=t}getAddress(){return this.signer.getAddress()}async buildDeployTransaction(e){}async predecorateSignedTransactions(e){return[]}async decorateTransactions(e,t){return e}sign(e){return this.signer.signMessage(e)}notifyStatusChange(e,t,s){}suffix(){return new Uint8Array([2])}}var li=Object.freeze({__proto__:null,isSapientSigner:ci,SignerWrapper:hi});let di=function(e){return e[e.INITIAL=0]="INITIAL",e[e.SIGNING=1]="SIGNING",e[e.SIGNED=2]="SIGNED",e[e.ERROR=3]="ERROR",e}({});function ui(e){return void 0===e||e.state===di.INITIAL||e.state===di.SIGNING}class fi{constructor(e,t=fi.randomTag()){this.tag=t,this.observers=[],this.signers=[],this.count=0,this.setSigners(e)}static randomTag(){return`default-${t.ethers.hexlify(t.ethers.randomBytes(8)).slice(2)}`}pullId(){return`${this.tag}-${this.count++}`}setSigners(e){this.signers=e.map((e=>ci(e)?e:new hi(e)))}async getSigners(){return Promise.all(this.signers.map((async function(e){return e.getAddress()})))}subscribe(e){return this.observers.push(e),()=>{this.observers=this.observers.filter((t=>t!==e))}}async notifyObservers(e,t,s){await Promise.all([...this.signers.map((async function(n){return n.notifyStatusChange(e,t,s)})),...this.observers.map((async function(e){return e(t,s)}))])}async buildDeployTransaction(e){let t;for(const s of this.signers){const n=await s.buildDeployTransaction(e);void 0===t?t=n:null!=n&&n.transactions&&(t.transactions=n.transactions.concat(t.transactions))}return t}async predecorateSignedTransactions(e){const t=[];for(const s of this.signers)t.push(...await s.predecorateSignedTransactions(null!=e?e:{}));return t}async decorateTransactions(e,t){for(const s of this.signers)e=await s.decorateTransactions(e,null!=t?t:{});return e}signMessage(e){var t=this;const s=this.pullId();return new Promise((async function(n){const{message:r,metadata:i,callback:o,candidates:a}=e,c={ended:!1,message:r,signers:{}};let h=null!=i?i:{};const l=e=>{h=e,t.notifyObservers(s,c,h)},d=()=>{try{t.notifyObservers(s,c,h);const e=Object.entries(c.signers).filter((([e,t])=>ui(t)));if(o&&o(c,l)||0===e.length)return c.ended=!0,n(c),void t.notifyObservers(s,c,h)}catch(e){console.error("Error while notifying observers",e)}};let u=t.signers;if(a){const e=await Promise.all(t.signers.map((async function(e){return e.getAddress()})));u=t.signers.filter(((t,s)=>a.includes(e[s])))}const f=await Promise.allSettled(u.map((async function(e){const t=await e.getAddress();c.signers[t]={state:di.SIGNING,request:e.sign(r,null!=i?i:{}).then((s=>{const n=e.suffix();return c.signers[t]={state:di.SIGNED,signature:s,suffix:n},d(),s})).catch((e=>{throw c.signers[t]={state:di.ERROR,error:e},d(),e}))}})));for(let e=0;e<f.length;e++){const s=t.signers[e],n=f[e];if("rejected"===n.status){const e=await s.getAddress();console.warn(`signer ${e} rejected the request: ${n.reason}`),c.signers[e]={state:di.ERROR,error:new Error(`signer ${e} rejected the request: ${n.reason}`)}}}d()}))}}const pi=e=>{const s=new Map;for(const n of Object.keys(e.signers)){const r=e.signers[n];if(r.state===di.SIGNED){const e=t.ethers.getBytes(r.suffix),i=t.ethers.solidityPacked(["bytes","bytes"],[r.signature,e]);s.set(n,{signature:i,isDynamic:1!==e.length||2!==e[0]})}}return s};class gi extends t.ethers.AbstractSigner{constructor(e){var t;const s=BigInt(e.chainId);if(0n===s&&!e.coders.signature.supportsNoChainId)throw new Error(`Sequence version ${e.config.version} doesn't support chainId 0`);super(null!=(t=e.provider)?t:null),this.context=void 0,this.config=void 0,this.address=void 0,this.chainId=void 0,this.relayer=void 0,this.coders=void 0,this.orchestrator=void 0,this._reader=void 0,this.context=e.context,this.config=e.config,this.orchestrator=e.orchestrator,this.coders=e.coders,this.address=e.address,this.chainId=s,this.relayer=e.relayer,this._reader=e.reader}static newWallet(e){const t=Sn(e.context,e.coders.config.imageHashOf(e.config));return new gi(o({},e,{address:t}))}reader(){if(this._reader)return this._reader;if(!this.provider)throw new Error("Wallet status provider requires a provider");return new tr(this.provider)}setConfig(e){this.config=e}setOrchestrator(e){this.orchestrator=e}setAddress(e){this.address=e}getSigners(){return this.orchestrator.getSigners()}async getAddress(){return this.address}async decorateTransactions(e){const t=await this.orchestrator.decorateTransactions(e);if(await this.reader().isDeployed(this.address))return t;const s=[{to:t.entrypoint,data:Gn(t),revertOnError:!0}],n=await this.buildDeployTransaction();return n&&s.unshift(...n.transactions),{entrypoint:this.context.guestModule,chainId:this.chainId,intent:t.intent,transactions:s}}async buildDeployTransaction(e){if(null!=e&&e.ignoreDeployed&&await this.reader().isDeployed(this.address))return;const t=this.coders.config.imageHashOf(this.config);if(Sn(this.context,t)!==this.address)throw new Error(`First address of config ${t} doesn't match wallet address ${this.address}`);let s;if(this.chainId===BigInt(ke.SKALE_NEBULA))s=10000000n;const n=gi.buildDeployTransaction(this.context,t,s);if(null!=e&&e.includeChildren){const t=await this.orchestrator.buildDeployTransaction(e);t&&(n.transactions=t.transactions.concat(n.transactions))}return n}async deploy(e){const s=await this.buildDeployTransaction(e);if(void 0!==s){if(!this.relayer)throw new Error("Wallet deploy requires a relayer");return this.relayer.relay(o({},s,{chainId:this.chainId,intent:{id:t.ethers.hexlify(t.ethers.randomBytes(32)),wallet:this.address}}))}}static buildDeployTransaction(e,s,n=100000n){const i=new t.ethers.Interface(r.factory.abi);return{entrypoint:e.guestModule,transactions:[{to:e.factory,data:i.encodeFunctionData(i.getFunction("deploy"),[e.mainModule,s]),gasLimit:n,delegateCall:!1,revertOnError:!0,value:0}]}}async buildUpdateConfigurationTransaction(e){if(this.coders.config.update.isKindUsed){const t=await this.reader().implementation(this.address),s=t&&t===this.context.mainModuleUpgradable;return this.coders.config.update.buildTransaction(this.address,e,this.context,s?"later":"first")}return this.coders.config.update.buildTransaction(this.address,e,this.context)}async getNonce(e=0){const t=await this.reader().nonce(this.address,e);if(void 0===t)throw new Error("Unable to determine nonce");return Number(t)}async signDigest(e,s){const n=Ke(this.address,this.chainId,e);if(this.coders.config.hasSubdigest(this.config,n))return this.coders.signature.encodeSigners(this.config,new Map,[n],this.chainId).encoded;const r=o({},s,{digest:e,chainId:this.chainId,address:this.address,config:this.config}),i=t.ethers.getBytes(n),a=await this.orchestrator.signMessage({candidates:this.coders.config.signersOf(this.config).map((e=>e.address)),message:i,metadata:r,callback:(e,t)=>{const s=pi(e);return t(o({},r,{parts:s})),this.coders.signature.hasEnoughSigningPower(this.config,s)}}),c=pi(a);return this.coders.signature.encodeSigners(this.config,c,[],this.chainId).encoded}signMessage(e){return this.signDigest(t.ethers.keccak256(e),{message:e})}signTypedData(e,t,s){const n=at({domain:e,types:t,message:s});return this.signDigest(n)}signTransactionBundle(e){if(e.entrypoint!==this.address)throw new Error(`Invalid entrypoint: ${e.entrypoint} !== ${this.address}`);return this.signTransactions(e.transactions,e.nonce)}async fetchNonceOrSpace(e){let t;if(e&&void 0!==e.space)t=BigInt(e.space);else{if(void 0===e)return this.randomNonce();if(!e||!0!==e.serial)return e;t=0}const s=await this.reader().nonce(this.address,t);if(void 0===s)throw new Error("Unable to determine nonce");return jn(t,s)}randomNonce(){return jn(BigInt(t.ethers.hexlify(t.ethers.randomBytes(12))),0)}async signTransactions(e,t,s){const n=await ai(e),r=Hn(this.address,n);0===r.length&&r.push({to:this.address,data:"0x",value:0,gasLimit:0,delegateCall:!1,revertOnError:!0});const i=await this.fetchNonceOrSpace(t),a=Pn(i,r),c=o({digest:a,transactions:r},s),h=await this.signDigest(a,c);return{intent:{id:Ke(this.address,this.chainId,a),wallet:this.address},chainId:this.chainId,transactions:r,entrypoint:this.address,nonce:i,signature:h}}async sendSignedTransaction(e,t){if(!this.relayer)throw new Error("Wallet sendTransaction requires a relayer");return this.relayer.relay(e,t)}async sendTransaction(e,t){let s;s=void 0!==(null==t?void 0:t.nonce)?t.nonce:null!=t&&t.serial?{serial:!0}:this.randomNonce();const n=await this.signTransactions(e,s),r=await this.decorateTransactions(n);return this.sendSignedTransaction(r,null==t?void 0:t.quote)}async fillGasLimits(e){const t=await ai(e),s=Hn(this.address,t),n=this.relayer;if(!n)throw new Error("Wallet fillGasLimits requires a relayer");const r=await n.simulate(this.address,...s);return s.map(((e,t)=>{const s=e.gasLimit?Number(e.gasLimit):r[t].gasLimit;return o({},e,r[t],{gasLimit:s})}))}connect(e,t){return new gi({coders:this.coders,context:this.context,config:this.config,chainId:this.chainId,address:this.address,orchestrator:this.orchestrator,reader:this._reader,provider:e,relayer:null!=t?t:this.relayer})}signTransaction(e){throw new Error("Method not implemented.")}}function mi(e){if(!e)return[];const s=BigInt(e.value);switch(e.token.type){case kr.UNKNOWN:return[{delegateCall:!1,revertOnError:!0,gasLimit:e.gasLimit,to:e.to,value:De(s),data:"0x"}];case kr.ERC20_TOKEN:if(!e.token.contractAddress)throw new Error("No contract address for ERC-20 fee option");return[{delegateCall:!1,revertOnError:!0,gasLimit:e.gasLimit,to:e.token.contractAddress,value:0,data:new t.ethers.Interface([{constant:!1,inputs:[{type:"address"},{type:"uint256"}],name:"transfer",outputs:[],type:"function"}]).encodeFunctionData("transfer",[e.to,De(s)])}];default:throw new Error(`Unhandled fee token type ${e.token.type}`)}}class wi{constructor(e,t,s){this.account=e,this.chainId=t,this.options=s}get provider(){return this.account.providerFor(this.chainId)}async getAddress(){return this.account.address}signMessage(e){var t,s;return this.account.signMessage(e,this.chainId,null!=(t=null==(s=this.options)?void 0:s.cantValidateBehavior)?t:"throw")}signTypedData(e,t,s){var n,r;return this.account.signTypedData(e,t,s,this.chainId,null!=(n=null==(r=this.options)?void 0:r.cantValidateBehavior)?n:"throw")}async defaultSelectFee(e,s){if(0===s.length)return;const n=[{constant:!0,inputs:[{type:"address"}],name:"balanceOf",outputs:[{type:"uint256"}],type:"function"}];for(const e of s)if(e.token.type===kr.UNKNOWN){if(await this.getBalance()>=BigInt(e.value))return e}else if(e.token.contractAddress&&e.token.type===kr.ERC20_TOKEN){const s=new t.ethers.Contract(e.token.contractAddress,n,this.provider);if(await s.balanceOf(this.account.address)>=BigInt(e.value))return e}throw new Error("No fee option available - not enough balance")}async sendTransaction(e,t){var s,n,r,i,o;const a=await this.account.prepareTransactions({txs:e,chainId:this.chainId,stubSignatureOverrides:null!=(s=null==(n=this.options)?void 0:n.stubSignatureOverrides)?s:new Map,simulateForFeeOptions:null==t?void 0:t.simulateForFeeOptions}),c=null!=(r=null==(i=this.options)?void 0:i.selectFee)?r:this.defaultSelectFee.bind(this),h=await c(e,a.feeOptions),l=[...a.transactions,...mi(h)];return this.account.sendTransaction(l,this.chainId,a.feeQuote,void 0,void 0,void 0!==(null==(o=this.options)?void 0:o.nonceSpace)?{nonceSpace:this.options.nonceSpace}:void 0)}getBalance(e){return this.provider.getBalance(this.account.address,e)}call(e,t){return this.provider.call(o({},e,{blockTag:t}))}async resolveName(e){const t=await this.provider.resolveName(e);if(!t)throw new Error(`Could not resolve name ${e}`);return t}connect(e){throw new Error("Method not implemented.")}signTransaction(e){throw new Error("Method not implemented.")}getTransactionCount(e){throw new Error("Method not implemented.")}estimateGas(e){throw new Error("Method not implemented.")}getChainId(){return Promise.resolve(Number(this.chainId))}getGasPrice(){throw new Error("Method not implemented.")}getFeeData(){throw new Error("Method not implemented.")}getNonce(e){throw new Error("Method not implemented.")}populateCall(e){throw new Error("Method not implemented.")}checkTransaction(e){throw new Error("Method not implemented.")}async populateTransaction(e){throw new Error("Method not implemented.")}_checkProvider(e){throw new Error("Method not implemented.")}}class yi{async isDeployed(e){return!1}async implementation(e){}async imageHash(e){}async nonce(e,t){return 0n}async isValidSignature(e,t,s){throw new Error("Method not supported.")}}class bi{constructor(e){this.address=void 0,this.networks=void 0,this.tracker=void 0,this.contexts=void 0,this.migrator=void 0,this.migrations=void 0,this.orchestrator=void 0,this.jwt=void 0,this.projectAccessKey=void 0,this.address=t.ethers.getAddress(e.address),this.contexts=e.contexts,this.tracker=e.tracker,this.networks=e.networks,this.orchestrator=e.orchestrator,this.jwt=e.jwt,this.projectAccessKey=e.projectAccessKey,this.migrations=e.migrations||yr,this.migrator=new mr(e.tracker,this.migrations,this.contexts)}getSigner(e,t){return new wi(this,e,t)}static async new(e){var t;const s=new mr(e.tracker,null!=(t=e.migrations)?t:yr,e.contexts).lastMigration(),n=s.configCoder,r=n.fromSimple(e.config),i=n.imageHashOf(r),o=Sn(e.contexts[s.version],i);return await e.tracker.saveCounterfactualWallet({config:r,context:Object.values(e.contexts)}),new bi({address:o,tracker:e.tracker,contexts:e.contexts,networks:e.networks,orchestrator:e.orchestrator,migrations:e.migrations,projectAccessKey:e.projectAccessKey})}getAddress(){return Promise.resolve(this.address)}get version(){return this.migrator.lastMigration().version}get coders(){const e=this.migrator.lastMigration();return{signature:e.signatureCoder,config:e.configCoder}}network(e){const t=BigInt(e),s=this.networks.find((e=>t===BigInt(e.chainId)));if(!s)throw new Error(`Network not found for chainId ${e}`);return s}providerFor(e){const s=this.network(e);if(!s.provider&&!s.rpcUrl)throw new Error(`Provider not found for chainId ${e}`);const n=new t.ethers.Network(s.name,s.chainId);return s.provider||new t.ethers.JsonRpcProvider(tt(s.rpcUrl,this.projectAccessKey,this.jwt),n,{staticNetwork:n})}reader(e){return 0n===BigInt(e)?new yi:new tr(this.providerFor(e))}relayer(e){const t=this.network(e);if(!t.relayer)throw new Error(`Relayer not found for chainId ${e}`);return oi(t.relayer)?t.relayer:new ni(o({},t.relayer,this.projectAccessKey?{projectAccessKey:this.projectAccessKey}:{jwtAuth:this.jwt}))}setOrchestrator(e){this.orchestrator=e}setJwt(e){this.jwt=e}contextFor(e){const t=this.contexts[e];if(!t)throw new Error(`Context not found for version ${e}`);return t}walletForStatus(e,t){const s=or(t.version);return this.walletFor(e,this.contextFor(t.version),t.config,s)}walletFor(e,t,s,n){const r=0n===BigInt(e);return new gi({config:s,context:t,chainId:e,coders:n,relayer:r?void 0:this.relayer(e),address:this.address,orchestrator:this.orchestrator,reader:this.reader(e)})}async status(e,t=!1){var s=this;const n=this.reader(e).isDeployed(this.address),r=this.tracker.imageHashOfCounterfactualWallet({wallet:this.address}).then((e=>{if(!e)throw new Error(`Counterfactual imageHash not found for wallet ${this.address}`);return e})),i=r.then((e=>dr(this.address,e.imageHash,Object.values(this.contexts)))),a=async function(){if(!await n)return i;const t=await s.reader(e).implementation(s.address);if(!t)throw new Error(`Implementation not found for wallet ${s.address}`);const r=Object.values(s.contexts);for(let e=0;e<r.length;e++)if(r[e].mainModule===t||r[e].mainModuleUpgradable===t)return r[e].version;throw new Error(`Version not found for implementation ${t}`)}(),c=async function(){const t=await s.reader(e).imageHash(s.address);if(t)return t;const n=await r;if(n)return n.imageHash;throw new Error(`On-chain imageHash not found for wallet ${s.address}`)}(),h=async function(){const e=await c,t=await s.tracker.configOfImageHash({imageHash:e});if(t)return t;throw new Error(`On-chain config not found for imageHash ${e}`)}(),l=await a,d=await c;let u=d,f=l,p=[];if(l!==this.version){const t=await this.migrator.getAllMigratePresignedTransaction({address:this.address,fromImageHash:d,fromVersion:l,chainId:e});u=t.lastImageHash,f=t.lastVersion,p=t.signedMigrations}const g=await this.tracker.loadPresignedConfiguration({wallet:this.address,fromImageHash:u,longestPath:t}),m=g&&g.length>0?g[g.length-1].nextImageHash:u,w=await this.tracker.configOfImageHash({imageHash:m});if(!w)throw new Error(`Config not found for imageHash ${m}`);const y=await n,b=await r,v=or(f).config.checkpointOf(w);return{original:o({},b,{version:await i}),onChain:{imageHash:d,config:await h,version:l,deployed:y},fullyMigrated:f===this.version,signedMigrations:p,version:f,presignedConfigurations:g,imageHash:m,config:w,checkpoint:v,canOnchainValidate:l===this.version&&y}}mustBeFullyMigrated(e){if(!e.fullyMigrated)throw new Error(`Wallet ${this.address} is not fully migrated`)}async predecorateSignedTransactions(e,t){const s=await this.orchestrator.predecorateSignedTransactions({chainId:t}),n=await this.predecorateTransactions([],e,t);return Hn(this.address,n).length>0&&s.push(await this.signTransactions(n,t)),s}async predecorateTransactions(e,t,s){if(t.onChain.imageHash!==t.imageHash){const n=this.walletForStatus(s,t),r=await n.buildUpdateConfigurationTransaction(t.config);return[Array.isArray(e)?e:[e],r.transactions].flat()}return e}async decorateTransactions(e,t,s){var n,r;if(!Array.isArray(e))return this.decorateTransactions([e],t,s);s=null!=(n=s)?n:e[0].chainId;const i=await this.buildBootstrapTransactions(t,s),o=i.transactions.length>0;if(!o&&1===e.length)return e[0];const{entrypoint:a}=o?i:e[0],c={entrypoint:a,chainId:s,intent:null==(r=e[0])?void 0:r.intent,transactions:[...i.transactions,...e.map((e=>({to:e.entrypoint,data:Gn(e),gasLimit:0,delegateCall:!1,revertOnError:!0,value:0})))]};if(!t.onChain.deployed){const e=Rn(this.contexts[this.version].guestModule,s,c.transactions);void 0===c.intent?c.intent={id:e,wallet:this.address}:c.intent.id=e}return c}async decorateSignature(e,t){if(!t.presignedConfigurations||0===t.presignedConfigurations.length)return e;const s=this.coders.signature,n=t.presignedConfigurations.map((e=>e.signature)),r=s.chainSignatures(e,n);return s.trim(r)}async publishWitnessFor(e,s=0){const n=t.ethers.id(`This is a Sequence account woo! ${Date.now()}`),r=await this.status(s),i=this.coders.config.fromSimple({threshold:e.length,checkpoint:0,signers:e.map((e=>({address:e,weight:1})))}),o=this.walletFor(s,r.original.context,i,this.coders),a=await o.signDigest(n),c=this.coders.signature.decode(a),h=this.coders.signature.signaturesOfDecoded(c);if(0===h.length)throw new Error("No signatures found");return this.tracker.saveWitnesses({wallet:this.address,digest:n,chainId:s,signatures:h})}async publishWitness(){const e=t.ethers.id(`This is a Sequence account woo! ${Date.now()}`),s=await this.signDigest(e,0,!1),n=this.coders.signature.decode(s),r=this.coders.signature.signaturesOfDecoded(n);return this.tracker.saveWitnesses({wallet:this.address,digest:e,chainId:0,signatures:r})}async signDigest(e,t,s=!0,n="ignore",r){const i=0n===BigInt(t)?this.networks[0].chainId:t,o=await this.status(i);if(this.mustBeFullyMigrated(o),!o.canOnchainValidate&&"throw"===n)throw new Error("Wallet cannot validate onchain");const a=this.walletForStatus(t,o),c=await a.signDigest(e,r),h=s?this.decorateSignature(c,o):c;if(!o.canOnchainValidate)switch(n){case"ignore":return h;case"eip6492":return this.buildEIP6492Signature(await h,o,t)}return h}buildOnChainSignature(e){const s=$t({digest:t.ethers.hexlify(e),chainId:0,address:this.address}),n=t.ethers.hexlify(s),i=this.coders.config.fromSimple({threshold:32768,checkpoint:0,signers:[],subdigests:[n]}),o=new t.ethers.Interface(r.mainModule.abi),a={entrypoint:this.address,transactions:[{to:this.address,data:o.encodeFunctionData("setExtraImageHash",[this.coders.config.imageHashOf(i),"57896044618658097711785492504343953926634992332820282019728792003956564819968"]),gasLimit:25e4}]};this.tracker.saveWalletConfig({config:i});return{bundle:a,signature:this.coders.signature.encodeSigners(i,new Map,[n],0).encoded}}async buildEIP6492Signature(e,s,n){const r=await this.buildBootstrapTransactions(s,n);if(0===r.transactions.length)throw new Error("Cannot build EIP-6492 signature without bootstrap transactions");const i=t.ethers.AbiCoder.defaultAbiCoder().encode(["address","bytes","bytes"],[r.entrypoint,Gn(r),e]);return t.ethers.solidityPacked(["bytes","bytes32"],[i,Xn])}async editConfig(e){const t=await this.status(0).then((e=>e.config)),s=this.coders.config.editConfig(t,o({},e,{checkpoint:this.coders.config.checkpointOf(t)+1n}));return this.updateConfig(s)}async updateConfig(e){if(!this.coders.config.isWalletConfig(e))throw new Error(`Invalid config for wallet ${this.address}`);const t=this.coders.config.imageHashOf(e),s=this.coders.signature.hashSetImageHash(t),n=await this.signDigest(s,0,!1);await this.tracker.savePresignedConfiguration({wallet:this.address,nextConfig:e,signature:n});const r=await this.tracker.configOfImageHash({imageHash:t,noCache:!0});if(!r||this.coders.config.imageHashOf(r)!==t)throw Error(`Reverse lookup failed for imageHash ${t}`)}async buildBootstrapTransactions(e,t){var s;const n=await this.orchestrator.buildDeployTransaction({chainId:t}),r=null!=(s=null==n?void 0:n.transactions)?s:[];if(!e.onChain.deployed){let s;if(BigInt(t)===BigInt(ke.SKALE_NEBULA))s=10000000n;const n=gi.buildDeployTransaction(e.original.context,e.original.imageHash,s);r.push(...n.transactions)}r.push(...e.signedMigrations.map((e=>({to:e.tx.entrypoint,data:Gn(e.tx),value:0,gasLimit:0,revertOnError:!0,delegateCall:!1}))));const i=e.signedMigrations.length>0?e.signedMigrations[0].tx.intent.id:Rn(this.contexts[this.version].guestModule,t,r),{guestModule:o}=this.contextFor(e.version);return{entrypoint:o,transactions:r,chainId:t,intent:{id:i,wallet:this.address}}}async bootstrapTransactions(e,t){const s=t||await this.status(e);return this.buildBootstrapTransactions(s,e)}async doBootstrap(e,t,s){const n=await this.bootstrapTransactions(e,s);return this.relayer(e).relay(o({},n,{chainId:e}),t)}signMessage(e,s,n="ignore"){return this.signDigest(t.ethers.keccak256(e),s,!0,n)}async signTransactions(e,t,s,n){const r=s||await this.status(t);this.mustBeFullyMigrated(r);const i=this.walletForStatus(t,r),a={address:this.address,digest:"",chainId:t,config:{version:this.version},decorate:!0,cantValidateBehavior:"ignore"},c=null!=n&&n.serial?{serial:!0}:void 0!==(null==n?void 0:n.nonceSpace)?{space:n.nonceSpace}:void 0,h=await i.signTransactions(e,c,a);return o({},h,{signature:await this.decorateSignature(h.signature,r)})}async signMigrations(e,t){const s=await this.status(e);if(s.fullyMigrated)return!1;const n=this.walletForStatus(e,s),r=t(n.config),i=await this.migrator.signNextMigration(this.address,s.version,n,r);if(!i)return!1;await this.tracker.saveWalletConfig({config:r});const o=or(r.version).config,a=o.imageHashOf(r),c=await this.tracker.configOfImageHash({imageHash:a,noCache:!0});if(!c||o.imageHashOf(c)!==a)throw Error(`Reverse lookup failed for imageHash ${a}`);return await this.tracker.saveMigration(this.address,i,this.contexts),!0}async signAllMigrations(e){var t=this;const s=[],n=(await Promise.all(this.networks.map((async function(n){try{return await t.signMigrations(n.chainId,e)}catch(e){return console.warn(`Failed to sign migrations for chain ${n.chainId}`,e),s.push(n.chainId),null}})))).filter((e=>null!==e));return{signedMigrations:n,failedChains:s}}async isMigratedAllChains(){var e=this;const t=[];return{migratedAllChains:(await Promise.all(this.networks.map((async function(s){try{return await e.status(s.chainId)}catch(e){return t.push(s.chainId),console.warn(`Failed to get status for chain ${s.chainId}`,e),{fullyMigrated:!0}}})))).every((e=>e.fullyMigrated)),failedChains:t}}async sendSignedTransactions(e,t,s,n,r){if(!Array.isArray(e))return this.sendSignedTransactions([e],t,s,n,r);const i=n||await this.status(t);this.mustBeFullyMigrated(i);const o=await this.decorateTransactions(e,i,t);return null==r||r(o),this.relayer(t).relay(o,s)}async fillGasLimits(e,t,s){return this.walletForStatus(t,s||await this.status(t)).fillGasLimits(e)}async gasRefundQuotes(e,s,n,r,i){const a=r||await this.status(s),c=this.walletForStatus(s,a),h=await this.predecorateTransactions(e,a,s),l=Hn(this.address,h),d=c.coders.config.buildStubSignature(c.config,n),u={chainId:s,intent:{id:t.ethers.hexlify(t.ethers.randomBytes(32)),wallet:this.address},signature:d,transactions:l,entrypoint:this.address,nonce:0},f=await this.decorateTransactions(u,a),p=Gn(f);return o({},await this.relayer(s).getFeeOptionsRaw(f.entrypoint,p,i),{decorated:f})}async prepareTransactions(e){const t=await this.status(e.chainId),s=await this.fillGasLimits(e.txs,e.chainId,t),n=await this.gasRefundQuotes(s,e.chainId,e.stubSignatureOverrides,t,{simulate:e.simulateForFeeOptions});return{transactions:s,flatDecorated:zn(this.address,n.decorated.transactions),feeOptions:n.options,feeQuote:n.quote}}async sendTransaction(e,t,s,n=!1,r,i){const o=await this.status(t),a=n?e:await this.predecorateTransactions(e,o,t),c=Hn(this.address,a).length>0?await this.signTransactions(a,t,void 0,i):void 0,h=await this.orchestrator.predecorateSignedTransactions({chainId:t}),l=[];return void 0!==c&&c.transactions.length>0&&l.push(c),l.push(...h.filter((e=>e.transactions.length>0))),this.sendSignedTransactions(l,t,s,void 0,r)}async signTypedData(e,t,s,n,r="ignore"){const i=at({domain:e,types:t,message:s});return this.signDigest(i,n,!0,r)}async getSigners(){var e=this;const t=e=>e.length?e[e.length-1]:void 0;return(await Promise.all(this.networks.map((async function({chainId:s,name:n}){try{var r;const n=await e.status(s);let i=null==(r=t(n.presignedConfigurations))?void 0:r.nextImageHash;if(!i&&n.onChain.version!==n.version){const e=t(n.signedMigrations);if(e){const{toVersion:t,toConfig:s}=e;i=ar(t).config.imageHashOf(s)}}i||(i=n.onChain.imageHash);const a=await e.tracker.configOfImageHash({imageHash:i});if(!a)throw new Error(`unable to find config for image hash ${i}`);const c=ar(a.version);return c.config.signersOf(a).map((e=>o({},e,{network:s})))}catch(e){return console.warn(`unable to get signers on network ${s} ${n}`,e),[]}})))).flat()}async getAllSigners(){var e=this;const t=[];return await Promise.all(this.networks.map((async function(s){const n=s.chainId,r=await e.status(n,!0),i=[r.onChain.imageHash,...r.onChain.version!==r.version?r.signedMigrations.map((e=>or(e.toVersion).config.imageHashOf(e.toConfig))):[],...r.presignedConfigurations.map((e=>e.nextImageHash))];return Promise.all(i.map((async function(s,r){const o=r===i.length-1,a=await e.tracker.configOfImageHash({imageHash:s});if(!a)return void console.warn(`AllSigners may be incomplete, config not found for imageHash ${s}`);ar(a.version).config.signersOf(a).forEach((e=>{const s=t.find((t=>t.address===e.address&&t.network===n));s&&o&&s.flaggedForRemoval?s.flaggedForRemoval=!1:s||t.push({address:e.address,weight:e.weight,network:n,flaggedForRemoval:!o})}))})))}))),t}}let vi=function(e){return e.UNKNOWN="UNKNOWN",e.NATIVE="NATIVE",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155",e.SEQUENCE_WALLET="SEQUENCE_WALLET",e.ERC20_BRIDGE="ERC20_BRIDGE",e.ERC721_BRIDGE="ERC721_BRIDGE",e.ERC1155_BRIDGE="ERC1155_BRIDGE",e.SEQ_MARKETPLACE="SEQ_MARKETPLACE",e}({}),Ei=function(e){return e.UNKNOWN="UNKNOWN",e.BLOCK_ADDED="BLOCK_ADDED",e.BLOCK_REMOVED="BLOCK_REMOVED",e}({}),Ii=function(e){return e.EVENT="EVENT",e.TOKEN_TRANSFER="TOKEN_TRANSFER",e.NATIVE_TOKEN_TRANSFER="NATIVE_TOKEN_TRANSFER",e.SEQUENCE_TXN="SEQUENCE_TXN",e}({}),Ti=function(e){return e.OPEN="OPEN",e.CLOSED="CLOSED",e.CANCELLED="CANCELLED",e}({}),Si=function(e){return e.UNKNOWN="UNKNOWN",e.SEND="SEND",e.RECEIVE="RECEIVE",e}({}),Oi=function(e){return e.FAILED="FAILED",e.SUCCESSFUL="SUCCESSFUL",e}({}),ki=function(e){return e.LegacyTxnType="LegacyTxnType",e.AccessListTxnType="AccessListTxnType",e.DynamicFeeTxnType="DynamicFeeTxnType",e}({}),Ci=function(e){return e.DESC="DESC",e.ASC="ASC",e}({}),_i=function(e){return e.VERIFIED="VERIFIED",e.UNVERIFIED="UNVERIFIED",e.ALL="ALL",e}({});class Ai{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Indexer/",this.ping=(e,t)=>this.fetch(this.url("Ping"),Pi({},e,t)).then((e=>Ni(e).then((e=>({status:e.status})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.version=(e,t)=>this.fetch(this.url("Version"),Pi({},e,t)).then((e=>Ni(e).then((e=>({version:e.version})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.runtimeStatus=(e,t)=>this.fetch(this.url("RuntimeStatus"),Pi({},e,t)).then((e=>Ni(e).then((e=>({status:e.status})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getChainID=(e,t)=>this.fetch(this.url("GetChainID"),Pi({},e,t)).then((e=>Ni(e).then((e=>({chainID:e.chainID})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getEtherBalance=(e,t,s)=>this.fetch(this.url("GetEtherBalance"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({balance:e.balance})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getNativeTokenBalance=(e,t,s)=>this.fetch(this.url("GetNativeTokenBalance"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({balance:e.balance})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getTokenBalancesSummary=(e,t,s)=>this.fetch(this.url("GetTokenBalancesSummary"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({page:e.page,balances:e.balances})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getTokenBalancesDetails=(e,t,s)=>this.fetch(this.url("GetTokenBalancesDetails"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({page:e.page,balances:e.balances})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getTokenBalancesByContract=(e,t,s)=>this.fetch(this.url("GetTokenBalancesByContract"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({page:e.page,balances:e.balances})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getTokenBalances=(e,t,s)=>this.fetch(this.url("GetTokenBalances"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({page:e.page,balances:e.balances})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getTokenSupplies=(e,t,s)=>this.fetch(this.url("GetTokenSupplies"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({page:e.page,contractType:e.contractType,tokenIDs:e.tokenIDs})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getTokenSuppliesMap=(e,t,s)=>this.fetch(this.url("GetTokenSuppliesMap"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({supplies:e.supplies})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getBalanceUpdates=(e,t,s)=>this.fetch(this.url("GetBalanceUpdates"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({page:e.page,balances:e.balances})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getTransactionHistory=(e,t,s)=>this.fetch(this.url("GetTransactionHistory"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({page:e.page,transactions:e.transactions})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.syncBalance=(e,t,s)=>this.fetch(this.url("SyncBalance"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.fetchTransactionReceipt=(e,t,s)=>this.fetch(this.url("FetchTransactionReceipt"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({receipt:e.receipt})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getOrderbookOrders=(e,t,s)=>this.fetch(this.url("GetOrderbookOrders"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({page:e.page,orders:e.orders})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getTopOrders=(e,t,s)=>this.fetch(this.url("GetTopOrders"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({orders:e.orders})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.fetchTransactionReceiptWithFilter=(e,t,s)=>this.fetch(this.url("FetchTransactionReceiptWithFilter"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({receipt:e.receipt})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getAllWebhookListeners=(e,t,s)=>this.fetch(this.url("GetAllWebhookListeners"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({listeners:e.listeners})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.getWebhookListener=(e,t,s)=>this.fetch(this.url("GetWebhookListener"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({listener:e.listener})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.addWebhookListener=(e,t,s)=>this.fetch(this.url("AddWebhookListener"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({status:e.status,listener:e.listener})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.updateWebhookListener=(e,t,s)=>this.fetch(this.url("UpdateWebhookListener"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({status:e.status})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.removeWebhookListener=(e,t,s)=>this.fetch(this.url("RemoveWebhookListener"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({status:e.status})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.toggleWebhookListener=(e,t,s)=>this.fetch(this.url("ToggleWebhookListener"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({webhookListener:e.webhookListener})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.pauseAllWebhookListeners=(e,t,s)=>this.fetch(this.url("PauseAllWebhookListeners"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({status:e.status})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.resumeAllWebhookListeners=(e,t,s)=>this.fetch(this.url("ResumeAllWebhookListeners"),Pi(e,t,s)).then((e=>Ni(e).then((e=>({status:e.status})))),(e=>{throw Li.new({cause:`fetch(): ${e.message||""}`})})),this.subscribeReceipts=(e,t)=>{const s=()=>this.fetch(this.url("SubscribeReceipts"),Pi(e,t.headers,t.signal)).then((async function(e){await xi(e,t,s)}),(e=>{t.onError(e,s)}));return s()},this.subscribeEvents=(e,t)=>{const s=()=>this.fetch(this.url("SubscribeEvents"),Pi(e,t.headers,t.signal)).then((async function(e){await xi(e,t,s)}),(e=>{t.onError(e,s)}));return s()},this.subscribeBalanceUpdates=(e,t)=>{const s=()=>this.fetch(this.url("SubscribeBalanceUpdates"),Pi(e,t.headers,t.signal)).then((async function(e){await xi(e,t,s)}),(e=>{t.onError(e,s)}));return s()},this.hostname=e.replace(/\/*$/,""),this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const xi=async(e,t,s)=>{const{onMessage:n,onOpen:r,onClose:i,onError:o}=t;if(!e.ok){try{await Ni(e)}catch(e){o(e,s)}return}if(!e.body)return void o(Wi.new({status:e.status,cause:"Invalid response, missing body"}),s);r&&r();const a=e.body.getReader(),c=new TextDecoder;let h="",l=Date.now();let d=!1;const u=setInterval((()=>{Date.now()-l>11e3&&(d=!0,clearInterval(u),a.releaseLock())}),11e3);for(;;){let t,r;try{if(({value:t,done:r}=await a.read()),d)throw new Error("Timeout, no data or heartbeat received");l=Date.now(),h+=c.decode(t,{stream:!0})}catch(e){let t="";return e instanceof Error&&(t=e.message),void(e instanceof DOMException&&"AbortError"===e.name?o(Li.new({message:"AbortError",cause:`AbortError: ${t}`}),(()=>{throw new Error("Abort signal cannot be used to reconnect")})):o(qi.new({cause:`reader.read(): ${t}`}),s))}let u=h.split("\n");for(let t=0;t<u.length-1;t++){if(0==u[t].length)continue;let r;try{if(r=JSON.parse(u[t]),r.hasOwnProperty("webrpcError")){const e=r.webrpcError,t="number"==typeof e.code?e.code:0;return void o((oo[t]||Ri).new(e),s)}}catch(t){if(t instanceof Error&&"Abort signal cannot be used to reconnect"===t.message)throw t;o(Wi.new({status:e.status,cause:`JSON.parse(): ${t.message}`}),s)}n(r)}if(r)return void(i&&i());h=u[u.length-1]}},Pi=(e={},t={},s=null)=>({method:"POST",headers:o({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{}),signal:s}),Ni=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){let n="";throw s instanceof Error&&(n=s.message),Wi.new({status:e.status,cause:`JSON.parse(): ${n}: response text: ${t}`})}if(!e.ok){const e="number"==typeof s.code?s.code:0;throw(oo[e]||Ri).new(s)}return s}));class Ri extends Error{constructor(e,t,s,n,r){super(s),this.name=void 0,this.code=void 0,this.message=void 0,this.status=void 0,this.cause=void 0,this.msg=void 0,this.name=e||"WebrpcError",this.code="number"==typeof t?t:0,this.message=s||`endpoint error ${this.code}`,this.msg=this.message,this.status="number"==typeof n?n:0,this.cause=r,Object.setPrototypeOf(this,Ri.prototype)}static new(e){return new this(e.error,e.code,e.message||e.msg,e.status,e.cause)}}class Mi extends Ri{constructor(e="WebrpcEndpoint",t=0,s="endpoint error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Mi.prototype)}}class Li extends Ri{constructor(e="WebrpcRequestFailed",t=-1,s="request failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Li.prototype)}}class Bi extends Ri{constructor(e="WebrpcBadRoute",t=-2,s="bad route",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Bi.prototype)}}class $i extends Ri{constructor(e="WebrpcBadMethod",t=-3,s="bad method",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,$i.prototype)}}class Di extends Ri{constructor(e="WebrpcBadRequest",t=-4,s="bad request",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Di.prototype)}}class Wi extends Ri{constructor(e="WebrpcBadResponse",t=-5,s="bad response",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Wi.prototype)}}class ji extends Ri{constructor(e="WebrpcServerPanic",t=-6,s="server panic",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,ji.prototype)}}class Ui extends Ri{constructor(e="WebrpcInternalError",t=-7,s="internal error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ui.prototype)}}class Hi extends Ri{constructor(e="WebrpcClientDisconnected",t=-8,s="client disconnected",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Hi.prototype)}}class qi extends Ri{constructor(e="WebrpcStreamLost",t=-9,s="stream lost",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,qi.prototype)}}class Fi extends Ri{constructor(e="WebrpcStreamFinished",t=-10,s="stream finished",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Fi.prototype)}}class Gi extends Ri{constructor(e="Unauthorized",t=1e3,s="Unauthorized access",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Gi.prototype)}}class Vi extends Ri{constructor(e="PermissionDenied",t=1001,s="Permission denied",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Vi.prototype)}}class Ki extends Ri{constructor(e="SessionExpired",t=1002,s="Session expired",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ki.prototype)}}class zi extends Ri{constructor(e="MethodNotFound",t=1003,s="Method not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,zi.prototype)}}class Ji extends Ri{constructor(e="RequestConflict",t=1004,s="Conflict with target resource",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ji.prototype)}}class Yi extends Ri{constructor(e="Aborted",t=1005,s="Request aborted",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Yi.prototype)}}class Qi extends Ri{constructor(e="Timeout",t=2e3,s="Request timed out",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Qi.prototype)}}class Xi extends Ri{constructor(e="InvalidArgument",t=2001,s="Invalid argument",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Xi.prototype)}}class Zi extends Ri{constructor(e="Unavailable",t=2002,s="Unavailable resource",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Zi.prototype)}}class eo extends Ri{constructor(e="QueryFailed",t=2003,s="Query failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,eo.prototype)}}class to extends Ri{constructor(e="ResourceExhausted",t=2004,s="Resource exhausted",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,to.prototype)}}class so extends Ri{constructor(e="NotFound",t=3e3,s="Resource not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,so.prototype)}}class no extends Ri{constructor(e="ProjectNotFound",t=3002,s="Project not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,no.prototype)}}class ro extends Ri{constructor(e="MetadataCallFailed",t=3003,s="Metadata service call failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,ro.prototype)}}let io=function(e){return e.WebrpcEndpoint="WebrpcEndpoint",e.WebrpcRequestFailed="WebrpcRequestFailed",e.WebrpcBadRoute="WebrpcBadRoute",e.WebrpcBadMethod="WebrpcBadMethod",e.WebrpcBadRequest="WebrpcBadRequest",e.WebrpcBadResponse="WebrpcBadResponse",e.WebrpcServerPanic="WebrpcServerPanic",e.WebrpcInternalError="WebrpcInternalError",e.WebrpcClientDisconnected="WebrpcClientDisconnected",e.WebrpcStreamLost="WebrpcStreamLost",e.WebrpcStreamFinished="WebrpcStreamFinished",e.Unauthorized="Unauthorized",e.PermissionDenied="PermissionDenied",e.SessionExpired="SessionExpired",e.MethodNotFound="MethodNotFound",e.RequestConflict="RequestConflict",e.Aborted="Aborted",e.Timeout="Timeout",e.InvalidArgument="InvalidArgument",e.Unavailable="Unavailable",e.QueryFailed="QueryFailed",e.ResourceExhausted="ResourceExhausted",e.NotFound="NotFound",e.ProjectNotFound="ProjectNotFound",e.MetadataCallFailed="MetadataCallFailed",e}({});const oo={0:Mi,[-1]:Li,[-2]:Bi,[-3]:$i,[-4]:Di,[-5]:Wi,[-6]:ji,[-7]:Ui,[-8]:Hi,[-9]:qi,[-10]:Fi,1e3:Gi,1001:Vi,1002:Ki,1003:zi,1004:Ji,1005:Yi,2e3:Qi,2001:Xi,2002:Zi,2003:eo,2004:to,3e3:so,3002:no,3003:ro},ao=globalThis.fetch;class co extends Ai{constructor(e,t,s){super(e.endsWith("/")?e.slice(0,-1):e,ao),this.projectAccessKey=t,this.jwtAuth=s,this._fetch=(e,t)=>{const s={},n=this.jwtAuth,r=this.projectAccessKey;return n&&n.length>0&&(s.Authorization=`BEARER ${n}`),r&&r.length>0&&(s["X-Access-Key"]=r),t.headers=o({},t.headers,s),ao(e,t)},this.fetch=this._fetch}}let ho=function(e){return e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155",e}({}),lo=function(e){return e.INT="INT",e.STRING="STRING",e.ARRAY="ARRAY",e.GENERIC="GENERIC",e}({}),uo=function(e){return e.UNKNOWN="UNKNOWN",e.BUY="BUY",e.SELL="SELL",e}({}),fo=function(e){return e.PENDING="PENDING",e.PAUSED="PAUSED",e.FAILED="FAILED",e.COMPLETED="COMPLETED",e.DISABLED="DISABLED",e}({});class po{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Metadata/",this.ping=(e,t)=>this.fetch(this.url("Ping"),mo({},e,t)).then((e=>wo(e).then((e=>({status:e.status})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.version=(e,t)=>this.fetch(this.url("Version"),mo({},e,t)).then((e=>wo(e).then((e=>({version:e.version})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.runtimeStatus=(e,t)=>this.fetch(this.url("RuntimeStatus"),mo({},e,t)).then((e=>wo(e).then((e=>({status:e.status})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getTokenMetadata=(e,t,s)=>this.fetch(this.url("GetTokenMetadata"),mo(e,t,s)).then((e=>wo(e).then((e=>({tokenMetadata:e.tokenMetadata})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.refreshTokenMetadata=(e,t,s)=>this.fetch(this.url("RefreshTokenMetadata"),mo(e,t,s)).then((e=>wo(e).then((e=>({taskId:e.taskId})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.enqueueTokensForRefresh=(e,t,s)=>this.fetch(this.url("EnqueueTokensForRefresh"),mo(e,t,s)).then((e=>wo(e).then((e=>({taskId:e.taskId})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getTokenRefreshStatus=(e,t,s)=>this.fetch(this.url("GetTokenRefreshStatus"),mo(e,t,s)).then((e=>wo(e).then((e=>({status:e.status})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getTokenRefreshResult=(e,t,s)=>this.fetch(this.url("GetTokenRefreshResult"),mo(e,t,s)).then((e=>wo(e).then((e=>({status:e.status,tokens:e.tokens,failureReasons:e.failureReasons})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.cancelRefreshJob=(e,t,s)=>this.fetch(this.url("CancelRefreshJob"),mo(e,t,s)).then((e=>wo(e).then((e=>({ok:e.ok})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getTokenMetadataBatch=(e,t,s)=>this.fetch(this.url("GetTokenMetadataBatch"),mo(e,t,s)).then((e=>wo(e).then((e=>({contractTokenMetadata:e.contractTokenMetadata})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.searchTokenMetadata=(e,t,s)=>this.fetch(this.url("SearchTokenMetadata"),mo(e,t,s)).then((e=>wo(e).then((e=>({page:e.page,tokenMetadata:e.tokenMetadata})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.searchTokenIDs=(e,t,s)=>this.fetch(this.url("SearchTokenIDs"),mo(e,t,s)).then((e=>wo(e).then((e=>({page:e.page,tokenIds:e.tokenIds})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.tokenCollectionFilters=(e,t,s)=>this.fetch(this.url("TokenCollectionFilters"),mo(e,t,s)).then((e=>wo(e).then((e=>({filters:e.filters})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getContractInfo=(e,t,s)=>this.fetch(this.url("GetContractInfo"),mo(e,t,s)).then((e=>wo(e).then((e=>({contractInfo:e.contractInfo})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getContractInfoBatch=(e,t,s)=>this.fetch(this.url("GetContractInfoBatch"),mo(e,t,s)).then((e=>wo(e).then((e=>({contractInfoMap:e.contractInfoMap})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.searchContractInfo=(e,t,s)=>this.fetch(this.url("SearchContractInfo"),mo(e,t,s)).then((e=>wo(e).then((e=>({contractInfoList:e.contractInfoList})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.searchContractInfoBatch=(e,t,s)=>this.fetch(this.url("SearchContractInfoBatch"),mo(e,t,s)).then((e=>wo(e).then((e=>({contractInfoByChain:e.contractInfoByChain})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.searchMetadata=(e,t,s)=>this.fetch(this.url("SearchMetadata"),mo(e,t,s)).then((e=>wo(e).then((e=>({tokenMetadata:e.tokenMetadata,contractInfo:e.contractInfo})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.searchTokens=(e,t,s)=>this.fetch(this.url("SearchTokens"),mo(e,t,s)).then((e=>wo(e).then((e=>({tokenMetadata:e.tokenMetadata,nextPage:e.nextPage})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.searchContracts=(e,t,s)=>this.fetch(this.url("SearchContracts"),mo(e,t,s)).then((e=>wo(e).then((e=>({contractInfo:e.contractInfo,nextPage:e.nextPage})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getNiftyswapTokenQuantity=(e,t,s)=>this.fetch(this.url("GetNiftyswapTokenQuantity"),mo(e,t,s)).then((e=>wo(e).then((e=>({quantity:e.quantity})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getNiftyswapUnitPrices=(e,t,s)=>this.fetch(this.url("GetNiftyswapUnitPrices"),mo(e,t,s)).then((e=>wo(e).then((e=>({prices:e.prices})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getNiftyswapUnitPricesWithQuantities=(e,t,s)=>this.fetch(this.url("GetNiftyswapUnitPricesWithQuantities"),mo(e,t,s)).then((e=>wo(e).then((e=>({prices:e.prices})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.addContractToMintMonitor=(e,t,s)=>this.fetch(this.url("AddContractToMintMonitor"),mo(e,t,s)).then((e=>wo(e).then((e=>({ok:e.ok})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.removeContractFromMintMonitor=(e,t,s)=>this.fetch(this.url("RemoveContractFromMintMonitor"),mo(e,t,s)).then((e=>wo(e).then((e=>({ok:e.ok})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.mintMonitorJobStatus=(e,t,s)=>this.fetch(this.url("MintMonitorJobStatus"),mo(e,t,s)).then((e=>wo(e).then((e=>({task:e.task})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.mintMonitorTriggerJob=(e,t,s)=>this.fetch(this.url("MintMonitorTriggerJob"),mo(e,t,s)).then((e=>wo(e).then((e=>({ok:e.ok})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.syncContractTokens=(e,t,s)=>this.fetch(this.url("SyncContractTokens"),mo(e,t,s)).then((e=>wo(e).then((e=>({taskID:e.taskID})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.abortContractSync=(e,t,s)=>this.fetch(this.url("AbortContractSync"),mo(e,t,s)).then((e=>wo(e).then((e=>({ok:e.ok})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.contractSyncJobStatus=(e,t,s)=>this.fetch(this.url("ContractSyncJobStatus"),mo(e,t,s)).then((e=>wo(e).then((e=>({refreshTask:e.refreshTask,syncTask:e.syncTask})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.directoryGetNetworks=(e,t,s)=>this.fetch(this.url("DirectoryGetNetworks"),mo(e,t,s)).then((e=>wo(e).then((e=>({networks:e.networks})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.directoryGetCollections=(e,t,s)=>this.fetch(this.url("DirectoryGetCollections"),mo(e,t,s)).then((e=>wo(e).then((e=>({collections:e.collections,page:e.page})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.directorySearchCollections=(e,t,s)=>this.fetch(this.url("DirectorySearchCollections"),mo(e,t,s)).then((e=>wo(e).then((e=>({collections:e.collections,page:e.page})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}class go{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Collections/",this.createCollection=(e,t,s)=>this.fetch(this.url("CreateCollection"),mo(e,t,s)).then((e=>wo(e).then((e=>({collection:e.collection})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getCollection=(e,t,s)=>this.fetch(this.url("GetCollection"),mo(e,t,s)).then((e=>wo(e).then((e=>({collection:e.collection})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.listCollections=(e,t,s)=>this.fetch(this.url("ListCollections"),mo(e,t,s)).then((e=>wo(e).then((e=>({page:e.page,collections:e.collections})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.updateCollection=(e,t,s)=>this.fetch(this.url("UpdateCollection"),mo(e,t,s)).then((e=>wo(e).then((e=>({collection:e.collection})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.deleteCollection=(e,t,s)=>this.fetch(this.url("DeleteCollection"),mo(e,t,s)).then((e=>wo(e).then((e=>({status:e.status})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.publishCollection=(e,t,s)=>this.fetch(this.url("PublishCollection"),mo(e,t,s)).then((e=>wo(e).then((e=>({collection:e.collection})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.unpublishCollection=(e,t,s)=>this.fetch(this.url("UnpublishCollection"),mo(e,t,s)).then((e=>wo(e).then((e=>({collection:e.collection})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.createContractCollection=(e,t,s)=>this.fetch(this.url("CreateContractCollection"),mo(e,t,s)).then((e=>wo(e).then((e=>({contractCollection:e.contractCollection})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getContractCollection=(e,t,s)=>this.fetch(this.url("GetContractCollection"),mo(e,t,s)).then((e=>wo(e).then((e=>({contractCollection:e.contractCollection})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.listContractCollections=(e,t,s)=>this.fetch(this.url("ListContractCollections"),mo(e,t,s)).then((e=>wo(e).then((e=>({contractCollections:e.contractCollections,collections:e.collections,page:e.page})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.updateContractCollection=(e,t,s)=>this.fetch(this.url("UpdateContractCollection"),mo(e,t,s)).then((e=>wo(e).then((e=>({ok:e.ok})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.deleteContractCollection=(e,t,s)=>this.fetch(this.url("DeleteContractCollection"),mo(e,t,s)).then((e=>wo(e).then((e=>({ok:e.ok})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.createToken=(e,t,s)=>this.fetch(this.url("CreateToken"),mo(e,t,s)).then((e=>wo(e).then((e=>({token:e.token,assets:e.assets})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getToken=(e,t,s)=>this.fetch(this.url("GetToken"),mo(e,t,s)).then((e=>wo(e).then((e=>({token:e.token,assets:e.assets})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.listTokens=(e,t,s)=>this.fetch(this.url("ListTokens"),mo(e,t,s)).then((e=>wo(e).then((e=>({page:e.page,tokens:e.tokens})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.updateToken=(e,t,s)=>this.fetch(this.url("UpdateToken"),mo(e,t,s)).then((e=>wo(e).then((e=>({token:e.token})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.deleteToken=(e,t,s)=>this.fetch(this.url("DeleteToken"),mo(e,t,s)).then((e=>wo(e).then((e=>({status:e.status})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.createAsset=(e,t,s)=>this.fetch(this.url("CreateAsset"),mo(e,t,s)).then((e=>wo(e).then((e=>({asset:e.asset})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getAsset=(e,t,s)=>this.fetch(this.url("GetAsset"),mo(e,t,s)).then((e=>wo(e).then((e=>({asset:e.asset})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.updateAsset=(e,t,s)=>this.fetch(this.url("UpdateAsset"),mo(e,t,s)).then((e=>wo(e).then((e=>({asset:e.asset})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.deleteAsset=(e,t,s)=>this.fetch(this.url("DeleteAsset"),mo(e,t,s)).then((e=>wo(e).then((e=>({status:e.status})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const mo=(e={},t={},s=null)=>({method:"POST",headers:o({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{}),signal:s}),wo=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){let n="";throw s instanceof Error&&(n=s.message),So.new({status:e.status,cause:`JSON.parse(): ${n}: response text: ${t}`})}if(!e.ok){const e="number"==typeof s.code?s.code:0;throw(zo[e]||yo).new(s)}return s}));class yo extends Error{constructor(e,t,s,n,r){super(s),this.name=void 0,this.code=void 0,this.message=void 0,this.status=void 0,this.cause=void 0,this.msg=void 0,this.name=e||"WebrpcError",this.code="number"==typeof t?t:0,this.message=s||`endpoint error ${this.code}`,this.msg=this.message,this.status="number"==typeof n?n:0,this.cause=r,Object.setPrototypeOf(this,yo.prototype)}static new(e){return new this(e.error,e.code,e.message||e.msg,e.status,e.cause)}}class bo extends yo{constructor(e="WebrpcEndpoint",t=0,s="endpoint error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,bo.prototype)}}class vo extends yo{constructor(e="WebrpcRequestFailed",t=-1,s="request failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,vo.prototype)}}class Eo extends yo{constructor(e="WebrpcBadRoute",t=-2,s="bad route",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Eo.prototype)}}class Io extends yo{constructor(e="WebrpcBadMethod",t=-3,s="bad method",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Io.prototype)}}class To extends yo{constructor(e="WebrpcBadRequest",t=-4,s="bad request",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,To.prototype)}}class So extends yo{constructor(e="WebrpcBadResponse",t=-5,s="bad response",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,So.prototype)}}class Oo extends yo{constructor(e="WebrpcServerPanic",t=-6,s="server panic",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Oo.prototype)}}class ko extends yo{constructor(e="WebrpcInternalError",t=-7,s="internal error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,ko.prototype)}}class Co extends yo{constructor(e="WebrpcClientDisconnected",t=-8,s="client disconnected",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Co.prototype)}}class _o extends yo{constructor(e="WebrpcStreamLost",t=-9,s="stream lost",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,_o.prototype)}}class Ao extends yo{constructor(e="WebrpcStreamFinished",t=-10,s="stream finished",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ao.prototype)}}class xo extends yo{constructor(e="Unauthorized",t=1e3,s="Unauthorized access",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,xo.prototype)}}class Po extends yo{constructor(e="PermissionDenied",t=1001,s="Permission denied",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Po.prototype)}}class No extends yo{constructor(e="SessionExpired",t=1002,s="Session expired",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,No.prototype)}}class Ro extends yo{constructor(e="MethodNotFound",t=1003,s="Method not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ro.prototype)}}class Mo extends yo{constructor(e="RequestConflict",t=1004,s="Conflict with target resource",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Mo.prototype)}}class Lo extends yo{constructor(e="Fail",t=1005,s="Request Failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Lo.prototype)}}class Bo extends yo{constructor(e="Geoblocked",t=1006,s="Geoblocked region",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Bo.prototype)}}class $o extends yo{constructor(e="Timeout",t=2e3,s="Request timed out",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,$o.prototype)}}class Do extends yo{constructor(e="InvalidArgument",t=2001,s="Invalid argument",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Do.prototype)}}class Wo extends yo{constructor(e="RequiredArgument",t=2002,s="Required argument missing",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Wo.prototype)}}class jo extends yo{constructor(e="QueryFailed",t=2003,s="Query failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,jo.prototype)}}class Uo extends yo{constructor(e="ValidationFailed",t=2004,s="Validation failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Uo.prototype)}}class Ho extends yo{constructor(e="RateLimited",t=2005,s="Rate limited",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ho.prototype)}}class qo extends yo{constructor(e="NotFound",t=3e3,s="Resource not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,qo.prototype)}}class Fo extends yo{constructor(e="ProjectNotFound",t=3002,s="Project not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Fo.prototype)}}class Go extends yo{constructor(e="ChainNotFound",t=3003,s="Chain not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Go.prototype)}}class Vo extends yo{constructor(e="TokenDirectoryDisabled",t=4001,s="Token Directory is disabled",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Vo.prototype)}}let Ko=function(e){return e.WebrpcEndpoint="WebrpcEndpoint",e.WebrpcRequestFailed="WebrpcRequestFailed",e.WebrpcBadRoute="WebrpcBadRoute",e.WebrpcBadMethod="WebrpcBadMethod",e.WebrpcBadRequest="WebrpcBadRequest",e.WebrpcBadResponse="WebrpcBadResponse",e.WebrpcServerPanic="WebrpcServerPanic",e.WebrpcInternalError="WebrpcInternalError",e.WebrpcClientDisconnected="WebrpcClientDisconnected",e.WebrpcStreamLost="WebrpcStreamLost",e.WebrpcStreamFinished="WebrpcStreamFinished",e.Unauthorized="Unauthorized",e.PermissionDenied="PermissionDenied",e.SessionExpired="SessionExpired",e.MethodNotFound="MethodNotFound",e.RequestConflict="RequestConflict",e.Fail="Fail",e.Geoblocked="Geoblocked",e.Timeout="Timeout",e.InvalidArgument="InvalidArgument",e.RequiredArgument="RequiredArgument",e.QueryFailed="QueryFailed",e.ValidationFailed="ValidationFailed",e.RateLimited="RateLimited",e.NotFound="NotFound",e.ProjectNotFound="ProjectNotFound",e.ChainNotFound="ChainNotFound",e.TokenDirectoryDisabled="TokenDirectoryDisabled",e}({});const zo={0:bo,[-1]:vo,[-2]:Eo,[-3]:Io,[-4]:To,[-5]:So,[-6]:Oo,[-7]:ko,[-8]:Co,[-9]:_o,[-10]:Ao,1e3:xo,1001:Po,1002:No,1003:Ro,1004:Mo,1005:Lo,1006:Bo,2e3:$o,2001:Do,2002:Wo,2003:jo,2004:Uo,2005:Ho,3e3:qo,3002:Fo,3003:Go,4001:Vo},Jo=globalThis.fetch;class Yo extends po{constructor(e="https://metadata.sequence.app",t,s){super(e.endsWith("/")?e.slice(0,-1):e,Jo),this.projectAccessKey=t,this.jwtAuth=s,this._fetch=(e,t)=>{const s={},n=this.jwtAuth,r=this.projectAccessKey;return n&&n.length>0&&(s.Authorization=`BEARER ${n}`),r&&r.length>0&&(s["X-Access-Key"]=r),t.headers=o({},t.headers,s),Jo(e,t)},this.fetch=this._fetch}}const Qo=604800;class Xo{constructor(e,t,s={},n){this.account=e,this.settings=t,this.status=s,this._initialAuthRequest=void 0,this.proofStrings=new Map,this.onAuthCallbacks=[],this.apiClient=void 0,this.metadataClient=void 0,this.indexerClients=new Map,this.projectAccessKey=void 0,this.projectAccessKey=n}now(){return Math.floor(Date.now()/1e3)}get expiration(){var e;return Math.max(null!=(e=this.settings.metadata.expiration)?e:Qo,120)}onAuth(e){return this.onAuthCallbacks.push(e),()=>this.onAuthCallbacks=this.onAuthCallbacks.filter((t=>t!==e))}async dump(){return this.status.jwt?{jwt:{token:await this.status.jwt.token,expiration:this.status.jwt.expiration},metadata:this.status.metadata}:{metadata:this.settings.metadata}}auth(e=5){var t=this;return this._initialAuthRequest||(this._initialAuthRequest=async function(){const s=t.settings.sequenceApiUrl;if(!s)throw Error("No sequence api url");let n;for(let s=1;;s++)try{n=(await t.getJWT(!0)).token;break}catch(t){if(s===e)throw console.error(`couldn't authenticate after ${e} attempts`,t),t}return new D(s,void 0,n)}()),this._initialAuthRequest}async getJWT(e){var t=this;const s=this.settings.sequenceApiUrl;if(!s)throw Error("No sequence api url");if(this.status.jwt){const e=this.status.jwt,t=await e.token;if(this.now()<e.expiration)return{token:t,expiration:e.expiration};this.status.jwt=void 0}if(!e)throw new Error("no auth token in memory");const n=this.getProofStringKey(),{proofString:r,expiration:i}=this.getProofString(n),o={token:r.then((async function(e){const r=new D(s),i=await r.getAuthToken({ewtString:e});if(!0===(null==i?void 0:i.status)&&0!==i.jwtToken.length)return i.jwtToken;throw await t.isProofStringValid(e)||t.proofStrings.delete(n),new Error("no auth token from server")})).catch((e=>{throw this.status.jwt=void 0,e})),expiration:i};this.status.jwt=o,o.token.then((e=>{this.onAuthCallbacks.forEach((t=>{try{t({status:"fulfilled",value:e})}catch(e){}}))})).catch((e=>{this.onAuthCallbacks.forEach((t=>{try{t({status:"rejected",reason:e})}catch(e){}}))}));return{token:await o.token,expiration:i}}getProofStringKey(){return`${this.account.address} - ${this.settings.metadata.name}`}async isProofStringValid(e){try{const s=new Oe,n=BigInt(this.settings.sequenceApiChainId),r=Re(this.account.networks,n);if(!r)throw Error("No network found");s.chainId=Number(n);const i=new t.ethers.Network(r.name,n);return s.provider=new t.ethers.JsonRpcProvider(tt(r.rpcUrl,this.projectAccessKey),i,{staticNetwork:i}),await s.decodeProof(e),!0}catch(e){return!1}}async getAPIClient(e=!0){if(!this.apiClient){const t=this.settings.sequenceApiUrl;if(!t)throw Error("No sequence api url");const s=(await this.getJWT(e)).token;this.apiClient=new D(t,void 0,s)}return this.apiClient}async getMetadataClient(e=!0){if(!this.metadataClient){const t=(await this.getJWT(e)).token;this.metadataClient=new Yo(this.settings.sequenceMetadataUrl,void 0,t)}return this.metadataClient}async getIndexerClient(e,t=!0){const s=Re(this.account.networks,e);if(!s)throw Error(`No network for chain ${e}`);if(!this.indexerClients.has(s.chainId))if(s.indexer)this.indexerClients.set(s.chainId,s.indexer);else{if(!s.indexerUrl)throw Error(`No indexer url for chain ${e}`);{const e=(await this.getJWT(t)).token;this.indexerClients.set(s.chainId,new co(s.indexerUrl,void 0,e))}}return this.indexerClients.get(s.chainId)}getProofString(e){if(this.proofStrings.has(e)){const t=this.proofStrings.get(e);if(this.now()<t.expiration)return t;this.proofStrings.delete(e)}const s=new ve({address:this.account.address});s.claims.app=this.settings.metadata.name,s.claims.ogn=window.location.origin,s.setExpiryIn(this.expiration);const n=new Oe,r=BigInt(this.settings.sequenceApiChainId),i=Re(this.account.networks,r);if(!i)throw Error("No network found");n.chainId=Number(r);const o=new t.ethers.Network(i.name,r);n.provider=new t.ethers.JsonRpcProvider(tt(i.rpcUrl,this.projectAccessKey),o,{staticNetwork:o});const a=this.now()+this.expiration-60,c={proofString:Promise.resolve(this.account.signDigest(s.messageDigest(),this.settings.sequenceApiChainId,!0,"eip6492")).then((e=>(s.signature=e,n.encodeProof(s,!0)))).catch((t=>{throw this.proofStrings.delete(e),t})),expiration:a};return this.proofStrings.set(e,c),c}}const Zo=async(e,s,n)=>{const r=t.ethers.getAddress(await e.getAddress());if(!r||""===r||"0x"===r)throw ta;const i=new ve;if(i.address=r,!n||!n.app||""===n.app)throw new ea("authorization options requires app to be set");i.claims.app=n.app,i.claims.ogn=n.origin,i.claims.n=n.nonce,i.setExpiryIn(n.expiry?Math.max(n.expiry,200):Qo);const o=i.messageTypedData(),a=pt(s);i.signature=await(e instanceof bi?e.signTypedData(o.domain,o.types,o.message,a,"eip6492"):e.signTypedData(o.domain,o.types,o.message,a));const c=new Oe;return{typedData:o,proofString:await c.encodeProof(i,!0)}};class ea extends Error{constructor(e){super(e),this.name="AuthError"}}const ta=new ea("auth error: account address is empty");var sa=Object.freeze({__proto__:null});class na{constructor(e,t,s=1e3){this.provider=e,this.solver=t,this.window=s,this.pending=new Map}async runByEIP5719(e,t,s){const n=`${e}-${t}-${s}`,r=Date.now();if(this.pending.has(n)&&r-this.pending.get(n).timestamp<this.window)return this.pending.get(n).promise;const i=ra(e,this.provider,t,s,this.solver);return this.pending.set(n,{timestamp:r,promise:i}),i}}async function ra(e,s,n,r,i,o=0){if(o>10)throw new Error("EIP5719 - Too many tries");if(Ft(r)){const t=Gt(n,r);if(t&&t.toLowerCase()===e.toLowerCase())return r}try{if(await Vt(e,n,r,s))return r}catch(e){}const a=await async function(e){try{return await e}catch(e){return}}(function(e,s){return new t.ethers.Contract(e,[{inputs:[{internalType:"bytes32",type:"bytes32"}],name:"getAlternativeSignature",outputs:[{internalType:"string",type:"string"}],stateMutability:"view",type:"function"}],s)}(e,s).getAlternativeSignature(n));if(!a||""===a)throw new Error("EIP5719 - Invalid signature and no alternative signature");const c=t.ethers.hexlify(await(i||new ia).resolve(a));if(!c||""===c)throw new Error("EIP5719 - Empty alternative signature");if(c===t.ethers.hexlify(r))throw new Error("EIP5719 - Alternative signature is invalid or the same");return ra(e,s,n,c,i,o+1)}class ia{constructor(e="https://cloudflare-ipfs.com/ipfs/"){var t=this;this.gateway=e,this.uri=e=>function(e){return e.startsWith("ipfs://")}(e)?function(e,t){const s=e.replace("ipfs://ipfs/","").replace("ipfs://","");return e.startsWith("ipfs://")?`${t}${s}`:e}(e,this.gateway):e,this.resolve=async function(e){const s=t.uri(e),n=await fetch(s);if(!n.ok)throw new Error(`URISolverIPFS - Failed to fetch ${s}`);return await n.text()}}}const oa=["function execute((bool delegateCall, bool revertOnError, uint256 gasLimit, address target, uint256 value, bytes data)[] calldata transactions, uint256 nonce, bytes calldata signature)"],aa={namespace:"Sequence-Sessions",owners:["AZ6R2mG8zxW9q7--iZXGrBknjegHoPzmG5IG-nxvMaM"],arweaveUrl:"https://arweave.net",graphqlUrl:"https://arweave.net/graphql",eip5719Provider:void 0,rateLimitRetryDelayMs:3e5};async function ca(e,t){var s,n,r,i;const o=null!=(s=null==t?void 0:t.namespace)?s:aa.namespace,a=null==t?void 0:t.owners,c=null!=(n=null==t?void 0:t.graphqlUrl)?n:aa.graphqlUrl,h=null!=(r=null==t?void 0:t.rateLimitRetryDelayMs)?r:aa.rateLimitRetryDelayMs,l=null!=(i=null==t?void 0:t.pageSize)?i:100,d=null==t?void 0:t.maxResults,u=Object.entries(e).flatMap((([e,t])=>void 0===t?[]:[`{ name: "${o?`${o}-${e}`:e}", values: [${"string"==typeof t?`"${t}"`:t.map((e=>`"${e}"`)).join(", ")}] }`])),f=[];for(let e=!0;e&&(void 0===d||f.length<d);){const t=`\n      query {\n        transactions(sort: HEIGHT_DESC, ${f.length?`first: ${l}, after: "${f[f.length-1].cursor}"`:`first: ${l}`}, tags: [${u.join(", ")}]${void 0===a?"":`, owners: [${a.map((e=>`"${e}"`)).join(", ")}]`}) {\n          pageInfo {\n            hasNextPage\n          }\n          edges {\n            cursor\n            node {\n              id\n              tags {\n                name\n                value\n              }\n            }\n          }\n        }\n      }\n    `;let s;for(;s=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t}),redirect:"follow"}),429===s.status;)console.warn(`rate limited by ${c}, trying again in ${h/1e3} seconds at ${new Date(Date.now()+h).toLocaleTimeString()}`),await new Promise((e=>setTimeout(e,h)));const{data:{transactions:n}}=await s.json();f.push(...n.edges),e=n.pageInfo.hasNextPage}return Object.fromEntries(f.map((({node:{id:e,tags:t}})=>[e,Object.fromEntries(t.map((({name:e,value:t})=>[o&&e.startsWith(`${o}-`)?e.slice(o.length+1):e,t])))])))}async function ha(e,t=aa.rateLimitRetryDelayMs,s=aa.arweaveUrl){for(;;){const n=await fetch(`${s}/${e}`,{redirect:"follow"});if(429!==n.status)return n;console.warn(`rate limited by ${s}, trying again in ${t/1e3} seconds at ${new Date(Date.now()+t).toLocaleTimeString()}`),await new Promise((e=>setTimeout(e,t)))}}function la(e){return"string"==typeof e?{nodeHash:e}:"object"==typeof e&&void 0!==(null==e?void 0:e.node)?{nodeHash:e.node}:e instanceof Array&&2===e.length?{left:la(e[0]),right:la(e[1])}:Zs(e)?{left:la(e.left),right:la(e.right)}:Ys(e)?o({},e,{tree:la(e.tree)}):e}var da=Object.freeze({__proto__:null,defaults:aa,ArweaveReader:class{constructor(e=aa){this.options=e,this.configs=new Map,this.eip5719=void 0,e.eip5719Provider&&(this.eip5719=new na(e.eip5719Provider))}async loadPresignedConfiguration(e){var s=this;const n=t.ethers.getAddress(e.wallet),r=await this.configOfImageHash({imageHash:e.fromImageHash});if(!r)throw new Error(`unable to find from config ${e.fromImageHash}`);if(!rn(r))throw new Error(`from config ${e.fromImageHash} is not v2`);const i=BigInt(r.checkpoint),o=Object.entries(await ca({Type:"config update",Wallet:n},this.options)).flatMap((([e,s])=>{try{const{Signer:n,Subdigest:r,Digest:o,"To-Config":a}=s;let c,h,l;switch(s["Signature-Type"]){case"eip-712":case"eth_sign":case"erc-1271":c=s["Signature-Type"];break;default:throw new Error(`unknown signature type ${s["Signature-Type"]}`)}try{h=BigInt(s["To-Checkpoint"])}catch(e){throw new Error(`to checkpoint is not a number: ${s["To-Checkpoint"]}`)}if(h<=i)return[];if(!t.ethers.isAddress(n))throw new Error(`signer is not an address: ${n}`);if(!t.ethers.isHexString(r,32))throw new Error(`subdigest is not a hash: ${r}`);if(!t.ethers.isHexString(o,32))throw new Error(`digest is not a hash: ${o}`);try{l=BigInt(s["Chain-ID"])}catch(e){throw new Error(`chain id is not a number: ${s["Chain-ID"]}`)}if(!t.ethers.isHexString(a,32))throw new Error(`to config is not a hash: ${a}`);return[{id:e,signatureType:c,signer:n,subdigest:r,digest:o,chainId:l,toImageHash:a,toCheckpoint:h}]}catch(t){return console.warn(`invalid wallet ${n} config update ${e}:`,t),[]}})),a=new Map;let c=[];for(const e of o){let t=a.get(e.toImageHash);t||(t=new Map,a.set(e.toImageHash,t),c.push(e)),t.set(e.signer,e)}e.longestPath?c.sort((({toCheckpoint:e},{toCheckpoint:t})=>e===t?0:e<t?-1:1)):c.sort((({toCheckpoint:e},{toCheckpoint:t})=>e===t?0:e<t?1:-1));const h=[];for(let e=r;c.length;){const r=on(e);let i,o,l=[];for(const t of c){o=a.get(t.toImageHash),l=Array.from(o.keys());const{weight:s}=Ss(e,new Map(l.map((e=>[e,{signature:"0x",isDynamic:!1}]))),[],0);if(s>=BigInt(e.threshold)){i=t;break}}if(!i){console.warn(`unreachable configs with checkpoint > ${e.checkpoint} from config ${r}`);break}const d=i.toImageHash;try{const r=await this.configOfImageHash({imageHash:d});if(!r)throw new Error(`unable to find config ${d}`);if(!rn(r))throw new Error(`config ${d} is not v2`);const i=new Map((await Promise.all(l.map((async function(e){const{id:n,subdigest:r,signatureType:i}=o.get(e);try{let o=await(await ha(n,s.options.rateLimitRetryDelayMs,s.options.arweaveUrl)).text();switch(i){case"eip-712":o+="01";break;case"eth_sign":o+="02";break;case"erc-1271":o+="03"}if(s.eip5719)try{o=t.ethers.hexlify(await s.eip5719.runByEIP5719(e,r,o))}catch(e){console.warn(`unable to run eip-5719 on config update ${n}`)}return[[e,{signature:o,isDynamic:Kt(r,o)!==e}]]}catch(t){return console.warn(`unable to fetch signer ${e} config update ${n}:`,t),[]}})))).flat()),{encoded:a,weight:u}=Ss(e,i,[],0);if(u<BigInt(e.threshold))throw new Error(`insufficient signing power ${u.toString()} < ${e.threshold}`);h.push({wallet:n,signature:a,nextImageHash:d}),e=r,c=c.filter((({toCheckpoint:t})=>t>BigInt(e.checkpoint)))}catch(e){console.warn(`unable to reconstruct wallet ${n} update from config ${r} to config ${d}:`,e),c=c.filter((({toImageHash:e})=>e!==d))}}return h}savePresignedConfiguration(e){throw new Error("arweave backend does not support saving config updates")}saveWitnesses(e){throw new Error("arweave backend does not support saving signatures")}async configOfImageHash(e){var t=this;if(!e.noCache){const t=this.configs.get(e.imageHash);if(t)try{return await t}catch(t){const s=this.configs.get(e.imageHash);if(s)return s}}const s=async function(e){const s=Object.entries(await ca({Type:"config",Config:e},t.options)).flatMap((([t,s])=>{try{const e=Number(s.Version);if(!e)throw new Error(`invalid version: ${s.Version}`);return[{id:t,version:e}]}catch(s){return console.warn(`config ${e} at ${t} invalid:`,s),[]}}));switch(s.length){case 0:return void t.configs.set(e,Promise.resolve(void 0));case 1:break;default:console.warn(`multiple configs ${e} at ${s.map((({id:e})=>e)).join(", ")}`)}for(const{id:n,version:r}of s)try{const s=o({},await(await ha(n,t.options.rateLimitRetryDelayMs,t.options.arweaveUrl)).json(),{version:r});s.tree&&(s.tree=la(s.tree));const i=or(r).config.imageHashOf(s);if(i!==e)throw new Error(`image hash is ${i}, expected ${e}`);return t.configs.set(e,Promise.resolve(s)),s}catch(e){console.warn(`config at ${n} invalid:`,e)}t.configs.set(e,Promise.resolve(void 0))}(e.imageHash);return e.noCache||this.configs.set(e.imageHash,s),s}saveWalletConfig(e){throw new Error("arweave backend does not support saving configs")}async imageHashOfCounterfactualWallet(e){const s=t.ethers.getAddress(e.wallet),n=Object.entries(await ca({Type:"wallet",Wallet:s},this.options)).flatMap((([e,t])=>{try{const{"Deploy-Config":n}=t,r=Number(t["Deploy-Version"]);if(!r)throw new Error(`invalid version: ${t["Deploy-Version"]}`);if(!n)throw new Error("no deploy config");const i=On[r];if(!i)throw new Error(`unknown version: ${r}`);if(Sn(i,n)!==s)throw new Error(`incorrect v${r} deploy config: ${n}`);return[{id:e,imageHash:n,context:i}]}catch(t){return console.warn(`wallet ${s} at ${e} invalid:`,t),[]}}));switch(n.length){case 0:return;case 1:break;default:console.warn(`multiple deploy configs for wallet ${s} at ${n.map((({id:e})=>e)).join(", ")}, using first`)}return n[0]}saveCounterfactualWallet(e){throw new Error("arweave backend does not support saving wallets")}async walletsOfSigner(e){var s=this;const n=t.ethers.getAddress(e.signer),r=new Map;for(const[i,o]of Object.entries(await ca({Type:["signature","config update"],Signer:n,Witness:e.allSignatures?void 0:"true"},this.options))){const{Wallet:e,Subdigest:a,Digest:c,"Chain-ID":h}=o;try{if(r.has(e))continue;let l;switch(o["Signature-Type"]){case"eip-712":l="01";break;case"eth_sign":l="02";break;case"erc-1271":l="03";break;default:throw new Error(`unknown signature type ${o["Signature-Type"]}`)}if(a!==$t({digest:c,chainId:h,address:e}))throw new Error("incorrect subdigest");const d=ha(i,this.options.rateLimitRetryDelayMs,this.options.arweaveUrl).then((async function(e){const r=await e.text()+l;if(s.eip5719)try{return t.ethers.hexlify(await s.eip5719.runByEIP5719(n,a,r))}catch(e){console.warn(`unable to run eip-5719 on signature ${i}`)}return r}));r.set(e,{digest:c,chainId:BigInt(h),signature:d})}catch(t){console.warn(`signer ${n} signature ${i} of wallet ${e} invalid:`,t)}}return Promise.all([...r.entries()].map((async function([e,{digest:t,chainId:s,signature:n}]){return{wallet:e,proof:{digest:t,chainId:s,signature:await n}}})))}async getMigration(e,s,n,r){const i=t.ethers.getAddress(e),o=Object.entries(await ca({Type:"migration",Migration:i,"Chain-ID":BigInt(r).toString(),"From-Version":`${n}`,"From-Config":s},this.options)).flatMap((([e,o])=>{try{const{"To-Config":s,Executor:n}=o,r=Number(o["To-Version"]);if(!r)throw new Error(`invalid version: ${o["To-Version"]}`);if(!t.ethers.isHexString(s,32))throw new Error(`to config is not a hash: ${s}`);if(!t.ethers.isAddress(n))throw new Error(`executor is not an address: ${n}`);return{id:e,toVersion:r,toImageHash:s,executor:n}}catch(t){return console.warn(`chain ${r} migration ${e} for v${n} wallet ${i} from config ${s} invalid:`,t),[]}}));switch(o.length){case 0:return;case 1:break;default:console.warn(`multiple chain ${r} migrations for v${n} wallet ${i} from config ${s} at ${o.map((({id:e})=>e)).join(", ")}, using first`)}const{id:a,toVersion:c,toImageHash:h,executor:l}=o[0],[d,u]=await Promise.all([ha(a,this.options.rateLimitRetryDelayMs,this.options.arweaveUrl).then((e=>e.text())),this.configOfImageHash({imageHash:h})]);if(!u)throw new Error(`unable to find to config ${h} for migration`);const f=new t.ethers.Interface(oa),[p,g,m]=f.decodeFunctionData("execute",d),w=Wn(p),y=Nn(i,r,g,w);return{tx:{entrypoint:l,transactions:w,nonce:g,chainId:r,intent:{id:y,wallet:i},signature:m},fromVersion:n,toVersion:Number(c),toConfig:u}}saveMigration(e,t,s){throw new Error("arweave backend does not support saving migrations")}}});function ua(e,t=""){if(void 0===e)console.debug(t+"undefined");else JSON.stringify(e,Ue,2).split("\n").map((e=>t+e)).forEach((e=>console.debug(e)));return e}var fa=Object.freeze({__proto__:null,DebugConfigTracker:class{constructor(e){this.tracker=e}async loadPresignedConfiguration(e){return console.debug("? loadPresignedConfiguration"),ua(e,"? "),ua(await this.tracker.loadPresignedConfiguration(e),"! ")}savePresignedConfiguration(e){return console.debug("? savePresignedConfiguration"),ua(e,"? "),this.tracker.savePresignedConfiguration(e)}saveWitnesses(e){return console.debug("? saveWitnesses"),ua(e,"? "),this.tracker.saveWitnesses(e)}async configOfImageHash(e){return console.debug("? configOfImageHash"),ua(e,"? "),ua(await this.tracker.configOfImageHash(e),"! ")}saveWalletConfig(e){return console.debug("? saveWalletConfig"),ua(e,"? "),this.tracker.saveWalletConfig(e)}async imageHashOfCounterfactualWallet(e){return console.debug("? imageHashOfCounterfactualWallet"),ua(e,"? "),ua(await this.tracker.imageHashOfCounterfactualWallet(e),"! ")}saveCounterfactualWallet(e){return console.debug("? saveCounterfactualWallet"),ua(e,"? "),this.tracker.saveCounterfactualWallet(e)}async walletsOfSigner(e){return console.debug("? walletsOfSigner"),ua(e,"? "),ua(await this.tracker.walletsOfSigner(e),"! ")}async getMigration(e,t,s,n){return console.debug("? getMigration"),ua({address:e,fromImageHash:t,fromVersion:s,chainId:n},"? "),ua(await this.tracker.getMigration(e,t,s,n),"! ")}saveMigration(e,t,s){return console.debug("? saveMigration"),ua({address:e,signed:t,contexts:s},"? "),this.tracker.saveMigration(e,t,s)}}});class pa{constructor(){this.configs={},this.v2Nodes={},this.counterfactualWallets={},this.payloads={},this.signatures={},this.migrations={},this.loadConfig=e=>Promise.resolve(this.configs[e]),this.saveConfig=(e,t)=>(this.configs[e]=t,Promise.resolve()),this.loadV2Node=e=>Promise.resolve(this.v2Nodes[e]),this.saveV2Node=(e,t)=>(this.v2Nodes[e]=t,Promise.resolve()),this.loadCounterfactualWallet=e=>Promise.resolve(this.counterfactualWallets[e]),this.saveCounterfactualWallet=(e,t,s)=>(this.counterfactualWallets[e]={imageHash:t,context:s},Promise.resolve()),this.loadPayloadOfSubdigest=e=>Promise.resolve(this.payloads[e]),this.savePayloadOfSubdigest=(e,t)=>(this.payloads[e]=t,Promise.resolve()),this.loadSubdigestsOfSigner=e=>Promise.resolve(Object.keys(this.signatures[e]||{})),this.loadSignatureOfSubdigest=(e,t)=>{var s;return Promise.resolve(null==(s=this.signatures[e])?void 0:s[t])},this.saveSignatureOfSubdigest=(e,t,s)=>(this.signatures[e]||(this.signatures[e]={}),this.signatures[e][t]=s,Promise.resolve()),this.loadMigrationsSubdigest=(e,t,s)=>{var n;return Promise.resolve((null==(n=this.migrations[e])||null==(n=n[t])?void 0:n[s])||[])},this.saveMigrationsSubdigest=(e,t,s,n,r)=>(this.migrations[e]||(this.migrations[e]={}),this.migrations[e][t]||(this.migrations[e][t]={}),this.migrations[e][t][s]||(this.migrations[e][t][s]=[]),this.migrations[e][t][s].push({subdigest:n,toImageHash:r}),Promise.resolve())}}let ga,ma;const wa=new WeakMap,ya=new WeakMap,ba=new WeakMap,va=new WeakMap,Ea=new WeakMap;let Ia={get(e,t,s){if(e instanceof IDBTransaction){if("done"===t)return ya.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ba.get(e);if("store"===t)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return Oa(e[t])},set:(e,t,s)=>(e[t]=s,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Ta(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ma||(ma=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(ka(this),t),Oa(wa.get(this))}:function(...t){return Oa(e.apply(ka(this),t))}:function(t,...s){const n=e.call(ka(this),t,...s);return ba.set(n,t.sort?t.sort():[t]),Oa(n)}}function Sa(e){return"function"==typeof e?Ta(e):(e instanceof IDBTransaction&&function(e){if(ya.has(e))return;const t=new Promise(((t,s)=>{const n=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),n()},i=()=>{s(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));ya.set(e,t)}(e),t=e,(ga||(ga=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,Ia):e);var t}function Oa(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,s)=>{const n=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(Oa(e.result)),n()},i=()=>{s(e.error),n()};e.addEventListener("success",r),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&wa.set(t,e)})).catch((()=>{})),Ea.set(t,e),t}(e);if(va.has(e))return va.get(e);const t=Sa(e);return t!==e&&(va.set(e,t),Ea.set(t,e)),t}const ka=e=>Ea.get(e);const Ca=["get","getKey","getAll","getAllKeys","count"],_a=["put","add","delete","clear"],Aa=new Map;function xa(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Aa.get(t))return Aa.get(t);const s=t.replace(/FromIndex$/,""),n=t!==s,r=_a.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!r&&!Ca.includes(s))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let o=i.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[s](...t),r&&i.done]))[0]};return Aa.set(t,i),i}function Pa(e){if(void 0===e)return;const t={};for(const s of Object.keys(e)){const n=e[s];!0===n._isBigNumber&&void 0!==n._hex&&"string"==typeof n._hex&&""!==n._hex.length?t[s]=BigInt(n._hex):Array.isArray(n)?t[s]=n.map((e=>Pa(e))):t[s]="object"==typeof n&&null!==n?Pa(n):n}return t}Ia=(e=>({...e,get:(t,s,n)=>xa(t,s)||e.get(t,s,n),has:(t,s)=>!!xa(t,s)||e.has(t,s)}))(Ia);function Na(e){return void 0!==e.left&&void 0!==e.right}function Ra(e){return void 0!==e.weight&&void 0!==e.threshold&&void 0!==e.tree}function Ma(e){return 2===e.version&&void 0!==e.threshold&&void 0!==e.checkpoint&&void 0!==e.tree&&"string"==typeof e.tree}var La=Object.freeze({__proto__:null,isPlainNode:Na,isPlainNested:Ra,isPlainV2Config:Ma,MemoryTrackerStore:pa,recreateBigNumbers:Pa,IndexedDBStore:class{constructor(e){var t=this;this.dbName=e,this._lazyDb=void 0,this.loadConfig=async function(e){return(await t.getDb()).get("configs",e).then((e=>Pa(e)))},this.saveConfig=async function(e,s){const n=await t.getDb();await n.put("configs",s,e)},this.loadV2Node=async function(e){return(await t.getDb()).get("v2Nodes",e).then((e=>Pa(e)))},this.saveV2Node=async function(e,s){const n=await t.getDb();await n.put("v2Nodes",s,e)},this.loadCounterfactualWallet=async function(e){return(await t.getDb()).get("counterfactualWallets",e)},this.saveCounterfactualWallet=async function(e,s,n){const r=await t.getDb();await r.put("counterfactualWallets",{imageHash:s,context:n},e)},this.loadPayloadOfSubdigest=async function(e){return(await t.getDb()).get("payloads",e).then((e=>Pa(e)))},this.savePayloadOfSubdigest=async function(e,s){const n=await t.getDb();await n.put("payloads",s,e)},this.loadSubdigestsOfSigner=async function(e){const s=await t.getDb();return(await s.getAllKeysFromIndex("signatures","signer",IDBKeyRange.only(e))).map((e=>e.split("-")[0]))},this.loadSignatureOfSubdigest=async function(e,s){const n=await t.getDb(),r=await n.get("signatures",[s,e].join("-"));return null==r?void 0:r.signature},this.saveSignatureOfSubdigest=async function(e,s,n){const r=await t.getDb();await r.put("signatures",{signature:n,signer:e},[s,e].join("-"))},this.loadMigrationsSubdigest=async function(e,s,n){const r=await t.getDb();return(await r.getAllFromIndex("migrations","jump",IDBKeyRange.only([e,s,n]))).map((e=>({subdigest:e.subdigest,toImageHash:e.toImageHash})))},this.saveMigrationsSubdigest=async function(e,s,n,r,i){const o=await t.getDb();await o.put("migrations",{wallet:e,fromVersion:s,toVersion:n,subdigest:r,toImageHash:i},r)}}async getDb(){if(this._lazyDb)return this._lazyDb;const e=this.dbName;return this._lazyDb=await function(e,t,{blocked:s,upgrade:n,blocking:r,terminated:i}={}){const o=indexedDB.open(e,t),a=Oa(o);return n&&o.addEventListener("upgradeneeded",(e=>{n(Oa(o.result),e.oldVersion,e.newVersion,Oa(o.transaction),e)})),s&&o.addEventListener("blocked",(e=>s(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(e,1,{upgrade(t,s,n,r){if(console.log(`upgrading ${e} from ${s} to ${n} - ${r}`),0===s){t.createObjectStore("configs"),t.createObjectStore("v2Nodes"),t.createObjectStore("counterfactualWallets"),t.createObjectStore("payloads");t.createObjectStore("signatures").createIndex("signer","signer",{unique:!1});t.createObjectStore("migrations").createIndex("jump",["wallet","fromVersion","toVersion"])}}}),this._lazyDb}}});class Ba{constructor(e,s=new pa,n=!1){var r=this;this.provider=e,this.store=s,this.useEIP5719=n,this.cachedEIP5719=void 0,this.loadTopology=async function(e){const t=await r.store.loadV2Node(e);if(!t)return{nodeHash:e};if(Na(t)){const[e,s]=await Promise.all([r.loadTopology(t.left),r.loadTopology(t.right)]);return{left:e,right:s}}return Ra(t)?{weight:BigInt(t.weight),threshold:BigInt(t.threshold),tree:await r.loadTopology(t.tree)}:t},this.saveTopology=async function(e){if(Qs(e))return;const t=nn(e);if(Zs(e)){const s=r.saveTopology(e.left),n=r.saveTopology(e.right),i=r.store.saveV2Node(t,{left:nn(e.left),right:nn(e.right)});await Promise.all([s,n,i])}else{if(!Ys(e)){if(Vs(e))return r.store.saveV2Node(t,{address:e.address,weight:e.weight});if(Ks(e))return r.store.saveV2Node(t,{subdigest:e.subdigest});throw new Error(`Unknown topology type: ${e}`)}{const s=r.saveTopology(e.tree),n=r.store.saveV2Node(t,{weight:BigInt(e.weight).toString(),threshold:BigInt(e.threshold).toString(),tree:nn(e.tree)});await Promise.all([s,n])}}},this.saveWalletConfig=async function(e){const{config:t}=e;if(is.isWalletConfig(t)){const e=is.imageHashOf(t);return r.store.saveConfig(e,t)}if(wn.isWalletConfig(t)){const e=wn.imageHashOf(t);if(mn(t.tree))return r.store.saveConfig(e,t)}},this.configOfImageHashCache={},this.configOfImageHash=async function(e){const{imageHash:t}=e;if(r.configOfImageHashCache[e.imageHash])return r.configOfImageHashCache[e.imageHash];const s=await r.store.loadConfig(t);if(s){if(1===s.version||2===s.version&&!Ma(s))return r.configOfImageHashCache[e.imageHash]=s,s;if(Ma(s)){const t={version:2,threshold:BigInt(s.threshold),checkpoint:BigInt(s.checkpoint),tree:await r.loadTopology(s.tree)};return r.configOfImageHashCache[e.imageHash]=t,t}throw new Error(`Unknown config type: ${s}`)}},this.saveCounterfactualWallet=async function(e){const{config:t,context:s}=e,n=ar(t.version).config.imageHashOf(t);await Promise.all([r.saveWalletConfig({config:t}),...s.map((e=>{const t=Sn(e,n);return r.store.saveCounterfactualWallet(t,n,e)}))])},this.imageHashOfCounterfactualWallet=async function(e){const{wallet:t}=e,s=await r.store.loadCounterfactualWallet(t);if(s)return{imageHash:s.imageHash,context:s.context}},this.savePayload=async function(e){const{payload:t}=e,s=$t(t);await r.store.savePayloadOfSubdigest(s,t)},this.payloadOfSubdigestCache={},this.payloadOfSubdigest=async function(e){if(r.payloadOfSubdigestCache[e.subdigest])return r.payloadOfSubdigestCache[e.subdigest];const{subdigest:t}=e,s=await r.store.loadPayloadOfSubdigest(t);return s&&(r.payloadOfSubdigestCache[t]=s),s},this.savePresignedConfiguration=async function(e){const s=Fs.decode(e.signature),n=us(ar(e.nextConfig.version).config.imageHashOf(e.nextConfig)),i=t.ethers.keccak256(n),o={message:n,address:e.wallet,chainId:0,digest:i},a=r.savePayload({payload:o}),c=r.saveWalletConfig({config:e.nextConfig}),h=await Fs.recover(s,o,r.provider),l=js(h.config.tree);await Promise.all([a,c,r.saveWalletConfig({config:h.config}),...l.map((e=>r.store.saveSignatureOfSubdigest(e.address,h.subdigest,e.signature)))])},this.loadPresignedConfiguration=async function(e){const{wallet:s,fromImageHash:n,longestPath:i}=e,a=await r.configOfImageHash({imageHash:n});if(!a||!wn.isWalletConfig(a))return[];const c=gn(a.tree).map((e=>e.address)),h=await Promise.all(c.map((e=>r.store.loadSubdigestsOfSigner(e)))),l=[...new Set(h.flat())],d=(await Promise.all([...new Set(l)].map((async function(e){return o({},await r.payloadOfSubdigest({subdigest:e}),{subdigest:e})})))).filter((e=>(null==e?void 0:e.message)&&(null==e?void 0:e.address)&&e.address===s)).map((e=>({payload:e,nextImageHash:fs(e.message)}))).filter((e=>null==e?void 0:e.nextImageHash));let u;const f=(await Promise.all(d.map((async function({nextImageHash:e,payload:t}){const s=await r.configOfImageHash({imageHash:e});if(!s||!rn(s))return;return{nextConfig:s,nextCheckpoint:BigInt(s.checkpoint),nextImageHash:e,payload:t}})))).filter((e=>void 0!==e)).filter((e=>e.nextCheckpoint>BigInt(a.checkpoint))).sort(((e,t)=>e.nextCheckpoint>t.nextCheckpoint?i?1:-1:i?-1:1));for(const e of f){const{nextConfig:s,nextCheckpoint:n,nextImageHash:o,payload:h}=e;if(u){const e=u.checkpoint;if(i){if(n>=e)continue}else if(n<=e)continue}const l=new Map((await Promise.all(c.map((async function(e){const s=await r.store.loadSignatureOfSubdigest(e,h.subdigest);if(!s)return[e,void 0];const n=t.ethers.hexlify(r.useEIP5719?await r.cachedEIP5719.runByEIP5719(e,h.subdigest,s):s);return[e,{isDynamic:Kt(h.subdigest,n)!==e,signature:n}]})))).filter((e=>Boolean(e[1]))));if(0===l.size)continue;const d=Fs.encodeSigners(a,l,[],0);d.weight<BigInt(a.threshold)||(u={nextImageHash:o,checkpoint:BigInt(s.checkpoint),signature:d.encoded})}if(!u)return[];const p=await r.loadPresignedConfiguration({wallet:s,fromImageHash:u.nextImageHash,longestPath:i});return[{wallet:s,nextImageHash:u.nextImageHash,signature:u.signature},...p]},this.saveWitnesses=async function(e){const t={digest:e.digest,address:e.wallet,chainId:e.chainId},s=$t(t);await Promise.all([r.savePayload({payload:t}),...e.signatures.filter((e=>Ft(e))).map((e=>{const t=Gt(s,e);return r.store.saveSignatureOfSubdigest(t,s,e)}))])},this.walletsOfSigner=async function(e){const s=await r.store.loadSubdigestsOfSigner(e.signer),n=await Promise.all(s.map((e=>r.payloadOfSubdigest({subdigest:e})))).then((e=>e.filter((e=>void 0!==e)))),i=[];for(const s of n){const n=s.address;if(i.find((e=>e.wallet===n)))continue;const o=$t(s),a=await r.store.loadSignatureOfSubdigest(e.signer,o);a&&i.push({wallet:n,proof:{digest:s.digest,chainId:BigInt(s.chainId),signature:t.ethers.hexlify(a)}})}return i},this.cachedEIP5719=new na(e)}async saveMigration(e,s,n){const r=s.fromVersion;if(1!==r)throw new Error("Migration not supported");if(!rn(s.toConfig))throw new Error("Invalid to config");const{newImageHash:i,address:o}=pr.decodeTransaction(s.tx,n);if(o!==e)throw new Error("Invalid migration transaction - address");if(wn.imageHashOf(s.toConfig)!=i)throw new Error("Invalid migration transaction - config");const a=xn(s.tx.nonce,s.tx.transactions),c=t.ethers.keccak256(a),h={chainId:s.tx.chainId,message:a,address:e,digest:c},l=$t(h),d=this.savePayload({payload:h}),u=this.saveWalletConfig({config:s.toConfig}),f=ns.decode(s.tx.signature),p=await ns.recover(f,h,this.provider),g=ns.signaturesOf(p.config);await Promise.all([d,u,this.saveWalletConfig({config:p.config}),this.store.saveMigrationsSubdigest(e,r,r+1,l,i),...g.map((e=>this.store.saveSignatureOfSubdigest(e.address,p.subdigest,e.signature)))])}async getMigration(e,s,n,r){var i=this;const[o,a]=await Promise.all([this.configOfImageHash({imageHash:s}),this.store.loadMigrationsSubdigest(e,n,n+1)]),c=or(n);if(!o)return;if(!c.config.isWalletConfig(o))return;const h=await Promise.all(a.map((async function(s){const{subdigest:a,toImageHash:h}=s,l=await i.payloadOfSubdigest({subdigest:a});if(!l||!l.message)return;if(BigInt(r)!==BigInt(l.chainId))return;const d=c.config.signersOf(o).map((e=>e.address)),u=new Map((await Promise.all(d.map((async function(e){const s=await i.store.loadSignatureOfSubdigest(e,a);if(!s)return[e,void 0];const n=t.ethers.hexlify(i.useEIP5719?await i.cachedEIP5719.runByEIP5719(e,a,s):s);return[e,{isDynamic:Kt(a,n)!==e,signature:n}]})))).filter((e=>Boolean(e[1])))),f=c.signature.encodeSigners(o,u,[],r);if(!f||f.weight<BigInt(o.threshold))return;const[p,g]=An(l.message);return{tx:{entrypoint:e,transactions:Wn(g),chainId:r,nonce:p,signature:f.encoded,intent:{id:a,wallet:e}},toConfig:await i.configOfImageHash({imageHash:h}),fromVersion:n,toVersion:n+1}}))).then((e=>e.filter((e=>void 0!==e))));return h[0]}updateProvider(e){this.provider=e}}var $a=Object.freeze({__proto__:null,LocalConfigTracker:Ba});let Da=function(e){return e.EIP712="EIP712",e.EthSign="EthSign",e.EIP1271="EIP1271",e}({});class Wa{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Sessions/",this.ping=(e,t)=>this.fetch(this.url("Ping"),ja({},e,t)).then((e=>Ua(e).then((e=>({})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.config=(e,t,s)=>this.fetch(this.url("Config"),ja(e,t,s)).then((e=>Ua(e).then((e=>({version:e.version,config:e.config})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.wallets=(e,t,s)=>this.fetch(this.url("Wallets"),ja(e,t,s)).then((e=>Ua(e).then((e=>({wallets:e.wallets,cursor:e.cursor})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.deployHash=(e,t,s)=>this.fetch(this.url("DeployHash"),ja(e,t,s)).then((e=>Ua(e).then((e=>({deployHash:e.deployHash,context:e.context})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.configUpdates=(e,t,s)=>this.fetch(this.url("ConfigUpdates"),ja(e,t,s)).then((e=>Ua(e).then((e=>({updates:e.updates})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.migrations=(e,t,s)=>this.fetch(this.url("Migrations"),ja(e,t,s)).then((e=>Ua(e).then((e=>({migrations:e.migrations})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.saveConfig=(e,t,s)=>this.fetch(this.url("SaveConfig"),ja(e,t,s)).then((e=>Ua(e).then((e=>({})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.saveWallet=(e,t,s)=>this.fetch(this.url("SaveWallet"),ja(e,t,s)).then((e=>Ua(e).then((e=>({})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.saveSignature=(e,t,s)=>this.fetch(this.url("SaveSignature"),ja(e,t,s)).then((e=>Ua(e).then((e=>({})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.saveSignerSignatures=(e,t,s)=>this.fetch(this.url("SaveSignerSignatures"),ja(e,t,s)).then((e=>Ua(e).then((e=>({})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.saveSignerSignatures2=(e,t,s)=>this.fetch(this.url("SaveSignerSignatures2"),ja(e,t,s)).then((e=>Ua(e).then((e=>({})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.saveMigration=(e,t,s)=>this.fetch(this.url("SaveMigration"),ja(e,t,s)).then((e=>Ua(e).then((e=>({})))),(e=>{throw Fa.new({cause:`fetch(): ${e.message||""}`})})),this.hostname=e.replace(/\/*$/,""),this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const ja=(e={},t={},s=null)=>({method:"POST",headers:o({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{}),signal:s}),Ua=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){let n="";throw s instanceof Error&&(n=s.message),za.new({status:e.status,cause:`JSON.parse(): ${n}: response text: ${t}`})}if(!e.ok){const e="number"==typeof s.code?s.code:0;throw(sc[e]||Ha).new(s)}return s}));class Ha extends Error{constructor(e,t,s,n,r){super(s),this.name=void 0,this.code=void 0,this.message=void 0,this.status=void 0,this.cause=void 0,this.msg=void 0,this.name=e||"WebrpcError",this.code="number"==typeof t?t:0,this.message=s||`endpoint error ${this.code}`,this.msg=this.message,this.status="number"==typeof n?n:0,this.cause=r,Object.setPrototypeOf(this,Ha.prototype)}static new(e){return new this(e.error,e.code,e.message||e.msg,e.status,e.cause)}}class qa extends Ha{constructor(e="WebrpcEndpoint",t=0,s="endpoint error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,qa.prototype)}}class Fa extends Ha{constructor(e="WebrpcRequestFailed",t=-1,s="request failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Fa.prototype)}}class Ga extends Ha{constructor(e="WebrpcBadRoute",t=-2,s="bad route",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ga.prototype)}}class Va extends Ha{constructor(e="WebrpcBadMethod",t=-3,s="bad method",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Va.prototype)}}class Ka extends Ha{constructor(e="WebrpcBadRequest",t=-4,s="bad request",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ka.prototype)}}class za extends Ha{constructor(e="WebrpcBadResponse",t=-5,s="bad response",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,za.prototype)}}class Ja extends Ha{constructor(e="WebrpcServerPanic",t=-6,s="server panic",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ja.prototype)}}class Ya extends Ha{constructor(e="WebrpcInternalError",t=-7,s="internal error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ya.prototype)}}class Qa extends Ha{constructor(e="WebrpcClientDisconnected",t=-8,s="client disconnected",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Qa.prototype)}}class Xa extends Ha{constructor(e="WebrpcStreamLost",t=-9,s="stream lost",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Xa.prototype)}}class Za extends Ha{constructor(e="WebrpcStreamFinished",t=-10,s="stream finished",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Za.prototype)}}class ec extends Ha{constructor(e="InvalidArgument",t=1,s="invalid argument",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,ec.prototype)}}class tc extends Ha{constructor(e="NotFound",t=2,s="not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,tc.prototype)}}const sc={0:qa,[-1]:Fa,[-2]:Ga,[-3]:Va,[-4]:Ka,[-5]:za,[-6]:Ja,[-7]:Ya,[-8]:Qa,[-9]:Xa,[-10]:Za,1:ec,2:tc};class nc{constructor(e,t=!0){this.onlyRecoverable=t,this.sessions=void 0,this.sessions=new Wa(e,fetch)}async loadPresignedConfiguration(e){try{const{updates:t}=await this.sessions.configUpdates({wallet:e.wallet,fromImageHash:e.fromImageHash,allUpdates:e.longestPath});return t.map((({toImageHash:t,signature:s})=>({wallet:e.wallet,nextImageHash:t,signature:s})))}catch(e){if(lc(e))return[];throw e}}async savePresignedConfiguration(e){const s=e.nextConfig,n=Ms(ar(s.version).config.imageHashOf(s)),r=t.ethers.keccak256(n);await this.sessions.saveSignature({wallet:e.wallet,digest:r,chainID:"0",signature:e.signature,toConfig:rc(s)})}async saveWitnesses(e){let t=e.signatures;this.onlyRecoverable&&(t=t.filter((e=>Ft(e)))),await this.sessions.saveSignerSignatures({wallet:e.wallet,digest:e.digest,chainID:hc(e.chainId),signatures:t})}async configOfImageHash(e){try{const{version:t,config:s}=await this.sessions.config(e);return function(e,t){switch(e){case 1:return o({},t,{version:e});case 2:return o({},t,{version:e,tree:oc(t.tree)});default:throw new Error(`unknown version ${e}`)}}(t,s)}catch(e){if(lc(e))return;throw e}}async saveWalletConfig(e){const t=rc(e.config);await this.sessions.saveConfig({version:e.config.version,config:t})}async imageHashOfCounterfactualWallet(e){try{const{deployHash:t,context:s}=await this.sessions.deployHash(e);return{imageHash:t,context:s}}catch(e){if(lc(e))return;throw e}}async saveCounterfactualWallet(e){const t=rc(e.config);await this.sessions.saveWallet({version:e.config.version,deployConfig:t})}async walletsOfSigner(e){const{wallets:s}=await this.sessions.wallets(e);return Object.entries(s).map((([e,{digest:s,chainID:n,type:r,signature:i}])=>{switch(r){case Da.EIP712:i+=t.ethers.toBeHex(qt.EIP712).slice(2);break;case Da.EthSign:i+=t.ethers.toBeHex(qt.ETH_SIGN).slice(2);break;case Da.EIP1271:i+=t.ethers.toBeHex(qt.WALLET_BYTES32).slice(2)}return{wallet:e,proof:{digest:s,signature:i,chainId:BigInt(n)}}}))}async getMigration(e,t,s,n){var r=this;const i=hc(n),{migrations:o}=await this.sessions.migrations({wallet:e,fromVersion:s,fromImageHash:t,chainID:i}),a=async function(t){const n=o[t];if(n){const i=Object.keys(n).map(Number).sort(((e,t)=>t-e));for(const o of i)for(const[i,a]of Object.entries(n[o]))try{const n=await r.configOfImageHash({imageHash:i});if(n)return{fromVersion:s,toVersion:o,toConfig:n,tx:{entrypoint:a.executor,transactions:a.transactions,nonce:a.nonce,signature:a.signature,chainId:t,intent:{id:Nn(e,t,a.nonce,a.transactions),wallet:e}}}}catch(e){console.error(e)}}},c=await a(i);if(c)return c;for(const e in o)if(e!==i){const t=await a(e);if(t)return t}}async saveMigration(e,t,s){await this.sessions.saveMigration({wallet:e,fromVersion:t.fromVersion,toVersion:t.toVersion,toConfig:rc(t.toConfig),executor:t.tx.entrypoint,transactions:t.tx.transactions.map(ac),nonce:hc(t.tx.nonce),signature:t.tx.signature,chainID:hc(t.tx.chainId)})}}function rc(e){switch(e.version){case 1:if(is.isWalletConfig(e))return{threshold:cc(e.threshold),signers:e.signers.map((({weight:e,address:t})=>({weight:cc(e),address:t})))};throw new Error(`not a v${e.version} config: ${e}`);case 2:if(wn.isWalletConfig(e))return{threshold:cc(e.threshold),checkpoint:cc(e.checkpoint),tree:ic(e.tree)};throw new Error(`not a v${e.version} config: ${e}`);default:throw new Error(`unknown version ${e.version}`)}}function ic(e){return Zs(e)?{left:ic(e.left),right:ic(e.right)}:Vs(e)?{weight:cc(e.weight),address:e.address}:Ys(e)?{weight:cc(e.weight),threshold:cc(e.threshold),tree:ic(e.tree)}:Qs(e)?{node:e.nodeHash}:o({},e)}function oc(e){if("object"==typeof e){const t=o({},e);return void 0!==t.left&&(t.left=oc(t.left)),void 0!==t.right&&(t.right=oc(t.right)),void 0!==t.tree&&(t.tree=oc(t.tree)),void 0!==t.node&&(t.nodeHash=t.node,delete t.node),t}throw new Error(`v2 config tree ${e} is not an object`)}function ac(e){return{to:e.to,value:void 0!==e.value?hc(e.value):void 0,data:void 0!==e.data?t.ethers.hexlify(e.data):void 0,gasLimit:void 0!==e.gasLimit?hc(e.gasLimit):void 0,delegateCall:e.delegateCall,revertOnError:e.revertOnError}}function cc(e){return Number(e)}function hc(e){return BigInt(e).toString()}function lc(e){return"object"==typeof e&&404===e.status}var dc=Object.freeze({__proto__:null,RemoteConfigTracker:nc});function uc(e,t,s){return new Promise((n=>{let r=0;e.forEach((i=>i.then((i=>{s(i)?n(i):(r++,r===e.length&&n(t))})).catch((()=>{r++,r===e.length&&n(t)}))))}))}async function fc(e,t){return Promise.all(e.map((e=>e.catch((()=>t)))))}class pc{constructor(){this.cache=void 0,this.cache=new Map}do(e,s,n,...r){e=`${e}:${t.ethers.id(JSON.stringify(r,gc))}`;let i=this.cache.get(e);if(i&&i.expiration&&new Date>=i.expiration&&(i=void 0,this.cache.delete(e)),!i){const t={promise:n(...r)};void 0!==s&&(t.promise=t.promise.then((e=>(t.expiration=new Date(Date.now()+s),e)))),i=t,this.cache.set(e,i)}return i.promise}}function gc(e,t){return"object"!=typeof t||null===t||Array.isArray(t)?"bigint"==typeof t?t.toString():t:Object.fromEntries(Object.entries(t).sort())}function mc(e){return e instanceof wc}class wc{constructor(e,t=50,s=!1){this.tracker=e,this.window=t,this.verbose=s,this.cache=new pc}invalidateCache(){this.cache=new pc}configOfImageHash(e){return this.cache.do("configOfImageHash",this.window,(e=>this.tracker.configOfImageHash(e)),e)}getMigration(e,t,s,n){return this.cache.do("getMigration",this.window,((...e)=>this.tracker.getMigration(...e)),e,t,s,n)}saveMigration(e,t,s){return this.cache.do("saveMigration",void 0,((...e)=>this.tracker.saveMigration(...e)),e,t,s)}loadPresignedConfiguration(e){return this.cache.do("loadPresignedConfiguration",this.window,(e=>this.tracker.loadPresignedConfiguration(e)),e)}savePresignedConfiguration(e){return this.cache.do("savePresignedConfiguration",void 0,(e=>this.tracker.savePresignedConfiguration(e)),e)}saveWitnesses(e){return this.cache.do("saveWitnesses",void 0,(e=>this.tracker.saveWitnesses(e)),e)}saveWalletConfig(e){return this.cache.do("saveWalletConfig",void 0,(e=>this.tracker.saveWalletConfig(e)),e)}imageHashOfCounterfactualWallet(e){return this.cache.do("imageHashOfCounterfactualWallet",void 0,(e=>this.tracker.imageHashOfCounterfactualWallet(e)),e)}saveCounterfactualWallet(e){return this.cache.do("saveCounterfactualWallet",void 0,(e=>this.tracker.saveCounterfactualWallet(e)),e)}walletsOfSigner(e){return this.cache.do("walletsOfSigner",this.window,(e=>this.tracker.walletsOfSigner(e)),e)}updateProvider(e){this.tracker instanceof Ba&&this.tracker.updateProvider(e)}}var yc=Object.freeze({__proto__:null,arweave:da,debug:fa,local:$a,remote:dc,stores:La,raceUntil:uc,allSafe:fc,MultipleTracker:class{constructor(e){this.trackers=e}async configOfImageHash(e){const t=this.trackers.map((async function(t,s){return{res:await t.configOfImageHash(e),i:s}})),s=await uc(t,void 0,(e=>void 0!==(null==e?void 0:e.res)&&ar(e.res.version).config.isComplete(e.res)));if(null!=s&&s.res)return this.saveWalletConfig({config:s.res,skipTracker:s.i}),s.res;const n=new Ba(void 0),r=await fc(t,void 0);for(const e of r)null!=e&&e.res&&await n.saveWalletConfig({config:e.res});const i=await n.configOfImageHash(e);return i&&this.saveWalletConfig({config:i}),i}async saveWalletConfig(e){await Promise.all(this.trackers.map(((t,s)=>{if(s!==e.skipTracker)return t.saveWalletConfig(e)})))}async imageHashOfCounterfactualWallet(e){const t=await uc(this.trackers.map((t=>t.imageHashOfCounterfactualWallet(e))),void 0,(e=>Boolean(e)));return t&&this.configOfImageHash({imageHash:t.imageHash}).then((e=>{e&&this.saveCounterfactualWallet({config:e,context:[t.context]})})),t}async saveCounterfactualWallet(e){await Promise.all(this.trackers.map(((t,s)=>{if(s!==e.skipTracker)return t.saveCounterfactualWallet(e)})))}async walletsOfSigner(e){const t=await fc(this.trackers.map((t=>t.walletsOfSigner(e))),[]).then((e=>e.flat())),s={};for(const e of t)s[e.wallet]=e.proof;const n=Object.keys(s).map((e=>({wallet:e,proof:s[e]}))),r=new Map;return n.forEach((({wallet:e,proof:{digest:t,chainId:s,signature:n}})=>{const i=`${e}-${t}-${s}`;let o=r.get(i);o||(o={wallet:e,digest:t,chainId:s,signatures:[]},r.set(i,o)),o.signatures.push(n)})),r.forEach((e=>this.saveWitnesses(e))),n}async saveWitnesses(e){await Promise.all(this.trackers.map((t=>t.saveWitnesses(e))))}async loadPresignedConfiguration(e){var t=this;const s=await fc(this.trackers.map((t=>t.loadPresignedConfiguration(e))),[]),n=await fc(s.map((async function(e){const s=e[e.length-1],n=await t.configOfImageHash({imageHash:s.nextImageHash});if(n)return{checkpoint:ar(n.version).config.checkpointOf(n),result:e}})),void 0),r=n.reduce(((e,t)=>t?e?t.checkpoint>e.checkpoint?t:e:t:e));if(!r)return[];const i=new Map,o=e=>(i.has(e)||i.set(e,this.configOfImageHash({imageHash:e})),i.get(e));return r.result.forEach((async function(s){const n=await o(s.nextImageHash);n&&t.savePresignedConfiguration({wallet:e.wallet,nextConfig:n,signature:s.signature})})),r.result}async savePresignedConfiguration(e){await Promise.all(this.trackers.map((t=>t.savePresignedConfiguration(e))))}async getMigration(e,t,s,n){return(await Promise.all(this.trackers.map((r=>r.getMigration(e,t,s,n))))).find((e=>!!e))}async saveMigration(e,t,s){await Promise.all(this.trackers.map((n=>n.saveMigration(e,t,s))))}},CachedTracker:class{constructor(e,t,s){this.tracker=e,this.cache=t,this.contexts=s}async loadPresignedConfiguration(e){var t=this;const s=[this.tracker.loadPresignedConfiguration(e),this.cache.loadPresignedConfiguration(e)];let n;const[r,i]=await Promise.all(s);if(r.length>0&&i.length>0&&r[r.length-1].nextImageHash===i[i.length-1].nextImageHash)n=!0===e.longestPath?r.length>i.length?r:i:r.length<i.length?r:i;else{var o,a;const e=await Promise.all(s.map((async function(e){const s=await e,n=s[s.length-1];if(!n)return;const r=await t.configOfImageHash({imageHash:n.nextImageHash});return r?{checkpoint:ar(r.version).config.checkpointOf(r),result:s}:void 0})));n=null!=(o=null==(a=e.reduce(((e,t)=>t?e?t.checkpoint>e.checkpoint?t:e:t:e)))?void 0:a.result)?o:[]}return n||[]}async savePresignedConfiguration(e){await Promise.all([this.tracker.savePresignedConfiguration(e),this.cache.savePresignedConfiguration(e)])}async configOfImageHash(e){if(!0!==e.noCache){const t=await this.cache.configOfImageHash(e);if(t)return t}const t=await this.tracker.configOfImageHash(e);return t&&await this.cache.saveWalletConfig({config:t}),t}async saveWalletConfig(e){await Promise.all([this.tracker.saveWalletConfig(e),this.cache.saveWalletConfig(e)])}async imageHashOfCounterfactualWallet(e){if(!0!==e.noCache){const t=await this.cache.imageHashOfCounterfactualWallet(e);if(t)return t}const t=await this.tracker.imageHashOfCounterfactualWallet(e);if(t){const e=await this.configOfImageHash({imageHash:t.imageHash});e&&await this.cache.saveCounterfactualWallet({config:e,context:[t.context]})}return t}async saveCounterfactualWallet(e){await Promise.all([this.tracker.saveCounterfactualWallet(e),this.cache.saveCounterfactualWallet(e)])}async walletsOfSigner(e){if(e.noCache)return this.tracker.walletsOfSigner(e);const t=await Promise.all([this.tracker.walletsOfSigner(e),this.cache.walletsOfSigner(e)]),s=new Map;for(const e of t)for(const t of e)s.set(t.wallet,t);return Array.from(s.values())}async saveWitnesses(e){await Promise.all([this.tracker.saveWitnesses(e),this.cache.saveWitnesses(e)])}async getMigration(e,t,s,n){const r=await this.cache.getMigration(e,t,s,n);if(r)return r;const i=await this.tracker.getMigration(e,t,s,n);return i&&await this.cache.saveMigration(e,i,this.contexts),i}async saveMigration(e,t,s){await Promise.all([this.tracker.saveMigration(e,t,s),this.cache.saveMigration(e,t,s)])}},isDedupedTracker:mc,DedupedTracker:wc});function bc(e){return e.config&&e.metadata&&void 0===e.version}function vc(e){return 2===e.version&&e.address}const Ec=[1,137],Ic={contexts:On,networks:wt,tracker:new nc("https://sessions.sequence.app")};class Tc{constructor(e,t,s,n){this.networks=e,this.contexts=t,this.account=s,this.services=n}async dump(){const e={version:2,address:this.account.address};return this.services?o({},e,await this.services.dump()):e}static async singleSigner(e){let{signer:s}=e;"string"==typeof s&&(s=new t.ethers.Wallet(s));const n=new fi([s]),r=await s.getAddress(),i=[{weight:1,address:r}],a=e.selectWallet||async function(t){var s,n;if(0===t.length)return;const i=null!=(s=null==(n=e.settings)?void 0:n.tracker)?s:Ic.tracker,o=await Promise.all(t.map((async function(e){const t=await i.imageHashOfCounterfactualWallet({wallet:e});return{wallet:e,config:t&&await i.configOfImageHash({imageHash:t.imageHash})}})));for(const e of o){if(!e.config)continue;const t=ar(e.config.version).config.signersOf(e.config);if(1===t.length&&t[0].address===r)return e.wallet}};return Tc.open(o({},e,{orchestrator:n,referenceSigner:r,threshold:1,addSigners:i,selectWallet:a}))}static async open(e){var t,s,n,r,i;const{referenceSigner:a,threshold:c,addSigners:h,selectWallet:l,onAccountAddress:d,settings:u,editConfigOnMigration:f,onMigration:p,orchestrator:g,projectAccessKey:m}=e,{contexts:w,networks:y,tracker:b,services:v}=o({},Ic,u),E=null!=(t=null==(s=Re(y,null!=(n=null==u||null==(r=u.services)?void 0:r.sequenceApiChainId)?n:ke.MAINNET))?void 0:s.chainId)?t:null==(i=y[0])?void 0:i.chainId;if(!E)throw Error("No reference chain found");const I=await b.walletsOfSigner({signer:a}),T=await l(I.map((e=>e.wallet)));let S,O;if(T){if(null==d||d(T),S=new bi({address:T,tracker:b,networks:y,contexts:w,orchestrator:g,projectAccessKey:m}),h&&h.length>0){let e=await S.status(E);if(e.original.version!==e.version||S.version!==e.version){const{migratedAllChains:t,failedChains:s}=await S.isMigratedAllChains();if(s.some((e=>Ec.includes(e))))throw Error(`Failed to fetch account status on ${s.join(", ")}`);if(!t){if(p&&!await p(S))throw Error("Migration cancelled, cannot open session");const{failedChains:t}=await S.signAllMigrations(f||(e=>e));if(t.some((e=>Ec.includes(e))))throw Error(`Failed to sign migrations on ${t.join(", ")}`);let s;if(mc(b)&&b.invalidateCache(),[s,e]=await Promise.all([S.isMigratedAllChains().then((e=>e.migratedAllChains)),S.status(E)]),!s)throw Error("Failed to migrate account")}}e.onChain.version!==e.version&&await S.doBootstrap(E,void 0,e);const t=e.config,s=S.coders.config.editConfig(t,{add:h,threshold:c});if(S.coders.config.imageHashOf(t)!==S.coders.config.imageHashOf(s)){const e=S.coders.config.editConfig(s,{checkpoint:S.coders.config.checkpointOf(t)+1n});await S.updateConfig(e)}}}else{if(!h||0===h.length)throw Error("Cannot create new account without signers");if(!c)throw Error("Cannot create new account without threshold");S=await bi.new({config:{threshold:c,checkpoint:0,signers:h},tracker:b,contexts:w,orchestrator:g,networks:y,projectAccessKey:m}),null==d||d(S.address),await S.publishWitness();if(!(await b.walletsOfSigner({signer:a,noCache:!0})).some((e=>e.wallet===S.address)))throw Error("Account not found on tracker")}return v&&(O=new Xo(S,v),O.auth(),O.onAuth((e=>{"fulfilled"===e.status&&S.setJwt(e.value)}))),new Tc(y,w,S,O)}static async load(e){const{dump:t,settings:s,editConfigOnMigration:n,onMigration:r,orchestrator:i}=e,{contexts:a,networks:c,tracker:h,services:l}=o({},Ic,s);let d,u;if(bc(t)){var f,p,g;const e=t.config.address||Sn(a[1],is.imageHashOf(o({},t.config,{version:1}))),s=(null!=(f=null==(p=t.jwt)?void 0:p.expiration)?f:0)<Math.floor(Date.now()/1e3);if(d=new bi({address:e,tracker:h,networks:c,contexts:a,orchestrator:i,jwt:s||null==(g=t.jwt)?void 0:g.token}),!await d.isMigratedAllChains().then((e=>e.migratedAllChains))){if(r&&!await r(d))throw Error("Migration cancelled, cannot open session");if(console.log("Migrating account..."),await d.signAllMigrations(n),!await d.isMigratedAllChains().then((e=>e.migratedAllChains)))throw Error("Failed to migrate account")}}else{if(!vc(t))throw Error("Invalid dump format");{var m,w,y;const e=(null!=(m=null==(w=t.jwt)?void 0:w.expiration)?m:0)<Math.floor(Date.now()/1e3);d=new bi({address:t.address,tracker:h,networks:c,contexts:a,orchestrator:i,jwt:e||null==(y=t.jwt)?void 0:y.token})}}var b;l&&(u=new Xo(d,l,t.jwt&&{jwt:{token:Promise.resolve(t.jwt.token),expiration:null!=(b=t.jwt.expiration)?b:Je(t.jwt.token).exp},metadata:t.metadata}));return new Tc(c,a,d,u)}}var Sc=Object.freeze({__proto__:null,signAuthorization:Zo,AuthError:ea,ErrAccountIsRequired:ta,isSessionDumpV1:bc,isSessionDumpV2:vc,CRITICAL_CHAINS:Ec,SessionSettingsDefault:Ic,Session:Tc,ValidateSequenceWalletProof:(e,t,s)=>async(t,s,n)=>{const r=n.messageDigest();return{isValid:await e(s).isValidSignature(n.address,r,n.signature)}}});class Oc{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Guard/",this.ping=(e,t)=>this.fetch(this.url("Ping"),kc({},e,t)).then((e=>Cc(e).then((e=>({status:e.status})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.version=(e,t)=>this.fetch(this.url("Version"),kc({},e,t)).then((e=>Cc(e).then((e=>({version:e.version})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.runtimeStatus=(e,t)=>this.fetch(this.url("RuntimeStatus"),kc({},e,t)).then((e=>Cc(e).then((e=>({status:e.status})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.getSignerConfig=(e,t,s)=>this.fetch(this.url("GetSignerConfig"),kc(e,t,s)).then((e=>Cc(e).then((e=>({signerConfig:e.signerConfig})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.sign=(e,t,s)=>this.fetch(this.url("Sign"),kc(e,t,s)).then((e=>Cc(e).then((e=>({sig:e.sig})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.signWith=(e,t,s)=>this.fetch(this.url("SignWith"),kc(e,t,s)).then((e=>Cc(e).then((e=>({sig:e.sig})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.patch=(e,t,s)=>this.fetch(this.url("Patch"),kc(e,t,s)).then((e=>Cc(e).then((e=>({txs:e.txs})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.authMethods=(e,t,s)=>this.fetch(this.url("AuthMethods"),kc(e,t,s)).then((e=>Cc(e).then((e=>({methods:e.methods,active:e.active})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.setPIN=(e,t,s)=>this.fetch(this.url("SetPIN"),kc(e,t,s)).then((e=>Cc(e).then((e=>({})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.resetPIN=(e,t,s)=>this.fetch(this.url("ResetPIN"),kc(e,t,s)).then((e=>Cc(e).then((e=>({})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.createTOTP=(e,t,s)=>this.fetch(this.url("CreateTOTP"),kc(e,t,s)).then((e=>Cc(e).then((e=>({uri:e.uri})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.commitTOTP=(e,t,s)=>this.fetch(this.url("CommitTOTP"),kc(e,t,s)).then((e=>Cc(e).then((e=>({codes:e.codes})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.resetTOTP=(e,t,s)=>this.fetch(this.url("ResetTOTP"),kc(e,t,s)).then((e=>Cc(e).then((e=>({})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.reset2FA=(e,t,s)=>this.fetch(this.url("Reset2FA"),kc(e,t,s)).then((e=>Cc(e).then((e=>({})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.recoveryCodes=(e,t,s)=>this.fetch(this.url("RecoveryCodes"),kc(e,t,s)).then((e=>Cc(e).then((e=>({codes:e.codes})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.resetRecoveryCodes=(e,t,s)=>this.fetch(this.url("ResetRecoveryCodes"),kc(e,t,s)).then((e=>Cc(e).then((e=>({codes:e.codes})))),(e=>{throw xc.new({cause:`fetch(): ${e.message||""}`})})),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const kc=(e={},t={},s=null)=>({method:"POST",headers:o({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{}),signal:s}),Cc=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){let n="";throw s instanceof Error&&(n=s.message),Mc.new({status:e.status,cause:`JSON.parse(): ${n}: response text: ${t}`})}if(!e.ok){const e="number"==typeof s.code?s.code:0;throw(zc[e]||_c).new(s)}return s}));class _c extends Error{constructor(e,t,s,n,r){super(s),this.name=void 0,this.code=void 0,this.message=void 0,this.status=void 0,this.cause=void 0,this.msg=void 0,this.name=e||"WebrpcError",this.code="number"==typeof t?t:0,this.message=s||`endpoint error ${this.code}`,this.msg=this.message,this.status="number"==typeof n?n:0,this.cause=r,Object.setPrototypeOf(this,_c.prototype)}static new(e){return new this(e.error,e.code,e.message||e.msg,e.status,e.cause)}}class Ac extends _c{constructor(e="WebrpcEndpoint",t=0,s="endpoint error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Ac.prototype)}}class xc extends _c{constructor(e="WebrpcRequestFailed",t=-1,s="request failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,xc.prototype)}}class Pc extends _c{constructor(e="WebrpcBadRoute",t=-2,s="bad route",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Pc.prototype)}}class Nc extends _c{constructor(e="WebrpcBadMethod",t=-3,s="bad method",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Nc.prototype)}}class Rc extends _c{constructor(e="WebrpcBadRequest",t=-4,s="bad request",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Rc.prototype)}}class Mc extends _c{constructor(e="WebrpcBadResponse",t=-5,s="bad response",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Mc.prototype)}}class Lc extends _c{constructor(e="WebrpcServerPanic",t=-6,s="server panic",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Lc.prototype)}}class Bc extends _c{constructor(e="WebrpcInternalError",t=-7,s="internal error",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Bc.prototype)}}class $c extends _c{constructor(e="WebrpcClientDisconnected",t=-8,s="client disconnected",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,$c.prototype)}}class Dc extends _c{constructor(e="WebrpcStreamLost",t=-9,s="stream lost",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Dc.prototype)}}class Wc extends _c{constructor(e="WebrpcStreamFinished",t=-10,s="stream finished",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Wc.prototype)}}class jc extends _c{constructor(e="Unauthorized",t=1e3,s="Unauthorized access",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,jc.prototype)}}class Uc extends _c{constructor(e="SessionExpired",t=1002,s="Session expired",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Uc.prototype)}}class Hc extends _c{constructor(e="Aborted",t=1005,s="Request aborted",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Hc.prototype)}}class qc extends _c{constructor(e="InvalidArgument",t=2001,s="Invalid argument",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,qc.prototype)}}class Fc extends _c{constructor(e="Unavailable",t=2002,s="Unavailable resource",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Fc.prototype)}}class Gc extends _c{constructor(e="QueryFailed",t=2003,s="Query failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Gc.prototype)}}class Vc extends _c{constructor(e="ValidationFailed",t=2004,s="Validation Failed",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Vc.prototype)}}class Kc extends _c{constructor(e="NotFound",t=3e3,s="Resource not found",n=0,r){super(e,t,s,n,r),Object.setPrototypeOf(this,Kc.prototype)}}const zc={0:Ac,[-1]:xc,[-2]:Pc,[-3]:Nc,[-4]:Rc,[-5]:Mc,[-6]:Lc,[-7]:Bc,[-8]:$c,[-9]:Dc,[-10]:Wc,1e3:jc,1002:Uc,1005:Hc,2001:qc,2002:Fc,2003:Gc,2004:Vc,3e3:Kc},Jc=globalThis.fetch;let Yc=function(e){return e.PIN="PIN",e.TOTP="TOTP",e}({});function Qc(e){switch(e){case Yc.PIN:case Yc.TOTP:return e;default:throw new Error(`unknown auth method '${e}'`)}}function Xc(e){return"signerAddress"in e&&"string"==typeof e.signerAddress}async function Zc(e){if(Xc(e))return e;{const s=ci(e.signer)?e.signer:new hi(e.signer),n=await s.getAddress(),r=new Date,i=th(e.walletAddress,r),o=at(i);return{walletAddress:e.walletAddress,timestamp:r,signerAddress:n,signature:t.ethers.hexlify(await s.sign(o,{}))}}}async function eh(e){if("wallet"in e){var t;const s=new Date,n=sh(s),r=await e.wallet.signTypedData(n.domain,n.types,n.message,null!=(t=n.domain.chainId)?t:1,"eip6492");return{jwt:e.jwt,timestamp:s,signature:r}}return e}function th(e,s){return{domain:nh,types:{AuthMethods:[{name:"wallet",type:"address"},{name:"timestamp",type:"string"}]},message:{wallet:t.ethers.getAddress(e),timestamp:rh(s)}}}function sh(e){return{domain:nh,types:{AuthUpdate:[{name:"timestamp",type:"string"}]},message:{timestamp:rh(e)}}}const nh={name:"Sequence Guard",version:"1",chainId:1};function rh(e){return e.toUTCString().replace("GMT","UTC")}var ih=Object.freeze({__proto__:null,Guard:Oc,GuardSigner:class{constructor(e,t,s=!1){this.address=e,this.url=t,this.appendSuffix=s,this.guard=void 0,this.guard=new Oc(t,Jc)}async getAddress(){return this.address}async buildDeployTransaction(e){}async predecorateSignedTransactions(e){return[]}async decorateTransactions(e,t){return e}async sign(e,s){var n;if(!nr(s))throw new Error("expected sequence signature request metadata");const r=s.guardTotpCode,i=ar(s.config.version),{encoded:o}=i.signature.encodeSigners(s.config,null!=(n=s.parts)?n:new Map,[],s.chainId);return(await this.guard.signWith({signer:this.address,request:{msg:t.ethers.hexlify(e),auxData:this.packMsgAndSig(s.address,s.digest,o,s.chainId),chainId:Number(s.chainId)},token:r?{id:Yc.TOTP,token:r}:void 0})).sig}notifyStatusChange(e,t,s){}async getAuthMethods(e){let t;if("jwt"in e)t=await this.guard.authMethods({},{Authorization:`BEARER ${e.jwt}`});else{const s=await Zc(e);t=await this.guard.authMethods({proof:{wallet:s.walletAddress,timestamp:s.timestamp.getTime(),signer:s.signerAddress,signature:s.signature}})}return o({},t,{methods:t.methods.map(Qc)})}async setPin(e,t){const s=await eh(t);void 0===e?await this.guard.resetPIN({timestamp:s.timestamp.getTime(),signature:s.signature},{Authorization:`BEARER ${t.jwt}`}):await this.guard.setPIN({pin:e,timestamp:s.timestamp.getTime(),signature:s.signature},{Authorization:`BEARER ${t.jwt}`})}resetPin(e){return this.setPin(void 0,e)}async createTotp(e){const t=await eh(e),{uri:s}=await this.guard.createTOTP({timestamp:t.timestamp.getTime(),signature:t.signature},{Authorization:`BEARER ${e.jwt}`});return new URL(s)}async commitTotp(e,t){const{codes:s}=await this.guard.commitTOTP({token:e},{Authorization:`BEARER ${t}`});return s}async resetTotp(e){const t=await eh(e);await this.guard.resetTOTP({timestamp:t.timestamp.getTime(),signature:t.signature},{Authorization:`BEARER ${e.jwt}`})}async reset2fa(e,t){if("jwt"in t)await this.guard.reset2FA({code:e},{Authorization:`BEARER ${t.jwt}`});else{const s=await Zc(t);await this.guard.reset2FA({code:e,proof:{wallet:s.walletAddress,timestamp:s.timestamp.getTime(),signer:s.signerAddress,signature:s.signature}})}}async getRecoveryCodes(e){const t=await eh(e),{codes:s}=await this.guard.recoveryCodes({timestamp:t.timestamp.getTime(),signature:t.signature},{Authorization:`BEARER ${e.jwt}`});return s}async resetRecoveryCodes(e){const t=await eh(e),{codes:s}=await this.guard.resetRecoveryCodes({timestamp:t.timestamp.getTime(),signature:t.signature},{Authorization:`BEARER ${e.jwt}`});return s}packMsgAndSig(e,s,n,r){return t.ethers.AbiCoder.defaultAbiCoder().encode(["address","uint256","bytes","bytes"],[e,r,s,n])}suffix(){return new Uint8Array(this.appendSuffix?[3]:[])}},AuthMethod:Yc,isSignedOwnershipProof:Xc,signOwnershipProof:Zc,getOwnershipProofTypedData:th,getAuthUpdateProofTypedData:sh}),oh=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"cae735346d8e5c3dce48dce9f85116989b6beffd",ContractType:vi,EventLogType:Ei,EventLogDataType:Ii,OrderStatus:Ti,TxnTransferType:Si,TransactionStatus:Oi,TransactionType:ki,SortOrder:Ci,ContractVerificationStatus:_i,Indexer:Ai,WebrpcError:Ri,WebrpcEndpointError:Mi,WebrpcRequestFailedError:Li,WebrpcBadRouteError:Bi,WebrpcBadMethodError:$i,WebrpcBadRequestError:Di,WebrpcBadResponseError:Wi,WebrpcServerPanicError:ji,WebrpcInternalErrorError:Ui,WebrpcClientDisconnectedError:Hi,WebrpcStreamLostError:qi,WebrpcStreamFinishedError:Fi,UnauthorizedError:Gi,PermissionDeniedError:Vi,SessionExpiredError:Ki,MethodNotFoundError:zi,RequestConflictError:Ji,AbortedError:Yi,TimeoutError:Qi,InvalidArgumentError:Xi,UnavailableError:Zi,QueryFailedError:eo,ResourceExhaustedError:to,NotFoundError:so,ProjectNotFoundError:no,MetadataCallFailedError:ro,errors:io,SequenceIndexer:co}),ah=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"9d0976f6ff345b6a688b69cff647454e7fd0e3a6",ContractType:ho,PropertyType:lo,SwapType:uo,TaskStatus:fo,Metadata:po,Collections:go,Admin:class{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Admin/",this.addContractsToTokenDirectory=(e,t,s)=>this.fetch(this.url("AddContractsToTokenDirectory"),mo(e,t,s)).then((e=>wo(e).then((e=>({ok:e.ok})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.removeContractsFromTokenDirectory=(e,t,s)=>this.fetch(this.url("RemoveContractsFromTokenDirectory"),mo(e,t,s)).then((e=>wo(e).then((e=>({ok:e.ok})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.modifyFeatureIndex=(e,t,s)=>this.fetch(this.url("ModifyFeatureIndex"),mo(e,t,s)).then((e=>wo(e).then((e=>({ok:e.ok})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.getFeatureIndex=(e,t,s)=>this.fetch(this.url("GetFeatureIndex"),mo(e,t,s)).then((e=>wo(e).then((e=>({featured:e.featured})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.listTokenDirectory=(e,t,s)=>this.fetch(this.url("ListTokenDirectory"),mo(e,t,s)).then((e=>wo(e).then((e=>({page:e.page,collections:e.collections})))),(e=>{throw vo.new({cause:`fetch(): ${e.message||""}`})})),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}},WebrpcError:yo,WebrpcEndpointError:bo,WebrpcRequestFailedError:vo,WebrpcBadRouteError:Eo,WebrpcBadMethodError:Io,WebrpcBadRequestError:To,WebrpcBadResponseError:So,WebrpcServerPanicError:Oo,WebrpcInternalErrorError:ko,WebrpcClientDisconnectedError:Co,WebrpcStreamLostError:_o,WebrpcStreamFinishedError:Ao,UnauthorizedError:xo,PermissionDeniedError:Po,SessionExpiredError:No,MethodNotFoundError:Ro,RequestConflictError:Mo,FailError:Lo,GeoblockedError:Bo,TimeoutError:$o,InvalidArgumentError:Do,RequiredArgumentError:Wo,QueryFailedError:jo,ValidationFailedError:Uo,RateLimitedError:Ho,NotFoundError:qo,ProjectNotFoundError:Fo,ChainNotFoundError:Go,TokenDirectoryDisabledError:Vo,errors:Ko,SequenceMetadata:Yo,SequenceCollections:class extends go{constructor(e="https://metadata.sequence.app",t){super(e.endsWith("/")?e.slice(0,-1):e,Jo),this.jwtAuth=t,this._fetch=(e,t)=>{const s={},n=this.jwtAuth;return n&&n.length>0&&(s.Authorization=`BEARER ${n}`),t.headers=o({},t.headers,s),Jo(e,t)},this.fetch=this._fetch}}}),ch=Object.freeze({__proto__:null,ChainId:ke,NetworkType:Ce,networks:_e,indexerURL:lt,relayerURL:dt,nodesURL:ut,findSupportedNetwork:ft,toChainIdNumber:pt,hardhatNetworks:mt,allNetworks:wt,JsonRpcRouter:yt,createJsonRpcMiddlewareStack:bt,JsonRpcHandler:It,AllowProvider:class{constructor(e){this.requestHandler=void 0,this.isAllowedFunc=void 0,this.isAllowedFunc=e||(e=>!0),this.requestHandler=Tt(this.isAllowedFunc)}setIsAllowedFunc(e){this.isAllowedFunc=e,this.requestHandler=Tt(this.isAllowedFunc)}},allowProviderMiddleware:Tt,CachedProvider:St,EagerProvider:Ot,exceptionProviderMiddleware:kt,loggingProviderMiddleware:Ct,networkProviderMiddleware:e=>s=>async n=>{const r=e(n);switch(n.method){case"net_version":return`${r}`;case"eth_chainId":return t.ethers.toQuantity(r)}return s(n)},PublicProvider:class{constructor(e){this.privateJsonRpcMethods=["net_version","eth_chainId","eth_accounts",..._t],this.provider=void 0,this.rpcUrl=void 0,this.requestHandler=e=>t=>this.provider&&!this.privateJsonRpcMethods.includes(t.method)?this.provider.send(t.method,t.params||[]):(Xe.debug("[public-provider] sending request to signer window",t.method),e(t)),e&&this.setRpcUrl(e)}getRpcUrl(){return this.rpcUrl}setRpcUrl(e){e&&""!==e?(this.rpcUrl=e,this.provider=new t.ethers.JsonRpcProvider(e)):(this.rpcUrl=void 0,this.provider=void 0)}},SigningProvider:class{constructor(e){this.provider=void 0,this.requestHandler=e=>t=>_t.includes(t.method)?this.provider.request(t):e(t),this.provider=e}},SingleflightMiddleware:At,isJsonRpcProvider:vt,isJsonRpcSender:Et,JsonRpcProvider:Bt,isNetworkConfig:function(e){return e&&void 0!==e.chainId&&void 0!==e.name&&void 0!==e.rpcUrl&&void 0!==e.relayer},getChainId:Ae,maybeChainId:e=>{if(e)return Ae(e)},isValidNetworkConfig:xe,ensureValidNetworks:Pe,ensureUniqueNetworks:(e,t=!0)=>{const s=e.map((e=>e.chainId)).sort(),n=s.filter(((e,t)=>s.indexOf(e)!==t));if(n.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${n}`);return!1}return!0},updateNetworkConfig:(e,t)=>{if(e&&t){if(!e.chainId&&!e.name)throw new Error("failed to update network config: source config is missing chainId or name");if(e.chainId!==t.chainId&&e.name!==t.name)throw new Error("failed to update network config: one of chainId or name must match");e.rpcUrl&&(t.rpcUrl=e.rpcUrl,t.provider=void 0),e.provider&&(t.provider=e.provider),e.relayer&&(t.relayer=e.relayer)}},validateAndSortNetworks:Ne,findNetworkConfig:Re,checkNetworkConfig:(e,t)=>!!e&&(e.name===t||e.chainId===t),networksIndex:e=>{const t={};for(let s=0;s<e.length;s++)t[e[s].name]=e[s];return t},sortNetworks:Me,stringTemplate:Le});const hh=new Map(["addHook(bytes4,address)","clearExtraImageHashes(bytes32[])","removeHook(bytes4)","setExtraImageHash(bytes32,uint256)","updateIPFSRoot(bytes32)","updateImageHash(bytes32)","updateImageHashAndIPFS(bytes32,bytes32)","updateImplementation(address)"].map((e=>[t.ethers.id(e).slice(0,10),e])));function lh(e,s){const n=Hn(e,s);zn(e,n).forEach((s=>function(e,s){if(s.to.toLowerCase()===e.toLowerCase()&&s.data){const e=t.ethers.getBytes(s.data);if(e.length>=4&&!function(e){const s=new t.ethers.Interface(r.mainModule.abi);try{return s.decodeFunctionData("createContract",e),!0}catch(e){return!1}}(e))throw new Error("self calls are forbidden")}if(s.delegateCall)throw new Error("delegate calls are forbidden");if(s.data){const e=t.ethers.hexlify(s.data).slice(0,10),n=hh.get(e);if(n){const e=n.slice(0,n.indexOf("("));throw new Error(`${e} calls are forbidden`)}}}(e,s)))}var dh=function(e,t,s){return e(s={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&s.path)}},s.exports),s.exports}((function(e,t){!function(t){var s=Object.hasOwnProperty,n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},r="object"==typeof process&&"function"==typeof process.nextTick,i="function"==typeof Symbol,o="object"==typeof Reflect,a="function"==typeof setImmediate?setImmediate:setTimeout,c=i?o&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function h(){this._events={},this._conf&&l.call(this,this._conf)}function l(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==t&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function d(e,t){var s="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(s+=" Event name: "+t+"."),"undefined"!=typeof process&&process.emitWarning){var n=new Error(s);n.name="MaxListenersExceededWarning",n.emitter=this,n.count=e,process.emitWarning(n)}else console.error(s),console.trace&&console.trace()}var u=function(e,t,s){var n=arguments.length;switch(n){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,s];default:for(var r=new Array(n);n--;)r[n]=arguments[n];return r}};function f(e,s){for(var n={},r=e.length,i=s?s.length:0,o=0;o<r;o++)n[e[o]]=o<i?s[o]:t;return n}function p(e,t,s){var n,r;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(s.on||s.off)&&(n=s.on,r=s.off),t.addEventListener?(n=t.addEventListener,r=t.removeEventListener):t.addListener?(n=t.addListener,r=t.removeListener):t.on&&(n=t.on,r=t.off),!n&&!r)throw Error("target does not implement any known event API");if("function"!=typeof n)throw TypeError("on method must be a function");if("function"!=typeof r)throw TypeError("off method must be a function");this._on=n,this._off=r;var i=e._observers;i?i.push(this):e._observers=[this]}function g(e,n,r,i){var o=Object.assign({},n);if(!e)return o;if("object"!=typeof e)throw TypeError("options must be an object");var a,c,h,l=Object.keys(e),d=l.length;function u(e){throw Error('Invalid "'+a+'" option value'+(e?". Reason: "+e:""))}for(var f=0;f<d;f++){if(a=l[f],!i&&!s.call(n,a))throw Error('Unknown "'+a+'" option');(c=e[a])!==t&&(h=r[a],o[a]=h?h(c,u):c)}return o}function m(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function w(e){var t="value must be type of "+e.join("|"),s=e.length,n=e[0],r=e[1];return 1===s?function(e,s){if(typeof e===n)return e;s(t)}:2===s?function(e,s){var i=typeof e;if(i===n||i===r)return e;s(t)}:function(n,r){for(var i=typeof n,o=s;o-- >0;)if(i===e[o])return n;r(t)}}Object.assign(p.prototype,{subscribe:function(e,t,s){var n=this,r=this._target,i=this._emitter,o=this._listeners,a=function(){var n=u.apply(null,arguments),o={data:n,name:t,original:e};s?!1!==s.call(r,o)&&i.emit.apply(i,[o.name].concat(n)):i.emit.apply(i,[t].concat(n))};if(o[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,i._newListener&&i._removeListener&&!n._onNewListener?(this._onNewListener=function(s){s===t&&null===o[e]&&(o[e]=a,n._on.call(r,e,a))},i.on("newListener",this._onNewListener),this._onRemoveListener=function(s){s===t&&!i.hasListeners(s)&&o[e]&&(o[e]=null,n._off.call(r,e,a))},o[e]=null,i.on("removeListener",this._onRemoveListener)):(o[e]=a,n._on.call(r,e,a))},unsubscribe:function(e){var t,s,n,r=this,i=this._listeners,o=this._emitter,a=this._off,h=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function l(){r._onNewListener&&(o.off("newListener",r._onNewListener),o.off("removeListener",r._onRemoveListener),r._onNewListener=null,r._onRemoveListener=null);var e=E.call(o,r);o._observers.splice(e,1)}if(e){if(!(t=i[e]))return;a.call(h,e,t),delete i[e],--this._listenersCount||l()}else{for(n=(s=c(i)).length;n-- >0;)e=s[n],a.call(h,e,i[e]);this._listeners={},this._listenersCount=0,l()}}});var y=w(["function"]),b=w(["object","function"]);function v(e,t,s){var n,r,i,o=0,a=new e((function(c,h,l){function d(){r&&(r=null),o&&(clearTimeout(o),o=0)}s=g(s,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),n=!s.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof l;var u=function(e){d(),c(e)},f=function(e){d(),h(e)};n?t(u,f,l):(r=[function(e){f(e||Error("canceled"))}],t(u,f,(function(e){if(i)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");r.push(e)})),i=!0),s.timeout>0&&(o=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",o=0,a.cancel(e),h(e)}),s.timeout))}));return n||(a.cancel=function(e){if(r){for(var t=r.length,s=1;s<t;s++)r[s](e);r[0](e),r=null}}),a}function E(e){var t=this._observers;if(!t)return-1;for(var s=t.length,n=0;n<s;n++)if(t[n]._target===e)return n;return-1}function I(e,t,s,n,r){if(!s)return null;if(0===n){var i=typeof t;if("string"===i){var o,a,h=0,l=0,d=this.delimiter,u=d.length;if(-1!==(a=t.indexOf(d))){o=new Array(5);do{o[h++]=t.slice(l,a),l=a+u}while(-1!==(a=t.indexOf(d,l)));o[h++]=t.slice(l),t=o,r=h}else t=[t],r=1}else"object"===i?r=t.length:(t=[t],r=1)}var f,p,g,m,w,y,b,v=null,E=t[n],T=t[n+1];if(n===r)s._listeners&&("function"==typeof s._listeners?(e&&e.push(s._listeners),v=[s]):(e&&e.push.apply(e,s._listeners),v=[s]));else{if("*"===E){for(a=(y=c(s)).length;a-- >0;)"_listeners"!==(f=y[a])&&(b=I(e,t,s[f],n+1,r))&&(v?v.push.apply(v,b):v=b);return v}if("**"===E){for((w=n+1===r||n+2===r&&"*"===T)&&s._listeners&&(v=I(e,t,s,r,r)),a=(y=c(s)).length;a-- >0;)"_listeners"!==(f=y[a])&&("*"===f||"**"===f?(s[f]._listeners&&!w&&(b=I(e,t,s[f],r,r))&&(v?v.push.apply(v,b):v=b),b=I(e,t,s[f],n,r)):b=I(e,t,s[f],f===T?n+2:n,r),b&&(v?v.push.apply(v,b):v=b));return v}s[E]&&(v=I(e,t,s[E],n+1,r))}if((p=s["*"])&&I(e,t,p,n+1,r),g=s["**"])if(n<r)for(g._listeners&&I(e,t,g,r,r),a=(y=c(g)).length;a-- >0;)"_listeners"!==(f=y[a])&&(f===T?I(e,t,g[f],n+2,r):f===E?I(e,t,g[f],n+1,r):((m={})[f]=g[f],I(e,t,{"**":m},n+1,r)));else g._listeners?I(e,t,g,r,r):g["*"]&&g["*"]._listeners&&I(e,t,g["*"],r,r);return v}function T(e,t,s){var n,r,i=0,o=0,a=this.delimiter,c=a.length;if("string"==typeof e)if(-1!==(n=e.indexOf(a))){r=new Array(5);do{r[i++]=e.slice(o,n),o=n+c}while(-1!==(n=e.indexOf(a,o)));r[i++]=e.slice(o)}else r=[e],i=1;else r=e,i=e.length;if(i>1)for(n=0;n+1<i;n++)if("**"===r[n]&&"**"===r[n+1])return;var h,l=this.listenerTree;for(n=0;n<i;n++)if(l=l[h=r[n]]||(l[h]={}),n===i-1)return l._listeners?("function"==typeof l._listeners&&(l._listeners=[l._listeners]),s?l._listeners.unshift(t):l._listeners.push(t),!l._listeners.warned&&this._maxListeners>0&&l._listeners.length>this._maxListeners&&(l._listeners.warned=!0,d.call(this,l._listeners.length,h))):l._listeners=t,!0;return!0}function S(e,t,s,n){for(var r,i,o,a,h=c(e),l=h.length,d=e._listeners;l-- >0;)r=e[i=h[l]],o="_listeners"===i?s:s?s.concat(i):[i],a=n||"symbol"==typeof i,d&&t.push(a?o:o.join(this.delimiter)),"object"==typeof r&&S.call(this,r,t,o,a);return t}function O(e){for(var t,s,n,r=c(e),i=r.length;i-- >0;)(t=e[s=r[i]])&&(n=!0,"_listeners"===s||O(t)||delete e[s]);return n}function k(e,t,s){this.emitter=e,this.event=t,this.listener=s}function C(e,s,n){if(!0===n)o=!0;else if(!1===n)i=!0;else{if(!n||"object"!=typeof n)throw TypeError("options should be an object or true");var i=n.async,o=n.promisify,c=n.nextTick,h=n.objectify}if(i||c||o){var l=s,d=s._origin||s;if(c&&!r)throw Error("process.nextTick is not supported");o===t&&(o="AsyncFunction"===s.constructor.name),s=function(){var e=arguments,t=this,s=this.event;return o?c?Promise.resolve():new Promise((function(e){a(e)})).then((function(){return t.event=s,l.apply(t,e)})):(c?process.nextTick:a)((function(){t.event=s,l.apply(t,e)}))},s._async=!0,s._origin=d}return[s,h?new k(this,e,s):this]}function _(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,l.call(this,e)}k.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},_.EventEmitter2=_,_.prototype.listenTo=function(e,s,r){if("object"!=typeof e)throw TypeError("target musts be an object");var i=this;function o(t){if("object"!=typeof t)throw TypeError("events must be an object");var s,n=r.reducers,o=E.call(i,e);s=-1===o?new p(i,e,r):i._observers[o];for(var a,h=c(t),l=h.length,d="function"==typeof n,u=0;u<l;u++)a=h[u],s.subscribe(a,t[a]||a,d?n:n&&n[a])}return r=g(r,{on:t,off:t,reducers:t},{on:y,off:y,reducers:b}),n(s)?o(f(s)):o("string"==typeof s?f(s.split(/\s+/)):s),this},_.prototype.stopListeningTo=function(e,t){var s=this._observers;if(!s)return!1;var n,r=s.length,i=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;r-- >0;)n=s[r],e&&n._target!==e||(n.unsubscribe(t),i=!0);return i},_.prototype.delimiter=".",_.prototype.setMaxListeners=function(e){e!==t&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},_.prototype.getMaxListeners=function(){return this._maxListeners},_.prototype.event="",_.prototype.once=function(e,t,s){return this._once(e,t,!1,s)},_.prototype.prependOnceListener=function(e,t,s){return this._once(e,t,!0,s)},_.prototype._once=function(e,t,s,n){return this._many(e,1,t,s,n)},_.prototype.many=function(e,t,s,n){return this._many(e,t,s,!1,n)},_.prototype.prependMany=function(e,t,s,n){return this._many(e,t,s,!0,n)},_.prototype._many=function(e,t,s,n,r){var i=this;if("function"!=typeof s)throw new Error("many only accepts instances of Function");function o(){return 0==--t&&i.off(e,o),s.apply(this,arguments)}return o._origin=s,this._on(e,o,n,r)},_.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,s,n,r,o,a=arguments[0],c=this.wildcard;if("newListener"===a&&!this._newListener&&!this._events.newListener)return!1;if(c&&(e=a,"newListener"!==a&&"removeListener"!==a&&"object"==typeof a)){if(s=a.length,i)for(n=0;n<s;n++)if("symbol"==typeof a[n]){o=!0;break}o||(a=a.join(this.delimiter))}var l,d=arguments.length;if(this._all&&this._all.length)for(n=0,s=(l=this._all.slice()).length;n<s;n++)switch(this.event=a,d){case 1:l[n].call(this,a);break;case 2:l[n].call(this,a,arguments[1]);break;case 3:l[n].call(this,a,arguments[1],arguments[2]);break;default:l[n].apply(this,arguments)}if(c)l=[],I.call(this,l,e,this.listenerTree,0,s);else{if("function"==typeof(l=this._events[a])){switch(this.event=a,d){case 1:l.call(this);break;case 2:l.call(this,arguments[1]);break;case 3:l.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(d-1),r=1;r<d;r++)t[r-1]=arguments[r];l.apply(this,t)}return!0}l&&(l=l.slice())}if(l&&l.length){if(d>3)for(t=new Array(d-1),r=1;r<d;r++)t[r-1]=arguments[r];for(n=0,s=l.length;n<s;n++)switch(this.event=a,d){case 1:l[n].call(this);break;case 2:l[n].call(this,arguments[1]);break;case 3:l[n].call(this,arguments[1],arguments[2]);break;default:l[n].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===a)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},_.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,s,n,r,o,a=arguments[0],c=this.wildcard;if("newListener"===a&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(c&&(e=a,"newListener"!==a&&"removeListener"!==a&&"object"==typeof a)){if(n=a.length,i)for(r=0;r<n;r++)if("symbol"==typeof a[r]){t=!0;break}t||(a=a.join(this.delimiter))}var l,d=[],u=arguments.length;if(this._all)for(r=0,n=this._all.length;r<n;r++)switch(this.event=a,u){case 1:d.push(this._all[r].call(this,a));break;case 2:d.push(this._all[r].call(this,a,arguments[1]));break;case 3:d.push(this._all[r].call(this,a,arguments[1],arguments[2]));break;default:d.push(this._all[r].apply(this,arguments))}if(c?(l=[],I.call(this,l,e,this.listenerTree,0)):l=this._events[a],"function"==typeof l)switch(this.event=a,u){case 1:d.push(l.call(this));break;case 2:d.push(l.call(this,arguments[1]));break;case 3:d.push(l.call(this,arguments[1],arguments[2]));break;default:for(s=new Array(u-1),o=1;o<u;o++)s[o-1]=arguments[o];d.push(l.apply(this,s))}else if(l&&l.length){if(l=l.slice(),u>3)for(s=new Array(u-1),o=1;o<u;o++)s[o-1]=arguments[o];for(r=0,n=l.length;r<n;r++)switch(this.event=a,u){case 1:d.push(l[r].call(this));break;case 2:d.push(l[r].call(this,arguments[1]));break;case 3:d.push(l[r].call(this,arguments[1],arguments[2]));break;default:d.push(l[r].apply(this,s))}}else if(!this.ignoreErrors&&!this._all&&"error"===a)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(d)},_.prototype.on=function(e,t,s){return this._on(e,t,!1,s)},_.prototype.prependListener=function(e,t,s){return this._on(e,t,!0,s)},_.prototype.onAny=function(e){return this._onAny(e,!1)},_.prototype.prependAny=function(e){return this._onAny(e,!0)},_.prototype.addListener=_.prototype.on,_.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},_.prototype._on=function(e,s,n,r){if("function"==typeof e)return this._onAny(e,s),this;if("function"!=typeof s)throw new Error("on only accepts instances of Function");this._events||h.call(this);var i,o=this;return r!==t&&(s=(i=C.call(this,e,s,r))[0],o=i[1]),this._newListener&&this.emit("newListener",e,s),this.wildcard?(T.call(this,e,s,n),o):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(s):this._events[e].push(s),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,d.call(this,this._events[e].length,e))):this._events[e]=s,o)},_.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var s,r=[];if(this.wildcard){var i="string"==typeof e?e.split(this.delimiter):e.slice();if(!(r=I.call(this,null,i,this.listenerTree,0)))return this}else{if(!this._events[e])return this;s=this._events[e],r.push({_listeners:s})}for(var o=0;o<r.length;o++){var a=r[o];if(s=a._listeners,n(s)){for(var c=-1,h=0,l=s.length;h<l;h++)if(s[h]===t||s[h].listener&&s[h].listener===t||s[h]._origin&&s[h]._origin===t){c=h;break}if(c<0)continue;return this.wildcard?a._listeners.splice(c,1):this._events[e].splice(c,1),0===s.length&&(this.wildcard?delete a._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(s===t||s.listener&&s.listener===t||s._origin&&s._origin===t)&&(this.wildcard?delete a._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&O(this.listenerTree),this},_.prototype.offAny=function(e){var t,s=0,n=0;if(e&&this._all&&this._all.length>0){for(s=0,n=(t=this._all).length;s<n;s++)if(e===t[s])return t.splice(s,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(s=0,n=t.length;s<n;s++)this.emit("removeListenerAny",t[s]);this._all=[]}return this},_.prototype.removeListener=_.prototype.off,_.prototype.removeAllListeners=function(e){if(e===t)return!this._events||h.call(this),this;if(this.wildcard){var s,n=I.call(this,null,e,this.listenerTree,0);if(!n)return this;for(s=0;s<n.length;s++)n[s]._listeners=null;this.listenerTree&&O(this.listenerTree)}else this._events&&(this._events[e]=null);return this},_.prototype.listeners=function(e){var s,n,r,i,o,a=this._events;if(e===t){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!a)return[];for(i=(s=c(a)).length,r=[];i-- >0;)"function"==typeof(n=a[s[i]])?r.push(n):r.push.apply(r,n);return r}if(this.wildcard){if(!(o=this.listenerTree))return[];var h=[],l="string"==typeof e?e.split(this.delimiter):e.slice();return I.call(this,h,l,o,0),h}return a&&(n=a[e])?"function"==typeof n?[n]:n:[]},_.prototype.eventNames=function(e){var t=this._events;return this.wildcard?S.call(this,this.listenerTree,[],null,e):t?c(t):[]},_.prototype.listenerCount=function(e){return this.listeners(e).length},_.prototype.hasListeners=function(e){if(this.wildcard){var s=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return I.call(this,s,n,this.listenerTree,0),s.length>0}var r=this._events,i=this._all;return!!(i&&i.length||r&&(e===t?c(r).length:r[e]))},_.prototype.listenersAny=function(){return this._all?this._all:[]},_.prototype.waitFor=function(e,s){var n=this,r=typeof s;return"number"===r?s={timeout:s}:"function"===r&&(s={filter:s}),v((s=g(s,{timeout:0,filter:t,handleError:!1,Promise:Promise,overload:!1},{filter:y,Promise:m})).Promise,(function(t,r,i){function o(){var i=s.filter;if(!i||i.apply(n,arguments))if(n.off(e,o),s.handleError){var a=arguments[0];a?r(a):t(u.apply(null,arguments).slice(1))}else t(u.apply(null,arguments))}i((function(){n.off(e,o)})),n._on(e,o,!1)}),{timeout:s.timeout,overload:s.overload})};var A=_.prototype;Object.defineProperties(_,{defaultMaxListeners:{get:function(){return A._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");A._maxListeners=e},enumerable:!0},once:{value:function(e,t,s){return v((s=g(s,{Promise:Promise,timeout:0,overload:!1},{Promise:m})).Promise,(function(s,n,r){var i;if("function"==typeof e.addEventListener)return i=function(){s(u.apply(null,arguments))},r((function(){e.removeEventListener(t,i)})),void e.addEventListener(t,i,{once:!0});var o,a=function(){o&&e.removeListener("error",o),s(u.apply(null,arguments))};"error"!==t&&(o=function(s){e.removeListener(t,a),n(s)},e.once("error",o)),r((function(){o&&e.removeListener("error",o),e.removeListener(t,a)})),e.once(t,a)}),{timeout:s.timeout,overload:s.overload})},writable:!0,configurable:!0}}),Object.defineProperties(A,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),e.exports=_}()}));function uh(e){return e&&"object"==typeof e&&"function"==typeof e.register&&"function"==typeof e.unregister&&"function"==typeof e.openWallet&&"function"==typeof e.closeWallet&&"function"==typeof e.isOpened&&"function"==typeof e.isConnected&&"function"==typeof e.on}class fh extends URLSearchParams{static new(e){return new URLSearchParams(e)}}let ph=function(e){return e.OPEN="open",e.CLOSE="close",e.MESSAGE="message",e.CONNECT="connect",e.DISCONNECT="disconnect",e.ACCOUNTS_CHANGED="accountsChanged",e.CHAIN_CHANGED="chainChanged",e.NETWORKS="networks",e.WALLET_CONTEXT="walletContext",e.INIT="init",e.DEBUG="_debug",e}({}),gh=function(e){return e[e.CLOSED=0]="CLOSED",e[e.OPENING=1]="OPENING",e[e.OPENED=2]="OPENED",e}({}),mh=function(e){return e[e.NIL=0]="NIL",e[e.SENT_NONCE=1]="SENT_NONCE",e[e.OK=2]="OK",e}({});class wh extends Error{constructor(e){super(e),this.name="ProviderError"}}const yh=new wh("Wallet is not signed in. Connect a wallet and try again."),bh=3e4;let vh=0;const Eh=()=>++vh;class Ih{constructor(){var e=this;this.pendingMessageRequests=[],this.responseCallbacks=new Map,this.state=void 0,this.confirmationOnly=!1,this.events=new dh.EventEmitter2,this.openPayload=void 0,this.connectPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this._sessionId=void 0,this._init=void 0,this._registered=void 0,this.sendMessageRequest=async function(t){return new Promise(((s,n)=>{(!t.idx||t.idx<=0)&&"init"!==t.type&&n(new Error("message idx not set"));const r=(e,t)=>{if(e)n(e);else{if(!t)throw new Error("no valid response to return");s(t)}},i=t.idx;e.responseCallbacks.get(i)?n(new Error("duplicate message idx, should never happen")):e.responseCallbacks.set(i,r),e.isOpened()?e.sendMessage(t):(Xe.debug("pushing to pending requests",t),e.pendingMessageRequests.push(t))}))},this.waitUntilOpened=async function(t=3e4){let s=!1;return Promise.race([new Promise(((n,r)=>{const i=setTimeout((()=>{clearTimeout(i),s||(e.state=gh.CLOSED,e.events.emit("close",{code:1005,message:"opening wallet timed out"})),r(new Error("opening wallet timed out"))}),t)})),new Promise((t=>{var n;if(e.isOpened())return s=!0,void t(null==(n=e.openPayload)?void 0:n.session);e.events.once("open",(n=>{e.openPayload=n,s=!0,t(n.session)}))}))])},this.waitUntilConnected=async function(){await e.waitUntilOpened();const t=new Promise((t=>{e.connectPayload?t(e.connectPayload):e.events.once("connect",(s=>{e.connectPayload=s,t(s)}))})),s=new Promise(((t,s)=>{e.events.once("close",(e=>{s(e?new Error(`wallet closed due to ${JSON.stringify(e)}`):new Error("user closed the wallet"))}))}));return Promise.race([t,s])},this.state=gh.CLOSED,this._registered=!1,this._init=mh.NIL}get registered(){return this._registered}register(){throw new Error("abstract method")}unregister(){throw new Error("abstract method")}openWallet(e,t,s){throw new Error("abstract method")}closeWallet(){throw new Error("abstract method")}isOpened(){return this.registered&&this.state===gh.OPENED}isConnected(){var e;const t=null==(e=this.openPayload)?void 0:e.session;return this.registered&&void 0!==t&&!!t.accountAddress&&42===t.accountAddress.length&&!!t.networks&&t.networks.length>0}async request(e){this.state===gh.CLOSED&&(this.confirmationOnly=!0),this.openWallet(void 0,{type:"jsonRpcRequest",method:e.method},e.chainId),this.isOpened()||await this.waitUntilOpened();return(await this.sendMessageRequest({idx:Eh(),type:ph.MESSAGE,data:e,chainId:e.chainId,clientVersion:hr})).data}handleMessage(e){var s=this;if(e.type===ph.INIT){Xe.debug("MessageProvider, received INIT message",e);const{nonce:t}=e.data;if(!t||0==t.length)return void Xe.error("invalid init nonce");this._init=mh.OK,this.sendMessage({idx:-1,type:ph.INIT,data:{sessionId:this._sessionId,nonce:t},clientVersion:hr})}if(this._init!==mh.OK)return;Xe.debug("RECEIVED MESSAGE FROM WALLET",e.idx,e);const n=e.idx,r=this.responseCallbacks.get(n);if(n&&this.responseCallbacks.delete(n),e.type!==ph.OPEN||this.isOpened()){if(e.type===ph.MESSAGE){if(this.confirmationOnly&&setTimeout((()=>{0===this.responseCallbacks.size&&this.closeWallet()}),500),!r)throw new Error("impossible state");if(r)return this.events.emit("message",e),void r(e.data.error,e)}if(e.type===ph.ACCOUNTS_CHANGED)return this.accountsChangedPayload={accounts:[]},void(e.data&&e.data.length>0?(this.accountsChangedPayload={accounts:[t.ethers.getAddress(e.data[0])],origin:e.origin},this.events.emit("accountsChanged",this.accountsChangedPayload.accounts,this.accountsChangedPayload.origin)):this.events.emit("accountsChanged",[],e.origin));if(e.type!==ph.CHAIN_CHANGED){if(e.type===ph.NETWORKS)return this.networksPayload=e.data,void this.events.emit("networks",this.networksPayload);if(e.type===ph.WALLET_CONTEXT)return this.walletContextPayload=e.data,void this.events.emit("walletContext",this.walletContextPayload);e.type===ph.CLOSE&&this.state!==gh.CLOSED&&this.close(e.data),e.type===ph.CONNECT&&(this.connectPayload=e.data,this.events.emit("connect",this.connectPayload)),e.type===ph.DISCONNECT&&this.isConnected()&&(this.events.emit("disconnect",e.data,e.origin),this.close())}else this.events.emit("chainChanged",e.data,e.origin)}else{var i,o;if(this._sessionId&&this._sessionId!==(null==(i=e.data)?void 0:i.sessionId))return void Xe.debug("open event received from wallet, but does not match sessionId",this._sessionId);if(null!=(o=e.data)&&o.error){var a;const t=new Error(`opening wallet failed: received ${null==(a=e.data)?void 0:a.error}`);throw Xe.error(t),this.close(),t}if(this.state=gh.OPENED,this.openPayload=e.data,this.events.emit("open",this.openPayload),0!==this.pendingMessageRequests.length){this.pendingMessageRequests.splice(0,this.pendingMessageRequests.length).forEach((async function(e){s.sendMessage(e)}))}}}sendMessage(e){throw new Error("abstract method")}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}emit(e,...t){return this.events.emit(e,...t)}close(e){this.state!==gh.CLOSED&&(this.state=gh.CLOSED,this.confirmationOnly=!1,this._sessionId=void 0,Xe.info("closing wallet and flushing!"),this.pendingMessageRequests.length=0,this.responseCallbacks.forEach((e=>{e(o({},new Error("wallet closed"),{code:4001}))})),this.responseCallbacks.clear(),this.connectPayload=void 0,this.openPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this.events.emit("close",e))}}const Th=[{name:"Decentraland Exception",predicate:function(e){try{const s=t.ethers.toUtf8String(e);return Sh.test(s)}catch(e){return!1}}},{name:"0x v3 Exception",predicate:function(e){const s=new t.ethers.Interface(Oh);try{return s.decodeFunctionData("OrderWithHash",e),!0}catch(e){return!1}}}],Sh=/^Decentraland Login\nEphemeral address: 0x[a-fA-F0-9]{40}\nExpiration: (\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)((-(\d{2}):(\d{2})|Z)?)$/;const Oh=[{inputs:[{components:[{internalType:"address",name:"makerAddress",type:"address"},{internalType:"address",name:"takerAddress",type:"address"},{internalType:"address",name:"feeRecipientAddress",type:"address"},{internalType:"address",name:"senderAddress",type:"address"},{internalType:"uint256",name:"makerAssetAmount",type:"uint256"},{internalType:"uint256",name:"takerAssetAmount",type:"uint256"},{internalType:"uint256",name:"makerFee",type:"uint256"},{internalType:"uint256",name:"takerFee",type:"uint256"},{internalType:"uint256",name:"expirationTimeSeconds",type:"uint256"},{internalType:"uint256",name:"salt",type:"uint256"},{internalType:"bytes",name:"makerAssetData",type:"bytes"},{internalType:"bytes",name:"takerAssetData",type:"bytes"},{internalType:"bytes",name:"makerFeeAssetData",type:"bytes"},{internalType:"bytes",name:"takerFeeAssetData",type:"bytes"}],internalType:"struct IEIP1271Data.Order",name:"order",type:"tuple"},{internalType:"bytes32",name:"orderHash",type:"bytes32"}],name:"OrderWithHash",outputs:[],stateMutability:"pure",type:"function"}],kh=t.ethers.toUtf8Bytes("Ethereum Signed Message:\n"),Ch=e=>t.ethers.isBytesLike(e)?t.ethers.getBytes(e):t.ethers.toUtf8Bytes(e),_h=e=>{const s=Ch(e);return function(e){return Th.some((t=>t.predicate(e)))}(s)?s:t.ethers.getBytes(t.ethers.concat([kh,t.ethers.toUtf8Bytes(String(s.length)),s]))},Ah=async(e,t,s,n)=>new tr(n).isValidSignature(e,t,s),xh=async(e,t,s,n)=>{const r=_h(t),i=Ge(r);return Ah(e,i,s,n)},Ph=(e,t,s,n)=>Ah(e,at(t),s,n),Nh=()=>"chrome-extension:"===window.location.protocol||"moz-extension:"===window.location.protocol,Rh=()=>!!navigator.userAgent.match(/UnitySequence/i),Mh=e=>e.onChain.deployed&&e.fullyMigrated;class Lh{constructor(){this.callbacks=[],this.store={}}getItem(e){return this.store[e]||null}setItem(e,t){this.store[e]=t,this.callbacks.filter((t=>t.key===e)).forEach((e=>e.cb(t)))}removeItem(e){delete this.store[e]}onItemChange(e,t){return this.callbacks.push({key:e,cb:t}),()=>{this.callbacks=this.callbacks.filter((e=>e.cb!==t))}}}class Bh{static isAvailable(){return"object"==="object".localStorage}constructor(){if(this.callbacks=[],!Bh.isAvailable())throw new Error("LocalStorage is not available");window.addEventListener("storage",(e=>{const{key:t}=e;this.callbacks.filter((e=>e.key===t)).forEach((e=>e.cb(this.getItem(t))))}))}getItem(e){return window.localStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t),this.callbacks.filter((t=>t.key===e)).forEach((e=>e.cb(t)))}removeItem(e){window.localStorage.removeItem(e),this.callbacks.filter((t=>t.key===e)).forEach((e=>e.cb(null)))}onItemChange(e,t){return this.callbacks.push({key:e,cb:t}),()=>{this.callbacks=this.callbacks.filter((e=>e.cb!==t))}}}function $h(){return Bh.isAvailable()?new Bh:new Lh}async function Dh(e){return Array.isArray(e)?Promise.all(e.map((e=>t.ethers.resolveProperties(e)))):t.ethers.resolveProperties(e)}const Wh="@sequence.transportSession";class jh{constructor(e){var s=this;this.walletRequestHandler=void 0,this._sessionId=void 0,this._registered=void 0,this._init=void 0,this._initNonce=void 0,this._initCallback=void 0,this.appOrigin=void 0,this.handleMessage=async function(e){const t=e;if(s._init===mh.OK)switch(t.type){case ph.OPEN:{if(s._init!==mh.OK)return;const e={sessionId:t.data.sessionId,intent:t.data.intent,networkId:t.data.networkId};return void await s.open(e)}case ph.CLOSE:return s._init,void mh.OK;case ph.MESSAGE:{const e=await s.walletRequestHandler.sendMessageRequest(t);return s.sendMessage(e),void e.data.error}default:Xe.error(`unexpected payload type ${t.type}`)}else if(t.type===ph.INIT){if(!s.isValidInitAck(e))return void(s._initCallback&&s._initCallback("invalid init"));s._initCallback&&s._initCallback()}},this.sendMessageRequest=async function(e){return s.walletRequestHandler.sendMessageRequest(e)},this.open=async function({sessionId:e,intent:t,networkId:n}){let r;e&&(s._sessionId=nt(e),s.saveTransportSession({sessionId:e,intent:t,networkId:n})),s.walletRequestHandler.setOpenIntent(t),await s.init();try{if(n){const e=ft(n);if(!e)throw new Error(`unknown network ${n}`);r=e.chainId}else r=s.walletRequestHandler.defaultChainId()}catch(e){console.error(e)}if(t&&"connect"===t.type&&t.options){const e=t.options,r=e;if(s.appOrigin&&null!=r&&r.origin){if(!Nh()&&r.origin!==s.appOrigin)throw new Error("origin is invalid")}else!s.appOrigin&&null!=r&&r.origin?e.origin=it(r.origin):s.appOrigin&&(e.origin=s.appOrigin);e.app&&(e.app=rt(e.app)),e.networkId?n=e.networkId:n&&(e.networkId=n),s.walletRequestHandler.setConnectOptions(e)}else s.walletRequestHandler.setConnectOptions(void 0);if(await s.walletRequestHandler.getAccount(),!await s.walletRequestHandler.isSignedIn())return s.notifyOpen({sessionId:s._sessionId}),!0;if(t&&"connect"===t.type){(!r||r<=0)&&console.log("Failed to set default network on open"),s.notifyOpen({sessionId:s._sessionId});try{const e=await s.walletRequestHandler.promptConnect(t.options);e.connected&&s.walletRequestHandler.notifyConnect(e)}catch(e){Xe.warn("promptConnect not connected:",e)}finally{t.options&&!0===t.options.keepWalletOpened||s.notifyClose()}}else{if(!r||r<=0)return s.notifyOpen({sessionId:s._sessionId,error:`failed to open wallet on network ${n}`}),!1;s.notifyOpen({sessionId:s._sessionId,chainId:`${r}`,session:await s.walletRequestHandler.walletSession(r)})}return!0},this.saveTransportSession=e=>{$h().setItem(Wh,JSON.stringify(e))},this.getCachedTransportSession=async function(){const e=$h().getItem(Wh);try{return e?JSON.parse(e):null}catch(t){return console.error(`unable to parse transport session: ${e}`),null}},this.walletRequestHandler=e,this._init=mh.NIL,this.walletRequestHandler.on("connect",(e=>{this.registered&&this.notifyConnect(e)})),this.walletRequestHandler.on("disconnect",((e,t)=>{this.registered&&this.notifyDisconnect(e,t)})),this.walletRequestHandler.on("accountsChanged",((e,t)=>{this.registered&&this.notifyAccountsChanged(e,t)})),this.walletRequestHandler.on("networks",(e=>{this.registered&&(this.notifyNetworks(e),e&&0!==e.length?this.notifyChainChanged(t.ethers.toQuantity(e.find((e=>e.isDefaultChain)).chainId)):this.notifyChainChanged("0x0"))})),this.walletRequestHandler.on("chainChanged",((e,t)=>{this.notifyChainChanged(e,t)})),this.walletRequestHandler.on("walletContext",(e=>{this.registered&&e&&this.notifyWalletContext(e)})),this.walletRequestHandler.on("close",(e=>{this.registered&&this.notifyClose(e)}))}get registered(){return this._registered}register(){throw new Error("abstract method")}unregister(){throw new Error("abstract method")}request(e){throw new Error("abstract method")}sendMessage(e){throw new Error("abstract method")}notifyOpen(e){const{chainId:t,sessionId:s,session:n,error:r}=e;this.sendMessage({idx:-1,type:ph.OPEN,data:{chainId:t,sessionId:s,session:n,error:r},clientVersion:hr})}notifyClose(e){this.sendMessage({idx:-1,type:ph.CLOSE,data:e?{error:e}:null,clientVersion:hr})}notifyConnect(e){this.sendMessage({idx:-1,type:ph.CONNECT,data:e,clientVersion:hr})}notifyDisconnect(e,t){this.sendMessage({idx:-1,type:ph.DISCONNECT,data:e?{error:e}:null,origin:t,clientVersion:hr})}notifyAccountsChanged(e,t){this.sendMessage({idx:-1,type:ph.ACCOUNTS_CHANGED,data:e,origin:t,clientVersion:hr})}notifyChainChanged(e,t){this.sendMessage({idx:-1,type:ph.CHAIN_CHANGED,data:e,origin:t,clientVersion:hr})}notifyNetworks(e){this.sendMessage({idx:-1,type:ph.NETWORKS,data:e,clientVersion:hr})}notifyWalletContext(e){this.sendMessage({idx:-1,type:ph.WALLET_CONTEXT,data:e,clientVersion:hr})}isValidInitAck(e){if(this._init===mh.OK)return Xe.warn("isValidInitAck, already in init'd state, so inquiry is invalid."),!1;if(e.type!==ph.INIT)return Xe.warn("isValidInitAck, invalid message type, expecting init"),!1;const{sessionId:t,nonce:s}=e.data;return t&&0!==t.length&&s&&0!==s.length?t===this._sessionId&&s===this._initNonce||(Xe.error("invalid init ack match"),!1):(Xe.error("invalid init ack"),!1)}init(){return new Promise(((e,t)=>{if(this._init===mh.OK)return void e();if(this._init!==mh.NIL||this._initCallback)return void t("transport init is in progress");const s=setTimeout((()=>{Xe.warn("transport init timed out"),this._initCallback&&this._initCallback("transport init timed out")}),15e3);this._initCallback=n=>{this._initCallback=void 0,clearTimeout(s),n?t(n):(this._init=mh.OK,e())},this._initNonce=`${performance.now()}`,this.sendMessage({idx:-1,type:ph.INIT,data:{nonce:this._initNonce},clientVersion:hr}),this._init=mh.SENT_NONCE}))}}class Uh{constructor(){this.conn=void 0,this.events=new dh.EventEmitter2,this.handleMessage=e=>{throw new Error("ProxyMessageChannelPort is not registered")},this.sendMessage=e=>{this.conn.handleMessage(e),"open"===e.type&&this.events.emit("open",e),"close"===e.type&&this.events.emit("close",e),"connect"===e.type&&this.events.emit("connect",e),"disconnect"===e.type&&this.events.emit("disconnect",e)}}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}}class Hh extends Ih{constructor(e){if(super(),this.port=void 0,this.register=()=>{this.port.handleMessage=e=>{this.handleMessage(e)},this.on("open",((...e)=>{this.port.events.emit("open",...e)})),this.on("close",((...e)=>{this.port.events.emit("close",...e)})),this.on("connect",((...e)=>{this.port.events.emit("connect",...e)})),this.on("disconnect",((...e)=>{this.port.events.emit("disconnect",...e)})),this._registered=!0},this.unregister=()=>{this._registered=!1,this.closeWallet(),this.events.removeAllListeners(),this.port.handleMessage=void 0},this.openWallet=(e,t,s)=>{if(this.state===gh.CLOSED){this.state=gh.OPENING;const n=`${performance.now()}`;this._sessionId=n,this.sendMessage({idx:-1,type:ph.OPEN,data:{path:e,intent:t,networkId:s,sessionId:n},clientVersion:hr})}},this.state=gh.CLOSED,this.port=e,!e)throw new Error("port argument cannot be empty");this._init=mh.OK}closeWallet(){this.sendMessage({idx:-1,type:ph.CLOSE,data:null,clientVersion:hr}),this.close()}sendMessage(e){if(!e.idx)throw new Error("message idx is empty");this.port.sendMessage(e)}}function qh(e){var t;if(null!=(t=window.ue)&&t.sequencewallettransport&&!window.logsOverriddenForUnreal){var s;const t=null==(s=window.ue)?void 0:s.sequencewallettransport;console.log=(...s)=>{t.logfromjs(`${e}: ${Fh(s)}`)},console.warn=(...s)=>{t.warnfromjs(`${e}: ${Fh(s)}`)},console.error=(...s)=>{t.errorfromjs(`${e}: ${Fh(s)}`)},window.logsOverriddenForUnreal=!0}}function Fh(e){return e.map((e=>"object"==typeof e?e instanceof Error?e.message:JSON.stringify(e):String(e))).join(" ")}let Gh;class Vh extends Ih{constructor(e){super(),this.walletURL=void 0,this.register=()=>{var e;qh("dapp"),Gh&&(Gh.unregister(),Gh=this),null!=(e=window.ue)&&e.sequencewallettransport&&(window.ue.sequencewallettransport.onmessagefromwallet=this.onUnrealCallback),Gh=this,this._registered=!0,console.log("registering transport!")},this.unregister=()=>{var e;this._registered=!1,this.closeWallet(),Gh===this&&(Gh=void 0),(null==(e=window.ue)||null==(e=e.sequencewallettransport)?void 0:e.onmessagefromwallet)===this.onUnrealCallback&&delete window.ue.sequencewallettransport.onmessagefromwallet,this.events.removeAllListeners()},this.openWallet=(e,t,s)=>{if(this.isOpened())return void console.log("wallet already open!");console.log("opening wallet!");const n=new URL(this.walletURL.href),r=new fh;e&&(n.pathname=e.toLowerCase()),this._init=mh.NIL,this._sessionId=`${performance.now()}`,r.set("sid",this._sessionId),t&&r.set("intent",qe(t)),s&&r.set("net",`${s}`),n.search=r.toString(),console.log("opening wallet to",n.href),window.open(n.href)},this.onUnrealCallback=e=>{if(!e)throw new Error("ProviderMessage object is empty");this.handleMessage(e)},this.walletURL=new URL(e)}closeWallet(){this.close()}sendMessage(e){var t;const s="string"!=typeof e?JSON.stringify(e,Ue):e;console.log("Sending message to wallet:",s),null==(t=window.ue)||null==(t=t.sequencewallettransport)||t.sendmessagetowallet(s)}}const Kh="sequence-extension-message-handler";class zh extends Ih{constructor(e){super(),this.register=()=>{this._registered=!0},e.onConnect.addListener((e=>{e.name===Kh&&(this._init=mh.OK,e.onMessage.addListener((e=>{this.handleMessage(e)})))}))}sendMessage(e){}unregister(){}openWallet(e,t,s){}closeWallet(){}}class Jh extends dh.EventEmitter2{constructor(e){var t;super(),t=this,this.stream=e,this.responseCallbacks=new Map,this._messageIdx=0,this.nextMessageIdx=()=>++this._messageIdx,this.handleMessage=e=>{if(!e.type||!e.data)return;Xe.info("[received message]",e);const t=e.idx,s=this.responseCallbacks.get(t);switch(t&&this.responseCallbacks.delete(t),e.type){case ph.MESSAGE:if(!s)throw new Error("impossible state");this.emit(ph.MESSAGE,e),s(e.data.error,e);break;case ph.DISCONNECT:case ph.ACCOUNTS_CHANGED:case ph.CHAIN_CHANGED:this.emit(e.type,e.data);break;default:console.error("unknown message type",e)}},this.sendMessageRequest=async function(e){return new Promise(((s,n)=>{(!e.idx||e.idx<=0)&&n(new Error("message idx not set"));const r=(e,t)=>{if(e)n(e);else{if(!t)throw new Error("no valid response to return");s(t)}},{idx:i}=e;t.responseCallbacks.get(i)?n(new Error("duplicate message idx, should never happen")):t.responseCallbacks.set(i,r),t.sendMessage(e)}))},this.stream.on("data",this.handleMessage)}sendMessage(e){this.stream.writable||console.error("window post message stream is not writable"),this.stream.write(e)}}let Yh;class Qh extends Ih{constructor(e){super(),this.walletURL=void 0,this.walletWindow=void 0,this.register=()=>{Yh&&(Yh.unregister(),Yh=this),window.addEventListener("message",this.onWindowEvent),Yh=this,this.on("open",(()=>{const e=this.walletWindow,t=setInterval((()=>{e&&e.closed&&(clearInterval(t),this.close())}),500)})),this.on("close",(()=>{this.walletWindow&&(this.walletWindow.close(),this.walletWindow=null)})),this._registered=!0},this.unregister=()=>{this._registered=!1,this.closeWallet(),Yh===this&&(Yh=void 0),window.removeEventListener("message",this.onWindowEvent),this.events.removeAllListeners()},this.openWallet=(e,t,s)=>{if(this.walletWindow&&this.isOpened())return void this.walletWindow.focus();const n=new URL(this.walletURL.href),r=new fh;let i,o;e&&""!==e&&(n.pathname=e.toLowerCase()),this._init=mh.NIL,this._sessionId=`${performance.now()}`,r.set("sid",this._sessionId),t&&("connect"===t.type&&(t.options||(t.options={app:window.location.origin}),Nh()||Rh()||!t.options||(t.options.origin=window.location.origin)),r.set("intent",qe(t))),s&&r.set("net",`${s}`),Nh()?(i=[450,750],o=[Math.abs(window.screen.width/2-i[0]/2),Math.abs(window.screen.height/2-i[1]/2)]):(i=[450,750],o=[Math.abs(window.screenX+window.innerWidth/2-i[0]/2),Math.abs(window.screenY+window.innerHeight/2-i[1]/2)]);const a=`toolbar=0,location=0,menubar=0,scrollbars=yes,status=yes,width=${i[0]},height=${i[1]},left=${o[0]},top=${o[1]}`;n.search=r.toString(),this.walletWindow=window.open(n.href,"sequence.app",a)},this.onWindowEvent=e=>{if(e.origin!==this.walletURL.origin)return;let t;try{t=JSON.parse(e.data,He)}catch(e){return}if(!t)throw new Error("ProviderMessage object is empty");this.handleMessage(t)},this.walletURL=new URL(e)}closeWallet(){var e;this.close(),null==(e=this.walletWindow)||e.close()}sendMessage(e){if(!this.walletWindow)return void Xe.warn("WindowMessageProvider: sendMessage failed as walletWindow is unavailable");const t="string"!=typeof e?JSON.stringify(e,Ue):e;this.walletWindow.postMessage(t,this.walletURL.origin)}}function Xh(e){return e&&"object"==typeof e&&(e.windowTransport&&"object"==typeof e.windowTransport||e.proxyTransport&&"object"==typeof e.proxyTransport||e.extensionTransport&&"object"==typeof e.extensionTransport||e.unrealTransport&&"object"==typeof e.unrealTransport)&&(e.windowTransport&&e.windowTransport.enabled||e.proxyTransport&&e.proxyTransport.enabled||e.extensionTransport&&e.extensionTransport.enabled||e.unrealTransport&&e.unrealTransport.enabled)}class Zh{constructor(...e){var t=this;this.messageProviders=void 0,this.provider=void 0,this.register=()=>{if(1===this.messageProviders.length)return this.provider=this.messageProviders[0],void this.provider.register();this.messageProviders.forEach((e=>{e.register(),e.once("open",(()=>{this.provider||(this.provider=e,this.messageProviders.forEach((e=>{this.provider!==e&&e.unregister()})))}))}))},this.unregister=()=>{this.messageProviders.forEach((e=>e.unregister())),this.provider=void 0},this.openWallet=(e,t,s)=>{this.provider?this.provider.openWallet(e,t,s):this.messageProviders.forEach((n=>n.openWallet(e,t,s)))},this.sendMessageRequest=async function(e){if(t.provider)return t.provider.sendMessageRequest(e);throw new Error("impossible state, wallet must be opened first")},this.waitUntilOpened=async function(){return t.provider?t.provider.waitUntilOpened():Promise.race(t.messageProviders.map((e=>e.waitUntilOpened())))},this.waitUntilConnected=async function(){if(t.provider)return t.provider.waitUntilConnected();throw new Error("impossible state, wallet must be opened first")},this.messageProviders=e,this.provider=void 0}static new(e){var t,s,n,r;const i=new Zh;if(null!=(t=e.windowTransport)&&t.enabled&&e.walletAppURL){const t=new Qh(e.walletAppURL);i.add(t)}if(null!=(s=e.proxyTransport)&&s.enabled){const t=new Hh(e.proxyTransport.appPort);i.add(t)}if(null!=(n=e.extensionTransport)&&n.enabled){const t=new zh(e.extensionTransport.runtime);i.add(t)}if(null!=(r=e.unrealTransport)&&r.enabled&&e.windowTransport&&e.walletAppURL){const t=new Vh(e.walletAppURL);i.add(t)}return i.register(),i}add(...e){this.messageProviders.push(...e)}closeWallet(){this.provider&&this.provider.closeWallet()}isOpened(){return!!this.provider&&this.provider.isOpened()}isConnected(){return!!this.provider&&this.provider.isConnected()}on(e,t){this.provider?this.provider.on(e,t):this.messageProviders.forEach((s=>{s.on(e,t)}))}once(e,t){this.provider?this.provider.once(e,t):this.messageProviders.forEach((s=>{s.once(e,t)}))}emit(e,...t){if(this.provider)return this.provider.emit(e,...t);for(let s=0;s<this.messageProviders.length;s++)this.messageProviders[s].emit(e,...t);return!0}request(e){if(!this.provider)throw new Error("impossible state, wallet must be opened first");return this.provider.request(e)}sendMessage(e){if(!e.idx||e.idx<=0)throw new Error("message idx is empty");if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.sendMessage(e)}handleMessage(e){if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.handleMessage(e)}}function el(e,t){return{context:t.original.context,config:t.onChain.config,address:Sn(t.original.context,t.original.imageHash),chainId:e,deployed:t.onChain.deployed,imageHash:t.imageHash,lastImageHash:t.onChain.imageHash,published:!0,status:t}}const tl=["net_version","eth_chainId","eth_getBalance","eth_getTransactionCount","eth_blockNumber","eth_getBlockByNumber","eth_getBlockByHash","eth_getTransactionByHash","eth_getCode","eth_estimateGas","eth_gasPrice","sequence_getWalletContext","sequence_getNetworks","sequence_setDefaultNetwork"];class sl{get utils(){return this.provider.utils}constructor(e,t){this.client=e,this.provider=t,this.singleNetworkSigners={},this._isSequenceSigner=!0}async getAddress(){return this.client.getAddress()}connect(e){if(!al.is(e))throw new Error("SequenceSigner can only be connected to a SequenceProvider");return new sl(this.client,e)}getSigner(e){if(!e)return this;const t=this.provider.toChainId(e);return this.singleNetworkSigners[t]||(this.singleNetworkSigners[t]=new nl(this.client,this.provider,t)),this.singleNetworkSigners[t]}useChainId(e){return this.provider.toChainId(e)||this.client.getChainId()}async signMessage(e,t){const{eip6492:s=!0}=t||{},n=this.useChainId(null==t?void 0:t.chainId);return this.client.signMessage(e,{eip6492:s,chainId:n})}async signTypedData(e,t,s,n){const{eip6492:r=!0}=n||{},i=this.useChainId(null==n?void 0:n.chainId);return this.client.signTypedData({domain:e,types:t,message:s},{eip6492:r,chainId:i})}getProvider(e){return this.provider.getProvider(e)}async sendTransaction(e,t){const s=this.useChainId(null==t?void 0:t.chainId),n=await Dh(e),r=await this.client.sendTransaction(n,{chainId:s}),i=this.getProvider(s);try{return await new Promise((e=>{!async function t(){const s=await i.getTransaction(r);if(null!==s)return e(s);await i.once("block",t)}()}))}catch(e){throw e.transactionHash=r,e}}async getWalletConfig(e){const t=this.useChainId(e);return this.client.getOnchainWalletConfig({chainId:t})}getNetworks(){return this.client.getNetworks()}async getBalance(e,t){return this.getProvider(null==t?void 0:t.chainId).getBalance(this.getAddress(),e)}async estimateGas(e,t){return this.getProvider(null==t?void 0:t.chainId).estimateGas(e)}async call(e,t){return this.getProvider(null==t?void 0:t.chainId).call(e)}getChainId(){return Promise.resolve(this.client.getChainId())}async getFeeData(e){return this.getProvider(null==e?void 0:e.chainId).getFeeData()}async resolveName(e){const t=await this.provider.resolveName(e);if(null===t)throw new Error(`ENS name not found: ${e}`);return t}_checkProvider(e){}getNonce(e){throw new Error("SequenceSigner does not support getNonce")}populateCall(e){throw new Error("SequenceSigner does not support populateCall")}populateTransaction(e){throw new Error("SequenceSigner does not support populateTransaction")}checkTransaction(e){throw new Error("SequenceSigner does not support checkTransaction")}getTransactionCount(e){throw new Error("SequenceSigner does not support getTransactionCount")}signTransaction(e){throw new Error("SequenceWallet does not support signTransaction, use sendTransaction instead.")}static is(e){return e&&"object"==typeof e&&!0===e._isSequenceSigner}}class nl extends sl{constructor(e,t,s){super(e,t.getProvider(s)),this.chainId=s,this._isSingleNetworkSequenceSigner=!0}_useChainId(e){const t=this.provider.toChainId(e);if(t&&t!==this.chainId)throw new Error(`This signer only supports the network ${this.chainId}, but ${t} was requested.`);return t||this.provider.toChainId(this.chainId)}useChainId(e){return this._useChainId(e)}getChainId(){return Promise.resolve(this.provider.toChainId(this.chainId))}getProvider(e){return super.getProvider(this._useChainId(e))}getSigner(e){if(this._useChainId(e)!==this.chainId)throw new Error("Unreachable code");return this}static is(e){return e&&"object"==typeof e&&!0===e._isSingleNetworkSequenceSigner}}class rl{constructor(e){if(this.signer=e,nl.is(e))throw new Error("WalletUtils does not support SingleNetworkSequenceSigner")}signMessage(e,t,s){return this.signer.signMessage(e,{chainId:t,eip6492:s})}signTypedData(e,t,s,n,r){return this.signer.signTypedData(e,t,s,{chainId:n,eip6492:r})}async isValidSignature(e,t,s,n){return Ah(e,t,s,this.signer.getProvider(n))}async isValidMessageSignature(e,t,s,n){const r=this.signer.getProvider(n),i=_h(t),o=Ge(i);return Ah(e,o,s,r)}isValidTypedDataSignature(e,t,s,n){return this.isValidSignature(e,at(t),s,n)}}const il=["method"],ol=["connect","disconnect","chainChanged","accountsChanged"];class al extends t.ethers.AbstractProvider{constructor(e,t,s=wt,n){super(e.getChainId(),n),this.client=e,this.providerFor=t,this.networks=s,this.options=n,this.singleNetworkProviders={},this._isSequenceProvider=!0,this.utils=void 0,this.signer=void 0,this.eip1193EventListeners=new Map,e.onConnect((e=>{var t;null==(t=this.eip1193EventListeners.get("connect"))||t.forEach((t=>t(e)))})),e.onDisconnect((e=>{var t;null==(t=this.eip1193EventListeners.get("disconnect"))||t.forEach((t=>t(e)))})),e.onDefaultChainIdChanged((e=>{var t;null==(t=this.eip1193EventListeners.get("chainChanged"))||t.forEach((t=>t(e)))})),e.onAccountsChanged((e=>{var t;null==(t=this.eip1193EventListeners.get("accountsChanged"))||t.forEach((t=>t(e)))})),this.signer=new sl(this.client,this),this.utils=new rl(this.signer)}async on(e,t){if(ol.includes(e)){const s=this.eip1193EventListeners.get(e)||new Set;return s.add(t),this.eip1193EventListeners.set(e,s),this}return super.on(e,t)}async off(e,t){if(ol.includes(e)){const s=this.eip1193EventListeners.get(e);return s&&(t?s.delete(t):s.clear()),this}return super.off(e,t)}getSigner(e){return this.signer.getSigner(e)}connect(e){return this.client.connect(e)}disconnect(){return this.client.disconnect()}isConnected(){return this.client.isConnected()}getSession(){return this.client.getSession()}listAccounts(){return[this.client.getAddress()]}getAddress(){return this.client.getAddress()}getNetworks(){return this.client.getNetworks()}getChainId(){return this.client.getChainId()}setDefaultChainId(e){return this.client.setDefaultChainId(this.toChainId(e))}isOpened(){return this.client.isOpened()}closeWallet(){return this.client.closeWallet()}getWalletContext(){return this.client.getWalletContext()}async getWalletConfig(e){const t=await this.useChainId(e);return this.client.getOnchainWalletConfig({chainId:t})}authorize(e){return this.client.connect(o({},e,{authorize:!0}))}async openWallet(e,t){return await this.client.openWallet(e,t),!0}toChainId(e){if(void 0===e)return;const t=Re(this.networks,e);if(!t)throw new Error(`Unsupported network ${e}`);return t.chainId}async useChainId(e){return this.toChainId(e)||this.client.getChainId()}getProvider(e){if(!e)return this;const t=this.toChainId(e);return this.singleNetworkProviders[t]||(this.singleNetworkProviders[t]=new hl(this.client,this.providerFor,t,this.options)),this.singleNetworkProviders[t]}async _getSubprovider(e){const t=await this.useChainId(e),s=this.providerFor(t);if(!s)throw new Error(`Unsupported network ${t}`);return s}async _perform(e){var t;const{method:s}=e,n=function(e,t){if(null==e)return{};var s={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.includes(n))continue;s[n]=e[n]}return s}(e,il),r=await this._getSubprovider(),i=null!=(t=r.getRpcRequest(e))?t:{method:s,args:Object.values(n)};if(!i)throw new Error(`Unsupported method ${e.method}`);return r.send(i.method,i.args)}async perform(e,s){if("eth_chainId"===e)return t.ethers.toQuantity(await this.useChainId());if("eth_accounts"===e)return[this.client.getAddress()];if("wallet_switchEthereumChain"===e){const e=cl(s[0]);return this.setDefaultChainId(e)}return"eth_sendTransaction"===e||"eth_sign"===e||"eth_signTypedData"===e||"eth_signTypedData_v4"===e||"personal_sign"===e||"sequence_sign"===e||"sequence_signTypedData_v4"===e?this.client.request({method:e,params:s,chainId:this.getChainId()}):this._perform(o({method:e},s))}send(e,t){return this.perform(e,t)}request(e){return this.perform(e.method,e.params)}async _detectNetwork(){const e=this.client.getChainId(),s=Re(this.networks,e);if(!s)throw new Error(`Unknown network ${e}`);return new t.ethers.Network(s.name,s.chainId)}async detectNetwork(){return this._detectNetwork()}async waitForTransaction(e,t,s,n){return(await this._getSubprovider(null==n?void 0:n.chainId)).waitForTransaction(e,t,s)}async getBlockNumber(e){return(await this._getSubprovider(null==e?void 0:e.chainId)).getBlockNumber()}async getFeeData(e){return(await this._getSubprovider(null==e?void 0:e.chainId)).getFeeData()}async getBalance(e,t,s){return(await this._getSubprovider(null==s?void 0:s.chainId)).getBalance(e,t)}async getTransactionCount(e,t,s){return(await this._getSubprovider(null==s?void 0:s.chainId)).getTransactionCount(e,t)}async getCode(e,t,s){return(await this._getSubprovider(null==s?void 0:s.chainId)).getCode(e,t)}async getStorage(e,t,s,n){return(await this._getSubprovider(null==n?void 0:n.chainId)).getStorage(e,t,s)}async call(e,t){return(await this._getSubprovider(null==t?void 0:t.chainId)).call(e)}async estimateGas(e,t){return(await this._getSubprovider(null==t?void 0:t.chainId)).estimateGas(e)}async getBlock(e,t,s){return(await this._getSubprovider(null==s?void 0:s.chainId)).getBlock(e,t)}async getTransaction(e,t){return(await this._getSubprovider(null==t?void 0:t.chainId)).getTransaction(e)}async getLogs(e,t){return(await this._getSubprovider(null==t?void 0:t.chainId)).getLogs(e)}async supportsENS(){return(await this.getNetworks()).some((e=>1===e.chainId))}async getResolver(e){if(!await this.supportsENS())return null;return(await this._getSubprovider(1)).getResolver(e)}async resolveName(e){if(t.ethers.isAddress(e))return e;if(!await this.supportsENS())return null;return(await this._getSubprovider(1)).resolveName(e)}async lookupAddress(e){if(!await this.supportsENS())return null;return(await this._getSubprovider(1)).lookupAddress(e)}async getAvatar(e){if(!await this.supportsENS())return null;return(await this._getSubprovider(1)).getAvatar(e)}}function cl(e){return"object"==typeof e?cl(e.chainId):Number(e)}al.is=e=>e&&"object"==typeof e&&!0===e._isSequenceProvider;class hl extends al{constructor(e,t,s,n){super(e,t,void 0,n),this.chainId=s,this._isSingleNetworkSequenceProvider=!0}_useChainId(e){const t=this.toChainId(e);if(t&&t!==this.chainId)throw new Error(`This provider only supports the network ${this.chainId}, but ${t} was requested.`);return t||super.toChainId(this.chainId)}useChainId(e){return Promise.resolve(this._useChainId(e))}getChainId(){return super.toChainId(this.chainId)}async getNetwork(){const e=await this.client.getNetworks(),s=Re(e,this.chainId);if(!s)throw new Error(`Unsupported network ${this.chainId}`);return new t.ethers.Network(s.name,s.chainId)}getProvider(e){if(this._useChainId(e)!==this.chainId)throw new Error("Unreachable code");return this}getSigner(e){return super.getSigner(this._useChainId(e))}setDefaultChainId(e){throw new Error(`This provider only supports the network ${this.chainId}; use the parent provider to switch networks.`)}static is(e){return e&&"object"==typeof e&&!0===e._isSingleNetworkSequenceProvider}}function ll(e,...t){if(!((s=e)instanceof Uint8Array||null!=s&&"object"==typeof s&&"Uint8Array"===s.constructor.name))throw new Error("Uint8Array expected");var s;if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function dl(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const ul=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),fl=(e,t)=>e<<32-t|e>>>t;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const pl=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function gl(e){ll(e);let t="";for(let s=0;s<e.length;s++)t+=pl[e[s]];return t}function ml(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),ll(e),e}class wl{clone(){return this._cloneInto()}}function yl(e){const t=t=>e().update(ml(t)).digest(),s=e();return t.outputLen=s.outputLen,t.blockLen=s.blockLen,t.create=()=>e(),t}const bl=(e,t,s)=>e&t^e&s^t&s;class vl extends wl{constructor(e,t,s,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ul(this.buffer)}update(e){dl(this);const{view:t,buffer:s,blockLen:n}=this,r=(e=ml(e)).length;for(let i=0;i<r;){const o=Math.min(n-this.pos,r-i);if(o!==n)s.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0),this.pos=0);else{const t=ul(e);for(;n<=r-i;i+=n)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){dl(this),function(e,t){ll(e);const s=t.outputLen;if(e.length<s)throw new Error(`digestInto() expects output buffer of length at least ${s}`)}(e,this),this.finished=!0;const{buffer:t,view:s,blockLen:n,isLE:r}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>n-i&&(this.process(s,0),i=0);for(let e=i;e<n;e++)t[e]=0;!function(e,t,s,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,s,n);const r=BigInt(32),i=BigInt(4294967295),o=Number(s>>r&i),a=Number(s&i),c=n?4:0,h=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+h,a,n)}(s,n-8,BigInt(8*this.length),r),this.process(s,0);const o=ul(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,h[e],r)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:s,length:n,finished:r,destroyed:i,pos:o}=this;return e.length=n,e.pos=o,e.finished=r,e.destroyed=i,n%t&&e.buffer.set(s),e}}const El=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Il=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Tl=new Uint32Array(64);class Sl extends vl{constructor(){super(64,32,8,!1),this.A=0|Il[0],this.B=0|Il[1],this.C=0|Il[2],this.D=0|Il[3],this.E=0|Il[4],this.F=0|Il[5],this.G=0|Il[6],this.H=0|Il[7]}get(){const{A:e,B:t,C:s,D:n,E:r,F:i,G:o,H:a}=this;return[e,t,s,n,r,i,o,a]}set(e,t,s,n,r,i,o,a){this.A=0|e,this.B=0|t,this.C=0|s,this.D=0|n,this.E=0|r,this.F=0|i,this.G=0|o,this.H=0|a}process(e,t){for(let s=0;s<16;s++,t+=4)Tl[s]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Tl[e-15],s=Tl[e-2],n=fl(t,7)^fl(t,18)^t>>>3,r=fl(s,17)^fl(s,19)^s>>>10;Tl[e]=r+Tl[e-7]+n+Tl[e-16]|0}let{A:s,B:n,C:r,D:i,E:o,F:a,G:c,H:h}=this;for(let e=0;e<64;e++){const t=h+(fl(o,6)^fl(o,11)^fl(o,25))+((l=o)&a^~l&c)+El[e]+Tl[e]|0,d=(fl(s,2)^fl(s,13)^fl(s,22))+bl(s,n,r)|0;h=c,c=a,a=o,o=i+t|0,i=r,r=n,n=s,s=t+d|0}var l;s=s+this.A|0,n=n+this.B|0,r=r+this.C|0,i=i+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(s,n,r,i,o,a,c,h)}roundClean(){Tl.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Ol=yl((()=>new Sl));var kl=class{hostname;fetch;path="/rpc/Databeat/";constructor(e,t){this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}ping=(e,t)=>this.fetch(this.url("Ping"),Cl({},e,t)).then((e=>_l(e).then((e=>({status:e.status})))),(e=>{throw xl.new({cause:`fetch(): ${e.message||""}`})}));version=(e,t)=>this.fetch(this.url("Version"),Cl({},e,t)).then((e=>_l(e).then((e=>({version:e.version})))),(e=>{throw xl.new({cause:`fetch(): ${e.message||""}`})}));runtimeStatus=(e,t)=>this.fetch(this.url("RuntimeStatus"),Cl({},e,t)).then((e=>_l(e).then((e=>({status:e.status})))),(e=>{throw xl.new({cause:`fetch(): ${e.message||""}`})}));tick=(e,t,s)=>this.fetch(this.url("Tick"),Cl(e,t,s)).then((e=>_l(e).then((e=>({ok:e.ok})))),(e=>{throw xl.new({cause:`fetch(): ${e.message||""}`})}));rawEvents=(e,t,s)=>this.fetch(this.url("RawEvents"),Cl(e,t,s)).then((e=>_l(e).then((e=>({ok:e.ok})))),(e=>{throw xl.new({cause:`fetch(): ${e.message||""}`})}))},Cl=(e={},t={},s=null)=>({method:"POST",headers:{...t,"Content-Type":"application/json"},body:JSON.stringify(e||{}),signal:s}),_l=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){let n="";throw s instanceof Error&&(n=s.message),Pl.new({status:e.status,cause:`JSON.parse(): ${n}: response text: ${t}`})}if(!e.ok){const e="number"==typeof s.code?s.code:0;throw(Nl[e]||Al).new(s)}return s})),Al=class e extends Error{name;code;message;status;cause;msg;constructor(t,s,n,r,i){super(n),this.name=t||"WebrpcError",this.code="number"==typeof s?s:0,this.message=n||`endpoint error ${this.code}`,this.msg=this.message,this.status="number"==typeof r?r:0,this.cause=i,Object.setPrototypeOf(this,e.prototype)}static new(e){return new this(e.error,e.code,e.message||e.msg,e.status,e.cause)}},xl=class e extends Al{constructor(t="WebrpcRequestFailed",s=-1,n="request failed",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},Pl=class e extends Al{constructor(t="WebrpcBadResponse",s=-5,n="bad response",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},Nl={0:class e extends Al{constructor(t="WebrpcEndpoint",s=0,n="endpoint error",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},[-1]:xl,[-2]:class e extends Al{constructor(t="WebrpcBadRoute",s=-2,n="bad route",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},[-3]:class e extends Al{constructor(t="WebrpcBadMethod",s=-3,n="bad method",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},[-4]:class e extends Al{constructor(t="WebrpcBadRequest",s=-4,n="bad request",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},[-5]:Pl,[-6]:class e extends Al{constructor(t="WebrpcServerPanic",s=-6,n="server panic",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},[-7]:class e extends Al{constructor(t="WebrpcInternalError",s=-7,n="internal error",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},[-8]:class e extends Al{constructor(t="WebrpcClientDisconnected",s=-8,n="client disconnected",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},[-9]:class e extends Al{constructor(t="WebrpcStreamLost",s=-9,n="stream lost",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},[-10]:class e extends Al{constructor(t="WebrpcStreamFinished",s=-10,n="stream finished",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},1e3:class e extends Al{constructor(t="Unauthorized",s=1e3,n="Unauthorized access",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},2e3:class e extends Al{constructor(t="PermissionDenied",s=2e3,n="Permission denied",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},2001:class e extends Al{constructor(t="SessionExpired",s=2001,n="Session expired",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},3e3:class e extends Al{constructor(t="NotFound",s=3e3,n="Resource not found",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},4e3:class e extends Al{constructor(t="InvalidAppKey",s=4e3,n="Invalid app key",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},4001:class e extends Al{constructor(t="QueryFailed",s=4001,n="DB query failed",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}},4002:class e extends Al{constructor(t="InvalidProjectId",s=4002,n="Invalid project id",r=0,i){super(t,s,n,r,i),Object.setPrototypeOf(this,e.prototype)}}},Rl=class extends kl{constructor(e,t){const s=globalThis.fetch.bind(globalThis);super(e.endsWith("/")?e.slice(0,-1):e,s),this.auth=t,this._globalFetch=s,this.fetch=this._fetch}_globalFetch;_fetch=(e,t)=>{if(this.auth){let e={};this.auth.jwt?.length>0&&(e.Authorization=`BEARER ${this.auth.jwt}`),this.auth.headers&&(e={...e,...this.auth.headers}),t.headers={...t.headers,...e}}return this._globalFetch(e,t)}},Ml={defaultEnabled:!0,noop:!1,privacy:{userIdHash:!0,userAgentSalt:!1},userIdentTracking:!1,strictMode:!1,flushInterval:500,initProps:()=>({})},Ll=class{rpc;auth;options;enabled;ident;userId;sessionId;allowUserTracking;projectId;queue;flushTimeout;defaultProps;dedupeIdentKey;dedupeViewKey;ts;constructor(e,t,s){this.auth="string"==typeof t?{jwt:t}:t,this.rpc=new Rl(e,this.auth),this.options=Ml,s&&(this.options={defaultEnabled:s.defaultEnabled||Ml.defaultEnabled,projectId:s.projectId||null,privacy:s.privacy||Ml.privacy,userIdentTracking:s.userIdentTracking||Ml.userIdentTracking,strictMode:s.strictMode||Ml.strictMode,flushInterval:s.flushInterval||Ml.flushInterval,noop:s.noop||!1,initProps:s.initProps||Ml.initProps}),this.init()}init(){this.enabled=$l(this.options.defaultEnabled,this.auth),this.projectId=this.options.projectId||null,this.userId=null,this.sessionId=Gl(),this.queue=[],this.flushTimeout=null,this.defaultProps={...jl(),...this.options.initProps()},this.identify()}reset(e){this.enabled=$l(this.options.defaultEnabled,this.auth),this.userId&&!this.isAnon()&&(this.userId=null),this.ident=0,this.ts=ql({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking}),!0!==e&&this.init()}identify(e,t){if(!Bl())return;if(t&&void 0!==t.allowTracking&&this.allowTracking(t.allowTracking),!e){const e=Hl();null!==e&&null!==e.id&&(this.userId=e.id,this.ident=e.it,this.allowUserTracking=e.ut,void 0===e.it?(this.userId.startsWith("anon:")?this.ident=0:this.ident=1,this.ts=ql({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking})):this.ident=e.it)}if(e||null===this.userId){const t=Fl(e,this.allowUserTracking,this.options);this.userId=t.userId,this.ident=t.ident,this.ts=ql({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking})}const s=`${this.userId}:${this.sessionId}`;this.dedupeIdentKey!==s&&(this.dedupeIdentKey=s,this.track({event:"INIT",source:Wl(),props:this.defaultProps}),this.flush())}allowTracking(e){this.allowUserTracking=e,ql({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking}),this.options.strictMode&&(e?this.enable():this.disable())}async track(e,t){if(Bl()&&null===this.userId)throw new Error("databeat: init first");if(Array.isArray(e)){for(let t=0;t<e.length;t++)e[t].ident=this.ident,e[t].userId=this.userId,e[t].sessionId=this.sessionId,!e[t].projectId&&this.projectId&&(e[t].projectId=this.projectId);this.queue.push(...e)}else e.ident=this.ident,e.userId=this.userId,e.sessionId=this.sessionId,!e.projectId&&this.projectId&&(e.projectId=this.projectId),this.queue.push(e);this.queue.length>150&&(this.queue=this.queue.splice(this.queue.length-150)),this.enabled&&(t&&t.flush?await this.flush():null===this.flushTimeout&&(this.flushTimeout=setTimeout((()=>{this.flush()}),this.options.flushInterval)))}trackView(e={}){const t={...this.defaultProps,...e},s=Wl(),n=`${s}:${JSON.stringify(t)}:${this.userId}:${this.sessionId}`;this.dedupeViewKey!==n&&(this.dedupeViewKey=n,this.track({event:"VIEW",source:s,props:t}))}flush=async()=>{if(null!==this.flushTimeout&&(clearTimeout(this.flushTimeout),this.flushTimeout=null),!this.enabled)return;if(this.options.noop)return;if(this.options.strictMode&&!this.allowUserTracking)return;if(0===this.queue.length)return;const e=this.dedupedQueue();this.queue=[];try{await this.rpc.tick({events:e})}catch(e){console.warn(`databeat flush failed: ${e}`)}};isEnabled(){return this.enabled}isAnon(){return 0===this.ident}getIdent(){return this.ident}getUserId(){return this.userId}getSessionId(){return this.sessionId}getStorageTS(){if(this.ts)return this.ts;const e=Hl();return null!=e&&null!==e.id?(this.ts=e.ts,this.ts):void 0}enable(){Dl(this.auth)?Bl()&&(this.enabled=!0,this.ts=ql({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking}),this.identify()):this.enabled=!1}disable(){Bl()&&(this.enabled=!1,this.ts=ql({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking}))}dedupedQueue=()=>{const e=new Map;for(let t=0;t<this.queue.length;t++){const s=this.queue[t],n=`${s.event}:${s.source}:${s.userId}:${s.sessionId}:${JSON.stringify(s.props)}:${JSON.stringify(s.nums)}`;e.has(n)||e.set(n,s)}return Array.from(e.values())}},Bl=()=>"object"==="object".localStorage&&"function"==="object".localStorage.getItem&&"function"==="object".localStorage.setItem,$l=(e,t)=>{if(!Dl(t))return!1;if(!Bl())return!0;const s=Hl();return null===s?null==e||e:s.on},Dl=e=>e?.jwt?.length>0||!!(e?.headers&&Object.keys(e.headers).length>0),Wl=()=>{try{return window.location.pathname}catch(e){return""}},jl=()=>{if(!Bl())return{};const e=new URL(window.location.href).searchParams,t={};return t.origin=window.location.origin,e.get("ref")&&""!==e.get("ref")&&(t.ref=e.get("ref")||""),e.get("source")&&""!==e.get("source")&&(t.source=e.get("source")||""),e.get("utm_source")&&""!==e.get("utm_source")&&(t.utmSource=e.get("utm_source")||""),e.get("utm_campaign")&&""!==e.get("utm_campaign")&&(t.utmCampaign=e.get("utm_campaign")||""),e.get("utm_medium")&&""!==e.get("utm_medium")&&(t.utmMedium=e.get("utm_medium")||""),e.get("utm_content")&&""!==e.get("utm_content")&&(t.utmContent=e.get("utm_content")||""),e.get("utm_term")&&""!==e.get("utm_term")&&(t.utmTerm=e.get("utm_term")||""),document.referrer&&""!==document.referrer&&(t.referrer=document.referrer),e.get("gclid")&&""!==e.get("gclid")&&(t.gclid=e.get("gclid")||""),e.get("wbraid")&&""!==e.get("wbraid")&&(t.wbraid=e.get("wbraid")||""),t},Ul="_dbeat",Hl=()=>{try{return JSON.parse(window.localStorage.getItem(Ul))}catch(e){return null}},ql=e=>{try{return e.ts||(e.ts=Math.floor(Date.now()/1e3)),window.localStorage.setItem(Ul,JSON.stringify(e)),e.ts}catch(e){return}},Fl=(e,t,s)=>{if(!e||null===e||""===e){return{userId:`${Math.floor(1e14*Math.random())}`,ident:0}}if(s.userIdentTracking&&t)return{userId:e,ident:2};if(!0!==s.privacy.userIdHash&&s.userIdentTracking&&t)throw new Error("invalid configuration");return Bl()&&!0===s.privacy.userAgentSalt&&(e=e+":"+navigator.userAgent),s.privacy.extraSalt&&s.privacy.extraSalt.length>0&&(e=e+":"+s.privacy.extraSalt),{userId:gl(Ol(e)).substring(0,50),ident:1}},Gl=()=>{if(Bl()&&"object"==="object".sessionStorage&&"function"==="object".sessionStorage.getItem&&"function"==="object".sessionStorage.setItem){const e=window.sessionStorage.getItem(Ul);if(e&&e.length>0)return e;{const e=Vl(16);return window.sessionStorage.setItem(Ul,e),e}}return Vl(16)},Vl=e=>{let t="";for(let s=0;s<e;s++)t+=Math.floor(16*Math.random()).toString(16);return"0x"+t};"object"==typeof process&&process.version&&process.version<"v18"&&(console.error(`ERROR! expecting node v18+ but your node version is reporting ${process.version}`),process&&process.exit&&process.exit(1));class Kl extends Ll{}class zl{constructor(e){this.store=e}connectedSession(){const e=this.getSession();if(e&&e.accountAddress&&e.walletContext&&e.networks)return{accountAddress:e.accountAddress,walletContext:e.walletContext,networks:e.networks};throw new Error("Sequence session not connected")}hasSession(){var e;return void 0!==(null==(e=this.getSession())?void 0:e.accountAddress)}setSession(e){return this.store.setItem(zl.SESSION_LOCALSTORE_KEY,JSON.stringify(e))}getSession(){const e=this.store.getItem(zl.SESSION_LOCALSTORE_KEY);if(e)return JSON.parse(e)}async clearSession(){return this.store.removeItem(zl.SESSION_LOCALSTORE_KEY)}}zl.SESSION_LOCALSTORE_KEY="@sequence.session";class Jl{constructor(e,t=1){this.store=e,this.startingChainId=t,this.callbacks=[],e.onItemChange(Jl.SESSION_CHAIN_ID_KEY,(e=>{if(e){const t=parseInt(e);this.callbacks.forEach((e=>e(t)))}}))}onDefaultChainIdChanged(e){return this.callbacks.push(e),()=>{this.callbacks=this.callbacks.filter((t=>t!==e))}}setDefaultChainId(e){e!==this.getDefaultChainId()&&this.store.setItem(Jl.SESSION_CHAIN_ID_KEY,e.toString())}getDefaultChainId(){const e=this.store.getItem(Jl.SESSION_CHAIN_ID_KEY);return e&&0!==e.length?parseInt(e):this.startingChainId}}Jl.SESSION_CHAIN_ID_KEY="@sequence.session.defaultChainId";class Yl{constructor(e,s,n){var r,i;if(this.session=void 0,this.defaultChainId=void 0,this.callbacks={},this.transport=void 0,this.defaultEIP6492=void 0,this.projectAccessKey=void 0,this.analytics=void 0,Xh(e))this.transport=Zh.new(e);else{if(!uh(e))throw new Error("Invalid transport");this.transport=e}const a=null==n?void 0:n.defaultChainId;var c,h;(this.defaultEIP6492=null!=(r=null==n?void 0:n.defaultEIP6492)&&r,this.session=new zl(s),this.defaultChainId=new Jl(s,a),this.transport.on("accountsChanged",(e=>{var t;e.length>1&&console.warn("SequenceClient: wallet-webapp returned more than one account"),null==(t=this.callbacks.accountsChanged)||t.forEach((t=>t(e)))})),this.transport.on("connect",(e=>{var s;const n=t.ethers.toQuantity(this.getChainId());null==(s=this.callbacks.connect)||s.forEach((t=>t(o({},e,{chainId:n}))))})),this.transport.on("disconnect",((e,t)=>{var s;null==(s=this.callbacks.disconnect)||s.forEach((s=>s(e,t)))})),this.transport.on("networks",(e=>{var t;null==(t=this.callbacks.networks)||t.forEach((t=>t(e)))})),this.transport.on("walletContext",(e=>{var t;null==(t=this.callbacks.walletContext)||t.forEach((t=>t(e)))})),this.transport.on("open",(e=>{var t;null==(t=this.callbacks.open)||t.forEach((t=>t(e)))})),this.transport.on("close",(()=>{var e;null==(e=this.callbacks.close)||e.forEach((e=>e()))})),this.transport.on("chainChanged",((e,t)=>{var s;null==(s=this.callbacks.chainChanged)||s.forEach((s=>s(e,t)))})),this.defaultChainId.onDefaultChainIdChanged((e=>{var s;const n=t.ethers.toQuantity(e);null==(s=this.callbacks.chainChanged)||s.forEach((e=>e(n)))})),null!=n&&n.projectAccessKey&&(this.projectAccessKey=n.projectAccessKey),this.projectAccessKey&&null!=n&&n.analytics&&(this.analytics=((e,t)=>{t||(t="https://nodes.sequence.app");const s=!e,n={};return e&&(n.headers={"X-Access-Key":e}),new Kl(t,n,{noop:s,defaultEnabled:!0,privacy:{userIdHash:!0,userAgentSalt:!1},initProps:()=>Bl()?{origin:window.location.origin}:{}})})(this.projectAccessKey)),null!=(i=this.session.getSession())&&i.accountAddress)&&(null==(c=this.analytics)||c.identify(null==(h=this.session.getSession())||null==(h=h.accountAddress)?void 0:h.toLowerCase()))}registerCallback(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),()=>{this.callbacks[e]=this.callbacks[e].filter((e=>e!==t))}}onOpen(e){return this.registerCallback("open",e)}onClose(e){return this.registerCallback("close",e)}onConnect(e){return this.registerCallback("connect",e)}onDisconnect(e){return this.registerCallback("disconnect",e)}onNetworks(e){return this.registerCallback("networks",e)}onAccountsChanged(e){return this.registerCallback("accountsChanged",e)}onWalletContext(e){return this.registerCallback("walletContext",e)}onChainChanged(e){return this.registerCallback("chainChanged",e)}onDefaultChainIdChanged(e){return this.registerCallback("chainChanged",e)}getChainId(){return this.defaultChainId.getDefaultChainId()}setDefaultChainId(e){return this.defaultChainId.setDefaultChainId(e)}async openWallet(e,t){return this.transport.openWallet(e,t,this.getChainId()),await this.transport.waitUntilOpened(),this.isOpened()}closeWallet(){return this.transport.closeWallet()}isOpened(){return this.transport.isOpened()}isConnected(){return this.session.hasSession()}getSession(){return this.session.getSession()}getAddress(){return this.session.connectedSession().accountAddress}async connect(e){if(void 0===(null==e?void 0:e.authorizeVersion)&&(e.authorizeVersion=2),!0===(null==e?void 0:e.refresh)&&this.disconnect(),e.projectAccessKey=this.projectAccessKey,e&&e.authorize){if(!e.app)throw new Error("connecting with 'authorize' option also requires 'app' to be set");void 0===e.authorizeVersion&&(e.authorizeVersion=2)}await this.openWallet(void 0,{type:"connect",options:o({},e,{networkId:this.getChainId(),clientVersion:hr})});const t=await this.transport.waitUntilConnected().catch((e=>e instanceof Error?{connected:!1,error:e.message}:{connected:!1,error:JSON.stringify(e)}));if(t.chainId&&(t.chainId=BigInt(t.chainId).toString()),t.connected){var s,n;if(!t.session)throw new Error("impossible state, connect response is missing session");if(this.session.setSession(t.session),null!=(s=t.session)&&s.accountAddress)null==(n=this.analytics)||n.identify(t.session.accountAddress.toLowerCase())}return t}disconnect(){var e;return this.isOpened()&&this.closeWallet(),null==(e=this.analytics)||e.reset(),this.session.clearSession()}async request(e){e.method=this.mapSignMethod(e.method);const t=await this.transport.request(e);return Ql(t)}async getNetworks(e){const t=this.session.connectedSession();return e&&(t.networks=await this.request({method:"sequence_getNetworks"}),this.session.setSession(t)),t.networks}signMethod(e){return void 0===(null==e?void 0:e.eip6492)?"personal_sign":e.eip6492?"sequence_sign":"legacy_sign"}signTypedDataMethod(e){return void 0===(null==e?void 0:e.eip6492)?"eth_signTypedData_v4":e.eip6492?"sequence_signTypedData_v4":"legacy_signTypedData_v4"}mapSignMethod(e){return"personal_sign"===e?this.defaultEIP6492?"sequence_sign":"personal_sign":"eth_signTypedData_v4"===e?this.defaultEIP6492?"sequence_signTypedData_v4":"eth_signTypedData_v4":"legacy_sign"===e?"personal_sign":"legacy_signTypedData_v4"===e?"eth_signTypedData_v4":e}async signMessage(e,s){var n;const r=this.signMethod(s);return null==(n=this.analytics)||n.track({event:"SIGN_MESSAGE_REQUEST",props:{chainId:`${(null==s?void 0:s.chainId)||this.getChainId()}`}}),e=t.ethers.hexlify(Ch(e)),this.request({method:r,params:[e,this.getAddress()],chainId:null==s?void 0:s.chainId})}async signTypedData(e,s){var n;const r=this.signTypedDataMethod(s),i=t.ethers.TypedDataEncoder.getPayload(e.domain,e.types,e.message);return null==(n=this.analytics)||n.track({event:"SIGN_TYPED_DATA_REQUEST",props:{chainId:`${(null==s?void 0:s.chainId)||this.getChainId()}`}}),this.request({method:r,params:[this.getAddress(),i],chainId:(null==s?void 0:s.chainId)||e.domain.chainId&&Number(e.domain.chainId)||this.getChainId()})}async sendTransaction(e,t){var s;const n=function(e){if(0===e.length)throw new Error("No transaction provided");const[t,...s]=e;return o({},t,{auxiliary:s})}(Array.isArray(e)?e:[e]);return null==(s=this.analytics)||s.track({event:"SEND_TRANSACTION_REQUEST",props:{chainId:`${(null==t?void 0:t.chainId)||this.getChainId()}`}}),this.request({method:"eth_sendTransaction",params:[n],chainId:null==t?void 0:t.chainId})}async getWalletContext(){return this.request({method:"sequence_getWalletContext"})}async getOnchainWalletConfig(e){const t=await this.request({method:"sequence_getWalletConfig",params:[(null==e?void 0:e.chainId)||this.getChainId()],chainId:null==e?void 0:e.chainId});return Array.isArray(t)?t[0]:t}}const Ql=e=>e&&"object"==typeof e&&"jsonrpc"in e&&"result"in e?e.result:e,Xl={transports:{walletAppURL:"https://sequence.app",windowTransport:{enabled:!0},proxyTransport:{enabled:!1}},defaultNetwork:1,analytics:!0};let Zl;const ed=(e,t)=>{var s,n,r;if(!e||"string"!=typeof e)throw new Error("Please pass a projectAccessKey in initWallet.");if(Zl)return Zl;const i=o({},Xl,t,{transports:o({},Xl.transports,null==t?void 0:t.transports)}),a={},c=null!=(s=null==(n=i.networks)?void 0:n.filter((e=>{void 0!==e.rpcUrl&&void 0!==e.chainId&&wt.find((t=>t.chainId===e.chainId))})))?s:[],h=wt.map((e=>{var t;const s=null==(t=i.networks)?void 0:t.find((t=>t.chainId===e.chainId));return s?o({},e,s):e})).concat(c).map((t=>(t.rpcUrl.includes(e)||(t.rpcUrl=t.rpcUrl+`/${e}`),t))),l=i.defaultNetwork?null==(r=Re(h,i.defaultNetwork))?void 0:r.chainId:void 0;if(!l&&i.defaultNetwork)throw new Error(`defaultNetwork not found for chainId: ${i.defaultNetwork}`);const d=i.localStorage||$h(),u=new Yl(i.transports,d,{defaultChainId:l,defaultEIP6492:i.defaultEIP6492,projectAccessKey:e,analytics:i.analytics});return Zl=new al(u,(e=>{if(!a[e]){var t;const s=null==(t=h.find((t=>t.chainId===e)))?void 0:t.rpcUrl;if(!s)throw new Error(`no rpcUrl found for chainId: ${e}`);a[e]=new Bt(s,{middlewares:[Ct,kt,new St]},{cacheTimeout:-1})}return a[e]})),Zl},td=()=>{Zl&&(Zl.client.closeWallet(),Zl.client.transport.unregister(),Zl=void 0)},sd=()=>{if(!Zl)throw new Error("Wallet has not been initialized, call sequence.initWallet(config) first.");return Zl};var nd=Object.freeze({__proto__:null,validateTransactionRequest:lh,PROVIDER_OPEN_TIMEOUT:bh,nextMessageIdx:Eh,BaseProviderTransport:Ih,BaseWalletTransport:jh,ProxyMessageChannel:class{constructor(){this.app=void 0,this.wallet=void 0;const e=new Uh,t=new Uh;e.conn=t,t.conn=e,this.app=e,this.wallet=t}},ProxyMessageChannelPort:Uh,ProxyMessageProvider:Hh,ProxyMessageHandler:class extends jh{constructor(e,t){super(e),this.port=void 0,this.port=t,this._init=mh.OK}register(){this.port.handleMessage=e=>{this.handleMessage(e)},this._registered=!0}async restoreSession(){const e=await this.getCachedTransportSession();e&&this.open(e)}unregister(){this.port.handleMessage=void 0,this._registered=!1}sendMessage(e){this.port.sendMessage(e)}},isMuxTransportTemplate:Xh,MuxMessageProvider:Zh,WindowMessageProvider:Qh,WindowMessageHandler:class extends jh{constructor(e){var t;super(e),t=this,this.parentWindow=void 0,this._isPopup=!1,this.onWindowEvent=async function(e){if(!e.origin||""===e.origin)return;if(t.appOrigin&&e.origin!==t.appOrigin)return;let s;try{s=JSON.parse(e.data,He)}catch(e){return}Xe.debug("RECEIVED MESSAGE",s),t._init!==mh.OK&&t.isValidInitAck(s)&&(t.appOrigin=e.origin),t._init!==mh.OK||t.appOrigin&&!(t.appOrigin.length<8)?t.handleMessage(s):Xe.error("impossible state, init.OK and appOrigin required")},this.getWindowTransportSession=e=>{const t=new fh(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:Fe(t.get("intent"))}},this._init=mh.NIL}async register(e){const t=null!==parent.window.opener;if(this._isPopup=t,!0!==t)return;const{search:s}=new URL(e||window.location.href);let n=this.getWindowTransportSession(s);!!n.sessionId||(n=await this.getCachedTransportSession()),n?(this.parentWindow=parent.window.opener,window.addEventListener("message",this.onWindowEvent,!1),this._registered=!0,this.open(n).then((e=>{if(!e){var t;const e=`failed to open to network ${null==(t=n)?void 0:t.networkId}`;Xe.error(e),this.notifyClose({message:e}),window.close()}})).catch((e=>{var t;const s=`failed to open to network ${null==(t=n)?void 0:t.networkId}, due to: ${e}`;Xe.error(s),this.notifyClose({message:s}),window.close()}))):Xe.error("window session is undefined")}unregister(){window.removeEventListener("message",this.onWindowEvent),this._registered=!1}sendMessage(e){const t=JSON.stringify(e,Ue);e.type===ph.INIT?this.postMessage(t,!0):this.postMessage(t)}get isPopup(){return this._isPopup}postMessage(e,t=!1){!0===t||this._init===mh.OK?t?this.parentWindow.postMessage(e,"*"):this.appOrigin&&this.appOrigin.length>4?this.parentWindow.postMessage(e,this.appOrigin):Xe.error("unable to postMessage as parentOrigin is invalid"):Xe.error("impossible state, should not be calling postMessage until inited")}},WalletRequestHandler:class{constructor(e,t,s){var n=this;this.account=void 0,this.signerReadyCallbacks=[],this.prompter=void 0,this.networks=void 0,this._openIntent=void 0,this._connectOptions=void 0,this.events=new dh.EventEmitter2,this.onConnectOptionsChange=void 0,this.promptConnect=async function(e){if(!e&&!n._connectOptions)throw new Error("prompter connect options are empty");if(!n.prompter)return n.connect(e);const t=await n.prompter.promptConnect(e||n._connectOptions).catch((e=>({connected:!1}))),s=t;return s.connected&&!s.session&&(s.session=await n.walletSession(null==e?void 0:e.networkId)),t},this.isSignedIn=async function(){return await n.signerReady(),!!n.account},this.getAccount=async function(){if(await n.signerReady(),void 0===n.account)throw new Error("signerReady failed resolve");return n.account},this.account=e,this.prompter=t,this.networks=s}defaultChainId(){var e,t;return null!=(e=null==(t=this.prompter)?void 0:t.getDefaultChainId())?e:this.networks[0].chainId}async signIn(e,t={}){this.setAccount(e);const{connect:s,defaultNetworkId:n}=t;if(s){const e=this._connectOptions;let t;var r;if(null!==this.prompter)t=await(null==(r=this.prompter)?void 0:r.promptSignInConnect(e));else t=await this.connect(e);this.notifyConnect(t),e&&!0===e.keepWalletOpened||this.notifyClose()}var i;n&&this.defaultChainId()!==n&&await(null==(i=this.prompter)?void 0:i.promptChangeNetwork(n))}signOut(){this.account&&this.notifyDisconnect(),this.setAccount(null)}signerReset(){this.account=void 0}signerReady(e=1e4){return new Promise(((t,s)=>{void 0!==this.account?t():(setTimeout((()=>{void 0===this.account&&(this.signerReadyCallbacks=[],s("signerReady timed out"))}),e),this.signerReadyCallbacks.push(t))}))}async connect(e){var s,n;if(!this.account)return{connected:!1,chainId:"0x0",error:"unable to connect without signed in account"};const r=ft(null!=(s=null!=(n=null==e?void 0:e.networkId)?n:this.defaultChainId())?s:ke.MAINNET).chainId,i={connected:!0,chainId:t.ethers.toQuantity(r)};if(e&&e.authorize){const t={app:e.app,origin:e.origin,expiry:e.expiry,nonce:e.authorizeNonce};try{i.proof=await Zo(this.account,r,t)}catch(t){return Xe.warn(`connect, signAuthorization failed for options: ${JSON.stringify(e)}, due to: ${t.message}`),{connected:!1,chainId:"0x0",error:`signAuthorization failed: ${t.message}`}}}return i.session=this.walletSession(r),i}async sendMessageRequest(e){var t;const s=Number((null==(t=e.clientVersion)?void 0:t.split(".")[0])||"0")<2,n={id:e.data.id,jsonrpc:"2.0",result:null,error:void 0};try{const t=await this.request({method:e.data.method,params:e.data.params,chainId:e.chainId});return o({},e,{data:s?o({},n,{result:t}):t})}catch(t){return o({},e,{data:s?o({},n,{error:t}):{error:t}})}}async request(e){await this.getAccount();try{var s,n;if(!(this.account&&null!==this.account||tl.includes(e.method)))throw yh;const l=this.account;if(!l)throw new Error("WalletRequestHandler: wallet account is not configured");const d=null==(s=this.account)?void 0:s.providerFor(null!=(n=e.chainId)?n:this.defaultChainId());if(!d)throw new Error(`WalletRequestHandler: wallet provider is not configured for chainId ${e.chainId}`);const u=function(e){return e&&"object"==typeof e&&"function"==typeof e.send&&"function"==typeof e.getNetwork}(d)?d:void 0;switch(e.method){case"net_version":if(!u)throw new Error("Account provider doesn't support send method");return await u.send("net_version",[]);case"eth_chainId":if(!u)throw new Error("Account provider doesn't support send method");return await u.send("eth_chainId",[]);case"eth_accounts":return[l.address];case"eth_getBalance":{const[t,s]=e.params,n=await d.getBalance(t,s);return De(n)}case"sequence_sign":case"personal_sign":case"eth_sign":{let s;switch(e.method){case"sequence_sign":case"personal_sign":{const[t,n]=e.params;s=t;break}case"eth_sign":{const[t,n]=e.params;s=n;break}}let n="";const i=_h(s),o="sequence_sign"===e.method;var r;if(null===this.prompter)n=await l.signMessage(i,null!=(r=e.chainId)?r:this.defaultChainId(),o?"eip6492":"ignore");else n=await this.prompter.promptSignMessage({chainId:e.chainId,message:t.ethers.getBytes(i),eip6492:o},this.connectOptions);if(n&&n.length>0)return n;throw new Error("declined by user")}case"sequence_signTypedData_v4":case"eth_signTypedData":case"eth_signTypedData_v4":{const[t,s]=e.params;let n;if("string"==typeof s)try{n=JSON.parse(s)}catch(e){console.warn("walletRequestHandler: error parsing typedData",e)}else n=s;if(!(n&&n.domain&&n.types&&n.message))throw new Error("invalid typedData object");let r="";const o="sequence_signTypedData_v4"===e.method;var i;if(null===this.prompter)r=await l.signTypedData(n.domain,n.types,n.message,null!=(i=e.chainId)?i:this.defaultChainId(),o?"eip6492":"ignore");else r=await this.prompter.promptSignMessage({chainId:e.chainId,typedData:n,eip6492:o},this.connectOptions);if(r&&r.length>0)return r;throw new Error("declined by user")}case"eth_sendTransaction":{const t=function(e){return[e,...e.auxiliary||[]]}(e.params[0]).map((e=>("gas"in e&&void 0===e.gasLimit&&(e.gasLimit=e.gas,delete e.gas),e)));lh(l.address,t);let s="";if(null===this.prompter){var a,c;const n=await l.sendTransaction(t,null!=(a=e.chainId)?a:this.defaultChainId());s=null!=(c=null==n?void 0:n.hash)?c:""}else s=await this.prompter.promptSendTransaction(t,e.chainId,this.connectOptions);if(s)return s;throw new Error("declined by user")}case"eth_signTransaction":{const[s]=e.params;if(t.ethers.getAddress(s.from)!==l.address)throw new Error("sender address does not match wallet");var h;return lh(l.address,s),null===this.prompter?await l.signTransactions(s,null!=(h=e.chainId)?h:this.defaultChainId()):await this.prompter.promptSignTransaction(s,e.chainId,this.connectOptions)}case"eth_sendRawTransaction":if(Fn(e.params[0])){const t=Number(e.params[0].chainId);return(await l.relayer(t).relay(e.params[0])).hash}return(await d.broadcastTransaction(e.params[0])).hash;case"eth_getTransactionCount":{const s=t.ethers.getAddress(e.params[0]),n=e.params[1],r=await d.getTransactionCount(s,n);return De(BigInt(r))}case"eth_blockNumber":return await d.getBlockNumber();case"eth_getBlockByNumber":case"eth_getBlockByHash":return await d.getBlock(e.params[0]);case"eth_getTransactionByHash":return await d.getTransaction(e.params[0]);case"eth_call":{const[t,s]=e.params;return await d.call(o({},t,{blockTag:s}))}case"eth_getCode":{const[t,s]=e.params;return await d.getCode(t,s)}case"eth_estimateGas":{const[t]=e.params;return await d.estimateGas(t)}case"eth_gasPrice":{const e=await d.getFeeData();return null===e.gasPrice?null:De(e.gasPrice)}case"wallet_switchEthereumChain":{const[t]=e.params;if(!t.chainId||0===t.chainId.length)throw new Error("invalid chainId");const s=BigInt(t.chainId);return this.setDefaultChainId(Number(s)),null}case"sequence_getWalletContext":return l.contexts;case"sequence_getWalletConfig":{const[t]=e.params;return t?[(await l.status(t)).onChain.config]:await Promise.all(l.networks.map((async function(e){return(await l.status(e.chainId)).onChain.config})))}case"sequence_getWalletState":{const[t]=e.params;return t?[el(t,await l.status(t))]:await Promise.all(l.networks.map((async function(e){const t=await l.status(e.chainId);return el(e.chainId,t)})))}case"sequence_getNetworks":return await this.getNetworks(!0);case"sequence_isSequence":return!0;case"sequence_updateConfig":throw new Error("sequence_updateConfig method is not allowed from a dapp");case"sequence_publishConfig":throw new Error("sequence_publishConfig method is not allowed from a dapp");case"sequence_gasRefundOptions":case"sequence_getNonce":case"sequence_relay":break;case"sequence_setDefaultNetwork":{const[t]=e.params;if(!t)throw new Error("invalid request, method argument defaultChainId cannot be empty");return this.setDefaultChainId(t),await this.getNetworks(!0)}default:if(!u)throw new Error("Account provider doesn't support send method");return await u.send(e.method,e.params)}}catch(e){throw Xe.error(e),{message:"string"==typeof e?e:(null==e?void 0:e.message)||"unkown error",code:4001}}}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}async getAddress(){var e,t;return null!=(e=null==(t=this.account)?void 0:t.address)?e:""}get openIntent(){return this._openIntent}setOpenIntent(e){this._openIntent=e}get connectOptions(){return this._connectOptions}setConnectOptions(e){var t;this._connectOptions=e,null==(t=this.onConnectOptionsChange)||t.call(this,e)}async setDefaultChainId(e){var t;return await(null==(t=this.prompter)?void 0:t.promptChangeNetwork(e)),this.defaultChainId()}async getNetworks(e){return this.account?e?this.account.networks.map((e=>{const t=o({},e);return t.provider=void 0,t.relayer=void 0,t})):this.account.networks:(Xe.warn("signer not set: getNetworks is returning an empty list"),[])}walletSession(e){if(!this.account)return;const t={walletContext:this.account.contexts,accountAddress:this.account.address,networks:this.account.networks.map((e=>o({},e,{provider:void 0,relayer:void 0})))};if(e){const n=Re(t.networks,e);var s;if(n)null==(s=t.networks)||s.forEach((e=>delete e.isDefaultChain)),n.isDefaultChain=!0}return t}notifyConnect(e,t){var s,n;(console.log("emit connect",e),this.events.emit("connect",e),null!=(s=e.session)&&s.accountAddress)&&this.events.emit("accountsChanged",[null==(n=e.session)?void 0:n.accountAddress],t)}notifyDisconnect(e){this.events.emit("accountsChanged",[],e),this.events.emit("disconnect",void 0,e)}notifyChainChanged(e,s){this.events.emit("chainChanged",t.ethers.toQuantity(e),s)}async notifyNetworks(e){const s=e||await this.getNetworks(!0);if(this.events.emit("networks",s),s.length>0){const e=s.find((e=>e.chainId===this.defaultChainId()));e&&this.events.emit("chainChanged",t.ethers.toQuantity(e.chainId))}else this.events.emit("chainChanged","0x0")}async notifyWalletContext(){if(!this.account)return void Xe.warn("signer not set: skipping to notify wallet context");const e=this.account.contexts;this.events.emit("walletContext",e)}notifyClose(e){this.events.emit("close",e)}setAccount(e){if(this.account=e,void 0!==e){for(let e=0;e<this.signerReadyCallbacks.length;e++)this.signerReadyCallbacks[e]();this.signerReadyCallbacks=[]}}async handleConfirmWalletDeployPrompt(e,t,s,n){if(!n)return!0;const r=e=>e.canOnchainValidate||2===e.original.version&&s;if(r(await t.status(n)))return!0;if(await e.promptConfirmWalletDeploy(n,this.connectOptions)){return!!r(await t.status(n))||(Xe.error("WalletRequestHandler: result for promptConfirmWalletDeploy is not correct"),!1)}return!1}},CHANNEL_ID:Kh,ExtensionMessageHandler:class extends jh{constructor(e,t){super(e),this.runtime=t,this.port=void 0,this._init=mh.OK}register(){this._registered=!0,this.port=this.runtime.connect({name:Kh})}sendMessage(e){Xe.info("[ExtensionMessageHandler send]",e),this.port.postMessage(e)}},ExtensionMessageProvider:zh,BaseInjectedTransport:Jh,UnrealMessageProvider:Vh,UnrealMessageHandler:class extends jh{constructor(e){super(e),this.onMessageFromUnreal=e=>{Xe.debug("RECEIVED MESSAGE",e),this.handleMessage(e)},this.getUnrealTransportSession=e=>{const t=new fh(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:Fe(t.get("intent"))}},this._init=mh.NIL}async register(e){var t;if(void 0===(null==(t=window.ue)?void 0:t.sequencewallettransport))return;qh("wallet");const{search:s}=new URL(e||window.location.href);let n=this.getUnrealTransportSession(s);!!n.sessionId||(n=await this.getCachedTransportSession()),n?(window.ue.sequencewallettransport.onmessagefromsequencejs=this.onMessageFromUnreal,this._registered=!0,this.open(n).then((e=>{if(!e){var t;const e=`failed to open to network ${null==(t=n)?void 0:t.networkId}`;Xe.error(e),this.notifyClose({message:e}),window.close()}})).catch((e=>{var t;const s=`failed to open to network ${null==(t=n)?void 0:t.networkId}, due to: ${e}`;Xe.error(s),this.notifyClose({message:s}),window.close()}))):Xe.error("unreal session is undefined")}unregister(){var e;(null==(e=window.ue)||null==(e=e.sequencewallettransport)?void 0:e.onmessagefromsequencejs)===this.onMessageFromUnreal&&delete window.ue.sequencewallettransport.onmessagefromsequencejs,this._registered=!1}sendMessage(e){var t;if(e.type!==ph.INIT&&this._init!==mh.OK)return void Xe.error("impossible state, should not be calling postMessage until inited");const s=JSON.stringify(e,Ue);null==(t=window.ue)||null==(t=t.sequencewallettransport)||t.sendmessagetosequencejs(s)}},isProviderTransport:uh,WindowSessionParams:fh,EventType:ph,OpenState:gh,InitState:mh,ProviderError:wh,ErrSignedInRequired:yh,SequenceProvider:al,SingleNetworkSequenceProvider:hl,messageToBytes:Ch,prefixEIP191Message:_h,trimEIP191Prefix:e=>{if(JSON.stringify(e.slice(0,kh.length))!==JSON.stringify(kh))return e;const s=e.slice(kh.length),n=String(s.length).length;let r,i;try{i=Number(t.ethers.toUtf8String(s.slice(0,n)))}catch(e){i=Number(t.ethers.hexlify(s.slice(0,n)))}r=i>s.length||!Number.isInteger(i)?n-1:n;return s.slice(r)},isValidSignature:Ah,isValidMessageSignature:xh,isValidTypedDataSignature:Ph,isBrowserExtension:Nh,isUnityPlugin:Rh,isWalletUpToDate:Mh,MemoryItemStore:Lh,LocalStorage:Bh,useBestStore:$h,resolveArrayProperties:Dh,SequenceClientSession:zl,DefaultChainIdTracker:Jl,SequenceClient:Yl,SequenceSigner:sl,SingleNetworkSequenceSigner:nl,DefaultProviderConfig:Xl,initWallet:ed,unregisterWallet:td,getWallet:sd}),rd=Object.freeze({__proto__:null,RpcRelayerProto:Zr,isLocalRelayerOptions:function(e){return"object"==typeof e&&Tr(e.signer)},LocalRelayer:class extends Ir{constructor(e){if(super(Tr(e)?{provider:e.provider}:o({},e,{provider:e.signer.provider})),this.signer=void 0,this.txnOptions=void 0,this.signer=Tr(e)?e:e.signer,!this.signer.provider)throw new Error("Signer must have a provider")}async getFeeOptions(e,...t){return{options:[]}}async getFeeOptionsRaw(e,t,s){return{options:[]}}async gasRefundOptions(e,...t){const{options:s}=await this.getFeeOptions(e,...t);return s}setTransactionOptions(e){this.txnOptions=e}async relay(e,t,s=!0){void 0!==t&&Xe.warn("LocalRelayer doesn't accept fee quotes");const n=Gn(e),r=this.signer.sendTransaction(o({to:e.entrypoint,data:n},this.txnOptions,{gasLimit:9e6}));if(s){const e=await r;return e.receipt=await e.wait(),e}return r}},ProviderRelayerDefaults:Er,isProviderRelayerOptions:function(e){return"object"==typeof e&&function(e){return e&&"object"==typeof e&&"function"==typeof e.getNetwork&&"function"==typeof e.getBlockNumber}(e.provider)},ProviderRelayer:Ir,proto:Zr,isRpcRelayerOptions:function(e){return void 0!==e.url&&"string"==typeof e.url&&void 0!==e.provider&&ii(e.provider)},RpcRelayer:ni,isRelayer:oi});const id=Yn;var od=Object.freeze({__proto__:null,transactions:id}),ad=Object.freeze({__proto__:null,isValidSignature:Ah,isValidMessageSignature:xh,isValidTypedDataSignature:Ph,isWalletUpToDate:Mh,extractProjectIdFromAccessKey:e=>{const t=e.replace(/-/g,"+").replace(/_/g,"/"),s=atob(t),n=new Uint8Array(s.length);for(let e=0;e<s.length;e++)n[e]=s.charCodeAt(e);if(1!==n[0])throw new Error("UnsupportedVersion");const r=n.slice(1,9);return r[7]|r[6]<<8|r[5]<<16|r[4]<<24|r[3]<<32|r[2]<<40|r[1]<<48|r[0]<<56},base64Encode:e=>fe(e,!0),base64EncodeObject:qe,base64Decode:e=>{if(null!=e)return pe(e)},base64DecodeObject:Fe,MAX_UINT_256:Be,isBigNumberish:$e,toHexString:De,parseUnits:We,parseEther:e=>We(e,18),formatUnits:je,formatEther:e=>je(e,18),bigintReplacer:Ue,bigintReviver:He,encodeMessageDigest:Ge,packMessageData:Ve,subDigestOf:Ke,isNode:ze,isBrowser:()=>!0,jwtDecodeClaims:Je,Logger:Qe,logger:Xe,configureLogger:e=>Xe.configure(e),MerkleTreeGenerator:class{constructor(e,t){this.elements=void 0,this.toLeaf=void 0,this.tree=void 0,this.elements=e,this.toLeaf=t}generateTree(){const e=this.elements.map((e=>this.toLeaf(e)));return new et(e,{sortPairs:!0,sortLeaves:!0})}generateRoot(){return this.tree||(this.tree=this.generateTree()),this.tree.getHexRoot()}generateProof(e){if(!this.elements.includes(e))throw new Error("Element not found");return this.tree||(this.tree=this.generateTree()),this.tree.getHexProof(this.toLeaf(e))}verifyProof(e,t){if(!this.elements.includes(e))throw new Error("Element not found");return this.tree||(this.tree=this.generateTree()),this.tree.verify(t,this.toLeaf(e),this.generateRoot())}},getSaleItemsLeaf:e=>t.ethers.solidityPackedKeccak256(["address","uint256"],[e.address.toLowerCase(),e.tokenId]),getFetchRequest:tt,PromiseCache:class{constructor(){this.cache=void 0,this.cache=new Map}do(e,s,n,...r){e=`${e}:${t.ethers.id(JSON.stringify(r,st))}`;let i=this.cache.get(e);if(i&&i.expiration&&new Date>=i.expiration&&(i=void 0,this.cache.delete(e)),!i){const t={promise:n(...r)};void 0!==s&&(t.promise=t.promise.then((e=>(t.expiration=new Date(Date.now()+s),e)))),i=t,this.cache.set(e,i)}return i.promise}},promisify:function(e,t){return function(...s){const n=Array.prototype.slice.call(s);return new Promise((async(s,r)=>{try{n.push(((e,t)=>e?r(e):s(t))),await e.apply(t,n)}catch(e){r(e)}}))}},queryStringFromObject:function(e,t){return`${encodeURIComponent(e)}=${encodeURIComponent(JSON.stringify(t))}`},queryStringToObject:function(e){const t=e.split("&"),s={};for(const e of t){const t=e.split("=");s[decodeURIComponent(t[0])]=JSON.parse(decodeURIComponent(t[1]))}return s},getRandomInt:(e=0,t=Number.MAX_SAFE_INTEGER)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e),sanitizeNumberString:nt,sanitizeAlphanumeric:rt,sanitizeHost:it,sleep:e=>new Promise((t=>{const s=setTimeout((()=>{clearTimeout(s),t()}),e)})),encodeTypedDataHash:ot,encodeTypedDataDigest:at,defineProperties:ct,resolveProperties:ht,urlClean:e=>e.replace(/([^:]\/)\/+/g,"$1")}),cd=Object.freeze({__proto__:null,VERSION:hr,v1:hs,v2:In,commons:rr,universal:cr,allVersions:lr}),hd=Object.freeze({__proto__:null,SignerState:di,isSignerStatusPending:ui,Orchestrator:fi,signers:li}),ld=Object.freeze({__proto__:null,tracker:sa,trackers:yc}),dd=Object.freeze({__proto__:null,version:ur,migration:gr,migrator:wr,defaults:br}),ud=Object.freeze({__proto__:null,Account:bi,isAccount:function(e){return e instanceof bi}}),fd=Object.freeze({__proto__:null,abi:i,api:W,auth:Sc,guard:ih,indexer:oh,metadata:ah,network:ch,provider:nd,relayer:rd,transactions:od,utils:ad,core:cd,signhub:hd,sessions:ld,migration:dd,account:ud,initWallet:ed,getWallet:sd,unregisterWallet:td,SequenceProvider:al,SequenceClient:Yl,SequenceSigner:sl});e.initWallet=ed,e.sequence=fd,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=0xsequence.umd.min.js.map
